var __decorate=this&&this.__decorate||function(e,t,i,r){var n=arguments.length,a=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)if(o=e[l])a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a;return n>3&&a&&Object.defineProperty(t,i,a),a};var __skipExtends={__metadata:true,__typeName:true,__componentFactory:true};var __extends=this&&this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i)&&__skipExtends[i]!==true)e[i]=t[i];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var __assign=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]}return e};var __rest=function(e,t){var i={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)i[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)if(t.indexOf(r[n])<0)i[r[n]]=e[r[n]];return i};var __spreadArrays=function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var r=Array(e),n=0,t=0;t<i;t++)for(var a=arguments[t],o=0,l=a.length;o<l;o++,n++)r[n]=a[o];return r};if(typeof Promise==="undefined"){if(typeof RSVP!=="undefined"){Promise=RSVP}else if(typeof jQuery!=="undefined"){Promise=$.Deferred;Promise.resolve=function(e){return jQuery.Deferred().resolveWith(e)}}}ss.initAssembly({},"App",{});var Q;(function(e){function t(e,t){return ss.coalesce(e,t)}e.coalesce=t;function i(e){return ss.isValue(e)}e.isValue=i;function r(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return true}return false}e.any=r;function n(e,t){var i=0;for(var r=0,n=e;r<n.length;r++){var a=n[r];if(t(a))i++}return i}e.count=n;function a(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return n}throw new Error("first:No element satisfies the condition.!")}e.first=a;function o(e,t){for(var i=0;i<e.length;i++)if(t(e[i]))return i;return-1}e.indexOf=o;function l(e,t,i){ss.insert(e,t,i)}e.insert=l;function s(e){return ss.isArray(e)}e.isArray=s;function u(e,t){var i;var r=false;for(var n=0,a=e;n<a.length;n++){var o=a[n];if(t(o)){if(r)throw new Error("single:sequence contains more than one element.");r=true;i=o}}if(!r)throw new Error("single:No element satisfies the condition.");return i}e.single=u;function c(e,t){var i={};for(var r=0,n=e;r<n.length;r++){var a=n[r];var o=t(a)||"";var l=i[o];if(!l){l=i[o]=[]}l.push(a)}return i}e.toGrouping=c;function d(t,i){var r={byKey:Object.create(null),inOrder:[]};for(var n=0;n<t.length;n++){var a=t[n];var o=e.coalesce(i(a),"");var l=r.byKey[o];if(l===undefined){l={order:r.inOrder.length,key:o,items:[a],start:n};r.byKey[o]=l;r.inOrder.push(l)}else{l.items.push(a)}}return r}e.groupBy=d;function f(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return n}}e.tryFirst=f;function p(e,t){return ss.endsWithString(e,t)}e.endsWith=p;function h(e){return e==null||e.length===0}e.isEmptyOrNull=h;function g(e){return x(e)==null}e.isTrimmedEmpty=g;function y(e){var t;var i=[];for(var r=1;r<arguments.length;r++){i[r-1]=arguments[r]}return(t=ss).formatString.apply(t,__spreadArrays([e],i))}e.format=y;function v(e,t,i){if(i===void 0){i=" "}while(e.length<t)e="0"+e;return e}e.padLeft=v;function m(e,t){return ss.startsWithString(e,t)}e.startsWith=m;function b(t){return e.replaceAll(e.replaceAll(_(t),"\r\n"," "),"\n"," ").trim()}e.toSingleLine=b;function C(e){return(e==null?"":e).replace(new RegExp("^\\s+|\\s+$","g"),"")}e.trim=C;function _(e){if(e==null||e.length===0){return""}return C(e)}e.trimToEmpty=_;function x(e){if(e==null||e.length===0){return null}e=C(e);if(e.length===0){return null}else{return e}}e.trimToNull=x;var S;function w(e,t){var i="AaBbCcÇçFfGgĞğHhIıİiJjKkLlMmNnOoÖöPpRrSsŞşTtUuÜüVvYyZz";e=e||"";t=t||"";if(e==t)return 0;if(!S){S={};for(var r=0;r<i.length;r++){S[i.charAt(r)]=r+1}}for(var n=0,a=Math.min(e.length,t.length);n<a;n++){var o=e.charAt(n),l=t.charAt(n);if(o===l)continue;var s=S[o],u=S[l];if(s!=null&&u!=null)return s<u?-1:1;var c=o.localeCompare(l);if(c==0)continue;return c}return e.localeCompare(t)}e.turkishLocaleCompare=w;function T(e){if(!e)return e;return e.replace(/i/g,"İ").replace(/ı/g,"I").toUpperCase()}e.turkishLocaleToUpper=T;function I(e,t,i){return ss.replaceAllString(e,t,i)}e.replaceAll=I;function k(e,t){var i=e.toString();while(i.length<t)i="0"+i;return i}e.zeroPad=k;function F(e,t,i){var r,n,a,o,l;if(null==t)t=100;function s(){var u=Date.now()-o;if(u<t&&u>=0){r=setTimeout(s,t-u)}else{r=null;if(!i){l=e.apply(a,n);a=n=null}}}var u=function(){a=this;n=arguments;o=Date.now();var u=i&&!r;if(!r)r=setTimeout(s,t);if(u){l=e.apply(a,n);a=n=null}return l};u.clear=function(){if(r){clearTimeout(r);r=null}};u.flush=function(){if(r){l=e.apply(a,n);a=n=null;clearTimeout(r);r=null}};return u}e.debounce=F;function D(e){var t=[];for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}var r,n,a,o,l,s,u=arguments[0]||{},c=1,d=arguments.length;if(typeof u!=="object"&&!$.isFunction(u)){u={}}if(c===d){u={};c=0}for(;c<d;c++){if((r=arguments[c])!==null){if($.isArray(r)){u=$.extend(true,[],r)}else{for(n in r){a=u[n];o=r[n];if(u===o){continue}if(o&&($.isPlainObject(o)||(l=$.isArray(o)))){if(l){l=false;s=a&&$.isArray(a)?a:[]}else{s=a&&$.isPlainObject(a)?a:{}}u[n]=D(s,o)}else if(o!==undefined){u[n]=o}}}}}return u}e.deepClone=D})(Q||(Q={}));var Q;(function(e){var t;(function(t){t.decimalSeparator=".";t.dateSeparator="/";t.dateOrder="dmy";t.dateFormat="dd/MM/yyyy";t.dateTimeFormat="dd/MM/yyyy HH:mm:ss";function i(){return t.decimalSeparator===","?".":","}t.get_groupSeparator=i;var r=e.trimToNull($("script#ScriptCulture").html());if(r!=null){var n=$.parseJSON(r);if(n.DecimalSeparator!=null)t.decimalSeparator=n.DecimalSeparator;if(n.DateSeparator!=null)t.dateSeparator=n.DateSeparator;if(n.DateOrder!=null)t.dateOrder=n.DateOrder;if(n.DateFormat!=null)t.dateFormat=n.DateFormat;if(n.DateTimeFormat!=null)t.dateTimeFormat=n.DateTimeFormat}})(t=e.Culture||(e.Culture={}));function i(e,i,r,n){var o="-";if(isNaN(e)){return null}r=r||t.decimalSeparator;n=n||t.get_groupSeparator();var l="";if(i.indexOf(".")>-1){var s=r;var u=i.substring(i.lastIndexOf(".")+1);e=a(e,u.length);var c=e%1;var d=new String(c.toFixed(u.length));d=d.substring(d.lastIndexOf(".")+1);for(var f=0;f<u.length;f++){if(u.charAt(f)=="#"&&d.charAt(f)!="0"){s+=d.charAt(f);continue}else if(u.charAt(f)=="#"&&d.charAt(f)=="0"){var p=d.substring(f);if(p.match("[1-9]")){s+=d.charAt(f);continue}else break}else if(u.charAt(f)=="0")s+=d.charAt(f);else s+=u.charAt(f)}l+=s}else e=Math.round(e);var h=Math.floor(e);if(e<0)h=Math.ceil(e);var g="";if(i.indexOf(".")==-1)g=i;else g=i.substring(0,i.indexOf("."));var y="";if(!(h==0&&g.substr(g.length-1)=="#")){var v=new String(Math.abs(h));var m=9999;if(g.lastIndexOf(",")!=-1)m=g.length-g.lastIndexOf(",")-1;var b=0;for(var f=v.length-1;f>-1;f--){y=v.charAt(f)+y;b++;if(b==m&&f!=0){y=n+y;b=0}}if(g.length>y.length){var C=g.indexOf("0");if(C!=-1){var _=g.length-C;var x=g.length-y.length-1;while(y.length<_){var S=g.charAt(x);if(S==",")S=n;y=S+y;x--}}}}if(!y&&g.indexOf("0",g.length-1)!==-1)y="0";l=y+l;if(e<0)l=o+l;if(l.lastIndexOf(r)==l.length-1){l=l.substring(0,l.length-1)}return l}e.formatNumber=i;function r(i){i=e.trim(i.toString());var r=t.get_groupSeparator();if(i&&i.length&&i.indexOf(r)>0){i=i.replace(new RegExp("(\\b\\d{1,3})\\"+r+"(?=\\d{3}(\\D|$))","g"),"$1")}if(!/^[-\+]?\d+$/.test(i))return NaN;return parseInt(i,10)}e.parseInteger=r;function n(i){if(i==null)return null;i=e.trim(i.toString());if(i.length==0)return null;var r=t.get_groupSeparator();if(i&&i.length&&i.indexOf(r)>0){i=i.replace(new RegExp("(\\b\\d{1,3})\\"+r+"(?=\\d{3}(\\D|$))","g"),"$1")}if(!new RegExp("^\\s*([-\\+])?(\\d*)\\"+t.decimalSeparator+"?(\\d*)\\s*$").test(i))return NaN;return parseFloat(i.toString().replace(t.decimalSeparator,"."))}e.parseDecimal=n;function a(e,t){var i=Math.pow(10,t||0);var r=(Math.round(e*i)/i).toString();if(t>0){var n=r.indexOf(".");if(n==-1){r+=".";n=0}else{n=r.length-(n+1)}while(n<t){r+="0";n++}}return parseFloat(r)}function o(e){if(e==null)return null;if(typeof e=="number")return e;e=$.trim(e);if(e==null||!e.length)return null;if(e.length>=15||!/^-?\d+$/.test(e))return e;var t=parseInt(e,10);if(isNaN(t))return e;return t}e.toId=o;function l(i,r){if(!i){return""}var n;if(typeof i=="string"){var a=e.parseDate(i);if(!a)return i;n=a}else n=i;if(r==null||r=="d"){r=t.dateFormat}else{switch(r){case"g":r=t.dateTimeFormat.replace(":ss","");break;case"G":r=t.dateTimeFormat;break;case"s":r="yyyy-MM-ddTHH:mm:ss";break;case"u":return e.formatISODateTimeUTC(n)}}var o=function(t){return e.zeroPad(t,2)};return r.replace(new RegExp("dd?|MM?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|fff|zz?z?|\\/","g"),function(i){switch(i){case"/":return t.dateSeparator;case"hh":return o(n.getHours()<13?n.getHours():n.getHours()-12);case"h":return n.getHours()<13?n.getHours():n.getHours()-12;case"HH":return o(n.getHours());case"H":return n.getHours();case"mm":return o(n.getMinutes());case"m":return n.getMinutes();case"ss":return o(n.getSeconds());case"s":return n.getSeconds();case"yyyy":return n.getFullYear();case"yy":return n.getFullYear().toString().substr(2,4);case"dd":return o(n.getDate());case"d":return n.getDate().toString();case"MM":return o(n.getMonth()+1);case"M":return n.getMonth()+1;case"t":return n.getHours()<12?"A":"P";case"tt":return n.getHours()<12?"AM":"PM";case"fff":return e.zeroPad(n.getMilliseconds(),3);case"zzz":case"zz":case"z":return"";default:return i}})}e.formatDate=l;function s(t){if(t===0)return"0";else if(!t)return"";var i=Math.floor(t/24/60);var r="";if(i>0){r+=i.toString()}var n=e.zeroPad(Math.floor(t%(24*60)/60),2)+":"+e.zeroPad(t%60,2);if(n!="00:00"){if(i>0)r+=".";r+=n}return r}e.formatDayHourAndMin=s;function u(e){if(e==null)return"";var t=function(e){return(e<10?"0":"")+e};var i=e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes());var r=Number(e.getUTCSeconds()+"."+(e.getUTCMilliseconds()<100?"0":"")+t(e.getUTCMilliseconds()));i+=":"+t(r)+"Z";return i}e.formatISODateTimeUTC=u;var c=/(\d{4,})(?:-(\d{1,2})(?:-(\d{1,2})(?:[T ](\d{1,2}):(\d{1,2})(?::(\d{1,2})(?:\.(\d+))?)?(?:(Z)|([+-])(\d{1,2})(?::(\d{1,2}))?)?)?)?)?/;function d(e){if(!e||!e.length)return null;e=e+"";if(typeof e!="string"||e.length===0){return null}var t=e.match(c);if(typeof t=="undefined"||t===null){return null}var i,r,n,a,o,l,s;i=parseInt(t[1],10);if(typeof t[2]=="undefined"||t[2]===""){return new Date(i)}r=parseInt(t[2],10)-1;n=parseInt(t[3],10);if(typeof t[4]=="undefined"||t[4]===""){return new Date(i,r,n)}a=parseInt(t[4],10);o=parseInt(t[5],10);l=typeof t[6]!="undefined"&&t[6]!==""?parseInt(t[6],10):0;if(typeof t[7]!="undefined"&&t[7]!==""){s=Math.round(1e3*parseFloat("0."+t[7]))}else{s=0}if((typeof t[8]=="undefined"||t[8]==="")&&(typeof t[9]=="undefined"||t[9]==="")){return new Date(i,r,n,a,o,l,s)}var u;if(typeof t[9]!="undefined"&&t[9]!==""){u=parseInt(t[10],10)*36e5;if(typeof t[11]!="undefined"&&t[11]!==""){u+=parseInt(t[11],10)*6e4}if(t[9]=="-"){u=-u}}else{u=0}return new Date(Date.UTC(i,r,n,a,o,l,s)-u)}e.parseISODateTime=d;function f(t){var i=e.trim(t);if(i.length<4||i.length>5)return NaN;var n,a;if(i.charAt(1)==":"){n=r(i.substr(0,1));a=r(i.substr(2,2))}else{if(i.charAt(2)!=":")return NaN;n=r(i.substr(0,2));a=r(i.substr(3,2))}if(isNaN(n)||isNaN(a)||n<0||n>23||a<0||a>59)return NaN;return n*60+a}e.parseHourAndMin=f;function p(t){var i;var n=e.trim(t);if(!n)return NaN;var a=n.split(".");if(a.length==0||a.length>2)return NaN;if(a.length==1){i=r(a[0]);if(!isNaN(i))return i*24*60;return f(a[0])}else{i=r(a[0]);var o=f(a[1]);if(isNaN(i)||isNaN(o))return NaN;return i*24*60+o}}e.parseDayHourAndMin=p;function h(i,r){if(!i||!i.length)return null;if(i.length>=10&&i.charAt(4)==="-"&&i.charAt(7)==="-"&&(i.length===10||i.length>10&&i.charAt(10)==="T")){var n=e.parseISODateTime(i);if(n==null)return false;return n}var a;var o;var l,s,u;o=g(i);if(!o)return false;if(o.length==3){r=r||t.dateOrder;switch(r){case"dmy":l=parseInt(o[0],10);s=parseInt(o[1],10)-1;u=parseInt(o[2],10);break;case"ymd":l=parseInt(o[2],10);s=parseInt(o[1],10)-1;u=parseInt(o[0],10);break;case"mdy":default:l=parseInt(o[1],10);s=parseInt(o[0],10)-1;u=parseInt(o[2],10);break}if(isNaN(l)||isNaN(s)||isNaN(u)||l<1||l>31||s<0||s>11||u>9999||u<0)return false;if(u<100){var c=(new Date).getFullYear();var d=c%100+10;u+=c-c%100+(u<=d?0:-100)}try{a=new Date(u,s,l);if(isNaN(a.getFullYear()))return false}catch(f){return false}}else if(o.length==1){try{a=new Date(o[0]);if(isNaN(a.getFullYear()))return false}catch(f){return false}}return a}e.parseDate=h;function g(t){t=e.trim(t);if(!t.length)return;if(t.indexOf("/")>=0)return t.split("/");else if(t.indexOf(".")>=0)return t.split(".");else if(t.indexOf("-")>=0)return t.split("-");else if(t.indexOf("\\")>=0)return t.split("\\");else return[t]}e.splitDateString=g})(Q||(Q={}));var Q;(function(e){function t(e){var t=l.$table[e];if(t==null){t=e||""}return t}e.text=t;function i(e){return function(i){return t("Db."+e+"."+i)}}e.dbText=i;function r(t){return function(i,r){if(i!=null&&!e.startsWith(i,"`")){var n=e.tryGetText(i);if(n!=null){return n}}if(i!=null&&e.startsWith(i,"`")){i=i.substr(1)}if(!e.isEmptyOrNull(t)){var a=typeof r=="function"?r(t):t+r;var o=e.tryGetText(a);if(o!=null){return o}}return i}}e.prefixedText=r;function n(e){return l.$table[e]}e.tryGetText=n;function a(e){return function(i){return t("Db."+e+"."+i)}}e.dbTryText=a;function o(t,i,r){if(typeof window!="undefined"&&window["Proxy"]){return new window["Proxy"](t,{get:function(n,a){var l=r[a];if(l==null)return;if(typeof l=="number")return e.text(i+a);else{var s=t[a];if(s!=null)return s;t[a]=s=o({},i+a+".",l);return s}},ownKeys:function(e){return Object.keys(r)}})}else{for(var n=0,a=Object.keys(r);n<a.length;n++){var l=a[n];if(typeof r[l]=="number")Object.defineProperty(t,l,{get:function(){return e.text(i+l)}});else t[l]=o({},i+l+".",r[l])}return t}}e.proxyTexts=o;var l=function(){function e(e){this.key=e}e.add=function(t,i){if(!t){return}i=i||"";for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];var o=i+a;var l=t[a];if(typeof l==="object"){e.add(l,o+".")}else{e.$table[o]=l}}};e.prototype.get=function(){var t=e.$table[this.key];if(t==null){t=this.key||""}return t};e.prototype.toString=function(){var t=e.$table[this.key];if(t==null){t=this.key||""}return t};e.$table={};e.empty=new e("");e.initializeTextClass=function(t,i){var r=Object.keys(t).slice();for(var n=0;n<r.length;n++){var a=r[n];var o=t[a];if(o instanceof e){var l=o;var s=i+a;e.$table[s]=l.key;t[a]=new e(s)}}};e.getDefault=function(t,i){var r=e.$table[t];if(r==null){r=i;if(r==null){r=t||""}}return r};return e}();e.LT=l})(Q||(Q={}));var Q;(function(e){var t=function(){function t(e,t){this.items=[];this.itemById={};e=e||{};this.textFormatter=e.textFormatter;this.idField=e.idField;this.parentIdField=e.parentIdField;this.textField=e.textField;this.textFormatter=e.textFormatter;if(t!=null)this.update(t)}t.prototype.update=function(t){this.items=[];this.itemById={};if(t){for(var i=0,r=t;i<r.length;i++){var n=r[i];this.items.push(n)}}var a=this.idField;if(!e.isEmptyOrNull(a)){for(var o=0,l=this.items;o<l.length;o++){var s=l[o];var u=s[a];if(u!=null){this.itemById[u]=s}}}};t.prototype.get_idField=function(){return this.idField};t.prototype.get_parentIdField=function(){return this.parentIdField};t.prototype.get_textField=function(){return this.textField};t.prototype.get_textFormatter=function(){return this.textFormatter};t.prototype.get_itemById=function(){return this.itemById};t.prototype.get_items=function(){return this.items};return t}();e.Lookup=t})(Q||(Q={}));var Q;(function(e){var t=0;function i(e){if(t>0){t++;return}$.blockUI(e);t++}function r(e){e=$.extend({baseZ:2e3,message:"",overlayCSS:{opacity:"0.0",zIndex:2e3,cursor:"wait"},fadeOut:0},e);if(e.useTimeout){window.setTimeout(function(){i(e)},0)}else{i(e)}}e.blockUI=r;function n(){if(t>1){t--;return}t--;$.unblockUI({fadeOut:0})}e.blockUndo=n})(Q||(Q={}));var Q;(function(e){function t(e,t,i){$("<option/>").val(t).text(i).appendTo(e)}e.addOption=t;function i(i){t(i,"",e.text("Controls.SelectEditor.EmptyItemText"))}e.addEmptyOption=i;function r(e){e.html("")}e.clearOptions=r;function n(t,i){var r=t.attr("id");if(e.isEmptyOrNull(r)){return $("#"+i)}var n=$("#"+r+i);if(n.length>0){return n}n=$("#"+r+"_"+i);if(n.length>0){return n}while(true){var a=r.lastIndexOf("_");if(a<=0){return $("#"+i)}r=r.substr(0,a);n=$("#"+r+"_"+i);if(n.length>0){return n}}}e.findElementWithRelativeId=n;function a(e){switch(e){case"&":return"&amp;";case">":return"&gt;";case"<":return"&lt;";case"'":return"&apos;";case'"':return"&quot;"}return e}var o=/[><&'"]/g;function l(e){var t=e==null?"":e.toString();if(o.test(t)){return t.replace(o,a)}return t}e.attrEncode=l;function s(e){switch(e){case"&":return"&amp;";case">":return"&gt;";case"<":return"&lt;"}return e}function u(e){var t=e==null?"":e.toString();if(new RegExp("[><&]","g").test(t)){return t.replace(new RegExp("[><&]","g"),s)}return t}e.htmlEncode=u;function c(t,i){if(!t||t.indexOf("{{")<0){return t}if(!$.templates||!$.views){throw new ss.Exception("Please make sure that jsrender.js is included in the page!")}i=i||{};var r=$.templates(t);$.views.converters({text:e.text},r);return r.render(i)}e.jsRender=c;function d(e){window.console&&window.console.log(e)}e.log=d;function f(){return $("<div/>").appendTo(document.body)}e.newBodyDiv=f;function p(e){return $("<i/>").append(e.eq(0).clone()).html()}e.outerHtml=p})(Q||(Q={}));var Q;(function(e){function t(t,i){var r;i=$.extend({htmlEncode:true,okButton:e.text("Dialogs.OkButton"),title:e.text("Dialogs.AlertTitle"),onClose:null,onOpen:null,autoOpen:false,dialogClass:"s-MessageDialog s-AlertDialog",modal:true,width:"40%",maxWidth:"450",minWidth:"180",resizable:false,open:function(){if(i.onOpen)i.onOpen.call(this)},close:function(){r.dialog("destroy");if(i.onClose)i.onClose()}},i);if(i.htmlEncode)t=e.htmlEncode(t);if(!i.buttons){var n=[];n.push({text:i.okButton,click:function(){r.dialog("close")}});i.buttons=n}r=$('<div><div class="message"></div></div>').dialog(i).children(".message").html(t).parent().dialog("open")}e.alert=t;function i(t,i,r){var n;r=$.extend({htmlEncode:true,yesButton:e.text("Dialogs.YesButton"),noButton:e.text("Dialogs.NoButton"),title:e.text("Dialogs.ConfirmationTitle"),onNo:null,onCancel:null,onClose:null,autoOpen:false,modal:true,dialogClass:"s-MessageDialog s-ConfirmDialog",width:"40%",maxWidth:"450",minWidth:"180",resizable:false,open:function(){if(r.onOpen)r.onOpen.call(this)},close:function(){n.dialog("destroy");if(!a&&r.onCancel)r.onCancel()},overlay:{opacity:.77,background:"black"}},r);if(r.htmlEncode)t=e.htmlEncode(t);var a=false;if(!r.buttons){var o=[];o.push({text:r.yesButton,click:function(){a=true;n.dialog("close");if(i)i()}});if(r.noButton)o.push({text:r.noButton,click:function(){a=true;n.dialog("close");if(r.onNo)r.onNo();else if(r.onCancel)r.onCancel()}});r.buttons=o}n=$('<div><div class="message"></div></div>').dialog(r).children(".message").html(t).parent().dialog("open")}e.confirm=i;function r(t){var i;var r=$('<div style="overflow: hidden"><iframe></iframe></div>');var n=$.extend({autoOpen:true,modal:true,width:"60%",height:"400",title:e.text("Dialogs.AlertTitle"),open:function(){i=r.find("iframe").css({border:"none",width:"100%",height:"100%"})[0].contentDocument;i.open();i.write(n.html);i.close()},close:function(){i.open();i.write("");i.close();r.dialog("destroy").html("")}},t);r.dialog(n)}e.iframeDialog=r;function n(t,r,n){i(t,r,$.extend({title:e.text("Dialogs.InformationTitle"),dialogClass:"s-MessageDialog s-InformationDialog",yesButton:e.text("Dialogs.OkButton"),noButton:null},n))}e.information=n;function a(i,r){t(i,$.extend({title:e.text("Dialogs.WarningTitle"),dialogClass:"s-MessageDialog s-WarningDialog"},r))}e.warning=a})(Q||(Q={}));var Q;(function(e){e.defaultNotifyOptions={timeOut:3e3,showDuration:250,hideDuration:500,extendedTimeOut:500,positionClass:"toast-top-full-width"};function t(t){t=$.extend({},e.defaultNotifyOptions,t);o(true);return t}function i(e,i,r){toastr.warning(e,i,t(r))}e.notifyWarning=i;function r(e,i,r){toastr.success(e,i,t(r))}e.notifySuccess=r;function n(e,i,r){toastr.info(e,i,t(r))}e.notifyInfo=n;function a(e,i,r){toastr.error(e,i,t(r))}e.notifyError=a;function o(e){if(typeof toastr==="undefined"){return}var t=$(window.document.body).children(".ui-dialog:visible").last();var i=toastr.getContainer(null,e);if(i.length===0){return}if(t.length>0){var r=t.position();i.addClass("positioned-toast toast-top-full-width");i.css({position:"absolute",top:r.top+28+"px",left:r.left+6+"px",width:t.width()-12+"px"})}else{i.addClass("toast-top-full-width");if(i.hasClass("positioned-toast")){i.removeClass("positioned-toast");i.css({position:"",top:"",left:"",width:""})}}}e.positionToastContainer=o})(Q||(Q={}));var Q;(function(e){var t;(function(t){function i(t){var i;if(t==null){i="??ERROR??"}else{i=t.Message;if(i==null){i=t.Code}}e.alert(i)}t.showServiceError=i;function r(t,i,r,n,a){try{var o=(window.location.host||"").toLowerCase();if(o.indexOf("localhost")<0&&o.indexOf("127.0.0.1")<0)return;if(!window["toastr"])return;var l=JSON.stringify(a||{});t="<p></p><p>Message: "+e.htmlEncode(t)+"</p><p>File: "+e.htmlEncode(i)+", Line: "+r+", Column: "+n+(l!="{}"?"</p><p>Error: ":"")+"</p>";window.setTimeout(function(){try{e.notifyError(t,"SCRIPT ERROR! See browser console (F12) for details.",{escapeHtml:false,timeOut:15e3})}catch(i){}})}catch(s){}}t.runtimeErrorHandler=r})(t=e.ErrorHandling||(e.ErrorHandling={}))})(Q||(Q={}));var Q;(function(e){var t;(function(e){e.applicationPath="/";var t=$("link#ApplicationPath");if(t.length>0){e.applicationPath=t.attr("href")}e.emailAllowOnlyAscii=true;e.responsiveDialogs=false;e.rootNamespaces=["Serenity"];e.notLoggedInHandler=null})(t=e.Config||(e.Config={}))})(Q||(Q={}));var Q;(function(e){function t(e){if($.cookie)return $.cookie(e);e+="=";for(var t=document.cookie.split(/;\s*/),i=t.length-1;i>=0;i--)if(!t[i].indexOf(e))return t[i].replace(e,"")}e.getCookie=t;$.ajaxSetup({beforeSend:function(t){var i=e.getCookie("CSRF-TOKEN");if(i)t.setRequestHeader("X-CSRF-TOKEN",i)}});function i(t){var i=function(i){if(e.Config.notLoggedInHandler!=null&&i&&i.Error&&i.Error.Code=="NotLoggedIn"&&e.Config.notLoggedInHandler(t,i)){return}if(t.onError!=null){t.onError(i);return}e.ErrorHandling.showServiceError(i.Error)};var r=t.service;if(r&&r.length&&r.charAt(0)!="~"&&r.charAt(0)!="/"&&r.indexOf("://")<0)r=s("~/services/")+r;t=$.extend({dataType:"json",contentType:"application/json",type:"POST",cache:false,blockUI:true,url:r,data:$.toJSON(t.request),success:function(i,r,n){try{if(!i.Error&&t.onSuccess){t.onSuccess(i)}}finally{if(t.blockUI){e.blockUndo()}t.onCleanup&&t.onCleanup()}},error:function(r,n,a){try{if(r.status===403){var o=null;try{o=r.getResponseHeader("Location")}catch(l){o=null}if(o){window.top.location.href=o;return}}if((r.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var s=$.parseJSON(r.responseText);if(s&&s.Error){i(s);return}}var u=r.responseText;if(!u){if(!r.status)e.alert("An unknown AJAX connection error occurred! Check browser console for details.");else if(r.status==500)e.alert("HTTP 500: Connection refused! Check browser console for details.");else e.alert("HTTP "+r.status+" error! Check browser console for details.")}else e.iframeDialog({html:u})}finally{if(t.blockUI){e.blockUndo()}t.onCleanup&&t.onCleanup()}}},t);if(t.blockUI){e.blockUI(null)}return $.ajax(t)}e.serviceCall=i;function r(e,t,r,n){return i($.extend({service:e,request:t,onSuccess:r},n))}e.serviceRequest=r;function n(e,t,i){if(e.EqualityFilter==null){e.EqualityFilter={}}e.EqualityFilter[t]=i}e.setEquality=n;function a(e){var t;if(e===undefined)t=location.search.substring(1,location.search.length);else t=e||"";var i={};var r=t.split("&");for(var n=0;n<r.length;n++){var a=r[n].split("=");var o=decodeURIComponent(a[0]);i[o]=a.length>=2?decodeURIComponent(a[1]):o}return i}e.parseQueryString=a;function o(t){var i=$("<form/>").attr("method","POST").attr("action",t.url?s(t.url):s("~/services/"+t.service)).appendTo(document.body);if(t.target)i.attr("target",t.target);var r=$("<div/>").appendTo(i);$("<input/>").attr("type","hidden").attr("name","request").val($["toJSON"](t.request)).appendTo(r);var n=e.getCookie("CSRF-TOKEN");if(n){$("<input/>").attr("type","hidden").attr("name","__RequestVerificationToken").appendTo(r).val(n)}$("<input/>").attr("type","submit").appendTo(r);i.submit();window.setTimeout(function(){i.remove()},0)}e.postToService=o;function l(t){var i=$("<form/>").attr("method","POST").attr("action",s(t.url)).appendTo(document.body);if(t.target)i.attr("target",t.target);var r=$("<div/>").appendTo(i);if(t.params!=null){for(var n in t.params){$("<input/>").attr("type","hidden").attr("name",n).val(t.params[n]).appendTo(r)}}var a=e.getCookie("CSRF-TOKEN");if(a){$("<input/>").attr("type","hidden").attr("name","__RequestVerificationToken").appendTo(r).val(a)}$("<input/>").attr("type","submit").appendTo(r);i.submit();window.setTimeout(function(){i.remove()},0)}e.postToUrl=l;function s(t){if(t&&t.substr(0,2)==="~/"){return e.Config.applicationPath+t.substr(2)}return t}e.resolveUrl=s})(Q||(Q={}));var Q;(function(e){var t;(function(e){var t;var i=[];var r={};function n(){if(t==null&&i.length){t=window.setTimeout(o,100)}}function a(){if(t!=null){window.clearTimeout(t);t=null}}function o(){for(var e=0,t=i;e<t.length;e++){var r=t[e];try{r()}catch(o){console.log(o)}}a();n()}function l(e,t){if(t==null)throw"Layout handler can't be null!";if(r[e]!==undefined)throw"There is already a registered layout handler with key: "+e;if(e!=null)r[e]=i.length;i.push(t);n();return t}e.on=l;function s(e,t,i){var r=t.offsetWidth;var n=t.offsetHeight;l(e,function(){var e=t.offsetWidth;var a=t.offsetHeight;if(e!==r||a!==n){r=e;n=a;i()}});return i}e.onSizeChange=s;function u(e,t,i){var r=t.offsetWidth;l(e,function(){var e=t.offsetWidth;if(e!==r){r=e;i()}});return i}e.onWidthChange=u;function c(e,t,i){var r=t.offsetHeight;l(e,function(){var e=t.offsetHeight;if(e!==r){r=e;i()}});return i}e.onHeightChange=c;function d(e,t){if(e!=null){var n=r[e];if(n!==undefined){delete r[e];if(t==null||t===i[n]){i.splice(n,1);!i.length&&this.clearTimer();return}}}if(t!=null){for(var a=i.length-1;a>=0;a++){if(i[a]===t){i.splice(a,1);!i.length&&this.clearTimer();break}}}}e.off=d})(t=e.LayoutTimer||(e.LayoutTimer={}))})(Q||(Q={}));var Q;(function(e){function t(e){e.css("height","100%");o(e)}e.autoFullHeight=t;function i(t){$("body").addClass("full-height-page");t.addClass("responsive-height");var i=function(){var e=t.parent().hasClass("page-content")||t.parent().is("section.content");if(e){t.css("height","1px").css("overflow","hidden")}n(t);if(e){t.css("overflow","")}t.triggerHandler("layout")};if($("body").hasClass("has-layout-event")){$("body").bind("layout",i)}else if(window.Metronic){window.Metronic.addResizeHandler(i)}else{$(window).resize(i)}i();t.one("remove",function(){$(window).off("layout",i);$("body").off("layout",i)});e.Router.resolve()}e.initFullHeightGridPage=i;function r(e){var t=0;e.parent().children().not(e).each(function(e,i){var r=$(i);if(r.is(":visible")){t+=r.outerHeight(true)}});t=e.parent().height()-t;if(e.css("box-sizing")!=="border-box"){t=t-(e.outerHeight(true)-e.height())}return t}e.layoutFillHeightValue=r;function n(e){var t=r(e);var i=Math.round(t)+"px";if(e.css("height")!=i){e.css("height",i)}}e.layoutFillHeight=n;function a(){var e=navigator.userAgent.indexOf("Mobi")>=0||window.matchMedia("(max-width: 767px)").matches;var t=$(document.body);if(t.hasClass("mobile-device")){if(!e){t.removeClass("mobile-device")}}else if(e){t.addClass("mobile-device")}}e.setMobileDeviceMode=a;function o(e){Serenity.LazyLoadHelper.executeEverytimeWhenShown(e,function(){e.triggerHandler("layout")},true)}e.triggerLayoutOnShow=o;function l(e){if(!e.hasClass("ui-dialog"))e=e.closest(".ui-dialog");e.position({at:"center center",of:window});var t=e.position();if(t.left<0)e.css("left","0px");if(t.top<0)e.css("top","0px")}e.centerDialog=l})(Q||(Q={}));var Q;(function(e){var t;(function(t){var i={};var r={};function n(e,t,i){$(document.body).bind("scriptdatachange."+t,function(t,r){if(r==e){i()}})}t.bindToChange=n;function a(e){$(document.body).triggerHandler("scriptdatachange",[e])}t.triggerChange=a;function o(e){$(document.body).unbind("scriptdatachange."+e)}t.unbindFromChange=o;function l(t,r){return{async:r,cache:true,type:"GET",url:e.resolveUrl("~/DynJS.axd/")+t+".js?"+i[t],data:null,dataType:"text",converters:{"text script":function(e){return e}},success:function(e,t,i){$.globalEval(e)},error:function(i,r,n){var a=e.startsWith(t,"Lookup.");if(i.status==403&&a){e.notifyError('<p>Access denied while trying to load the lookup: "<b>'+t.substr(7)+'</b>". Please check if current user has required permissions for this lookup.</p> '+"<p><em>Lookups use the ReadPermission of their row by default. You may override that for the lookup "+'like [LookupScript("Some.Lookup", Permission = "?")] to grant all '+'authenticated users to read it (or use "*" for public).</em></p>'+"<p><em>Note that this might be a security risk if the lookup contains sensitive data, "+'so it could be better to set a separate permission for lookups, like "MyModule:Lookups".</em></p>',null,{timeOut:1e4,escapeHtml:false});return}e.notifyError("An error occurred while trying to load "+(a?' the lookup: "'+t.substr(7):' dynamic script: "'+t)+'"!. Please check the error message displayed in the dialog below for more info.');var o=i.responseText;if(!o){if(!i.status)e.alert("An unknown connection error occurred! Check browser console for details.");else if(i.status==500)e.alert("HTTP 500: Connection refused! Check browser console for details.");else e.alert("HTTP "+i.status+" error! Check browser console for details.")}else e.iframeDialog({html:o})}}}function s(t){return Promise.resolve().then(function(){e.blockUI(null);return Promise.resolve($.ajax(l(t,false)).always(function(){e.blockUndo()}))},null)}function u(t){if(i[t]==null){throw new Error(e.format("Script data {0} is not found in registered script list!",t))}$.ajax(l(t,false))}function c(t){return Promise.resolve().then(function(){if(i[t]==null){throw new Error(e.format("Script data {0} is not found in registered script list!",t))}return s(t)},null)}function d(t){var i=r[t];if(i==null){u(t)}i=r[t];if(i==null)throw new Error(e.format("Can't load script data: {0}!",t));return i}t.ensure=d;function f(t){return Promise.resolve().then(function(){var i=r[t];if(i!=null){return Promise.resolve(i)}return c(t).then(function(){i=r[t];if(i==null){throw new Error(e.format("Can't load script data: {0}!",t))}return i},null)},null)}t.ensureAsync=f;function p(t){if(i[t]==null){throw new Error(e.format("Script data {0} is not found in registered script list!",t))}i[t]=(new Date).getTime().toString();u(t);var n=r[t];return n}t.reload=p;function h(t){return Promise.resolve().then(function(){if(i[t]==null){throw new Error(e.format("Script data {0} is not found in registered script list!",t))}i[t]=(new Date).getTime().toString();return c(t).then(function(){return r[t]},null)},null)}t.reloadAsync=h;function g(e){return r[e]!=null||i[e]!=null}t.canLoad=g;function y(e){i={};var t=(new Date).getTime();for(var r in e){i[r]=e[r]||t}}t.setRegisteredScripts=y;function v(e,t){r[e]=t;a(e)}t.set=v})(t=e.ScriptData||(e.ScriptData={}));function i(e){return t.ensure("RemoteData."+e)}e.getRemoteData=i;function r(e){return t.ensureAsync("RemoteData."+e)}e.getRemoteDataAsync=r;function n(i){var r="Lookup."+i;if(!t.canLoad(r)){var n='No lookup with key "'+i+'" is registered. Please make sure you have a'+' [LookupScript("'+i+'")] attribute in server side code on top of a row / custom lookup and '+" its key is exactly the same.";
e.notifyError(n);throw new Error(n)}return t.ensure("Lookup."+i)}e.getLookup=n;function a(e){return t.ensureAsync("Lookup."+e)}e.getLookupAsync=a;function o(e){t.reload("Lookup."+e)}e.reloadLookup=o;function l(e){return t.reloadAsync("Lookup."+e)}e.reloadLookupAsync=l;function s(e){return t.ensure("Columns."+e)}e.getColumns=s;function u(e){return t.ensureAsync("Columns."+e)}e.getColumnsAsync=u;function c(e){return t.ensure("Form."+e)}e.getForm=c;function d(e){return t.ensureAsync("Form."+e)}e.getFormAsync=d;function f(e){return t.ensure("Template."+e)}e.getTemplate=f;function p(e){return t.ensureAsync("Template."+e)}e.getTemplateAsync=p;function h(e){return t.canLoad(e)}e.canLoadScriptData=h})(Q||(Q={}));var Q;(function(e){function t(e,t){for(var i=0;i<t.length-1;i+=2){(function(t,i){Object.defineProperty(e.prototype,t,{get:function(){return this.w(t,i)},enumerable:true,configurable:true})})(t[i],t[i+1])}}e.initFormType=t;function i(e,t,i,r){i=i||"get_"+t;r=r||"set_"+t;Object.defineProperty(e.prototype,t,{get:function(){return this[i]()},set:function(e){return this[r](e)},configurable:true,enumerable:true})}e.prop=i;function r(e,t){if(!e)return null;var i=e.split(".");var r=t||window;for(var n=0;n<i.length;n++){r=r[i[n]];if(r==null)return null}if(typeof r!="function")return null;return r}e.typeByFullName=r;function n(e,t,i){function r(e,t,n){if(!e)return;if($.isArray(e)||e instanceof Date)return;var a=typeof e;if(a=="string"||a=="number")return;if($.isFunction(e)||e.__enum&&e.__register)i(e,t);if(n>3)return;for(var o=0,l=Object.keys(e);o<l.length;o++){var s=l[o];if(s.charAt(0)<"A"||s.charAt(0)>"Z")continue;if(s.indexOf("$")>=0)continue;if(s=="prototype")continue;r(e[s],t+"."+s,n+1)}}for(var n=0,a=t;n<a.length;n++){var o=a[n];if(o==null||!o.length){continue}if(o.indexOf(".")>=0){var l=e;var s=o.split(".");for(var u=0,c=s;u<c.length;u++){var d=c[u];if(!d.length)continue;l=l[d];if(!l)continue}r(l,o,0)}r(e[o],o,0)}}(function(t){t.Q$Externals=e;t.Q$Config=e.Config;t.Q$Culture=e.Culture;t.Q$Lookup=e.Lookup;t.Q$ScriptData=e.ScriptData;t.Q$LT=e.LT;function i(){n(t,e.Config.rootNamespaces,function(e,t){if(e.hasOwnProperty("__typeName")&&!e.__register)return;if(!e.__interfaces&&e.prototype.format&&t.substr(-9)=="Formatter"){e.__class=true;e.__interfaces=[Serenity.ISlickFormatter]}if(!e.__class){var i=ss.getBaseType(e);if(i&&i.__class)e.__class=true}if(e.__class||e.__enum||e.__interface){e.__typeName=t;if(!e.__assembly){e.__assembly=ss.__assemblies["App"]}e.__assembly.__types[t]=e}delete e.__register})}$(function(){i();e.setMobileDeviceMode();$(t).bind("resize",function(){e.setMobileDeviceMode()})})})(window||{})})(Q||(Q={}));var Q;(function(e){var t;(function(t){function i(e){if(e==null)return false;if(e=="*")return true;if(e==""||e=="?")return t.isLoggedIn;var i=t.userDefinition;if(i&&i.IsAdmin)return true;if(i&&i.Permissions){var r=i.Permissions;if(r[e])return true;var n=e.split("|");for(var a=0,o=n;a<o.length;a++){var l=o[a];if(!l)continue;var s=l.split("&");if(!s.length)continue;var u=false;for(var c=0,d=s;c<d.length;c++){var f=d[c];if(!r[f]){u=true;break}}if(!u)return true}}return false}t.hasPermission=i;function r(t){if(!i(t)){e.notifyError(e.text("Authorization.AccessDenied"));throw new Error(e.text("Authorization.AccessDenied"))}}t.validatePermission=r})(t=e.Authorization||(e.Authorization={}));Object.defineProperty(e.Authorization,"userDefinition",{get:function(){return e.getRemoteData("UserData")}});Object.defineProperty(e.Authorization,"isLoggedIn",{get:function(){var e=t.userDefinition;return e&&!!e.Username}});Object.defineProperty(e.Authorization,"username",{get:function(){var e=t.userDefinition;if(e)return e.Username;return null}})})(Q||(Q={}));var Q;(function(e){var t;(function(t){var i;var r=0;var n=0;var a;var o=0;var l=0;t.enabled=true;function s(e,t){return e==t||e==t+"#"||t==e+"#"}function u(e,n,a){if(!t.enabled||r>0)return;e=e||"";e=e.replace(/^#/,"");e=!e?"":"#"+e;var o=window.location.href.replace(/#$/,"").replace(/#.*$/,"")+e;if(o!=window.location.href){if(n&&i!=null&&s(i,o)){if(a)v();var l=window.location.href;i=null;window.history.back();return}if(a)v();i=window.location.href;window.location.hash=e}}t.navigate=u;function c(e,t){u(e,t,true)}t.replace=c;function d(e,i){if(!t.enabled)return;var r=window.location.hash||"";if(r.charAt(0)=="#")r=r.substr(1,r.length-1);var n=r.split("/+/");if(n.length>1){if(e&&e.length){n[n.length-1]=e;e=n.join("/+/")}else{n.splice(n.length-1,1);e=n.join("/+/")}}c(e,i)}t.replaceLast=d;function f(){return $(".ui-dialog-content:visible, .ui-dialog.panel-hidden>.ui-dialog-content, .s-Panel").toArray().sort(function(e,t){return($(e).data("qrouterorder")||0)-($(t).data("qrouterorder")||0)})}function p(t,i,r){var n=[];var a=t.hasClass(".ui-dialog-content")||t.hasClass(".s-Panel");var o=a?t:t.closest(".ui-dialog-content, .s-Panel");var l=r();var s;if(o.length){var u=f();var p=u.indexOf(o[0]);for(var h=0;h<=p;h++){var g=$(u[h]).data("qroute");if(g&&g.length)n.push(g)}if(!a){s=o.attr("id");if(s){s+="_";var y=t.attr("id");if(y&&e.startsWith(y,s))l=y.substr(s.length)+"@"+l}}}else{var y=t.attr("id");if(y&&(!t.hasClass("route-handler")||$(".route-handler").first().attr("id")!=y))l=y+"@"+l}n.push(l);i.data("qroute",l);c(n.join("/+/"));i.bind("dialogclose.qrouter panelclose.qrouter",function(e){i.data("qroute",null);i.unbind(".qrouter");var t=i.data("qprhash");var r=$(e.target).closest(".s-MessageDialog").length>0||e&&e.originalEvent&&(e.originalEvent.type=="keydown"&&e.originalEvent.keyCode==27||$(e.originalEvent.target).hasClass("ui-dialog-titlebar-close")||$(e.originalEvent.target).hasClass("panel-titlebar-close"));if(t!=null)c(t,r);else d("",r)})}function h(e,i,r){if(!t.enabled)return;i.on("dialogopen.qrouter panelopen.qrouter",function(t){p(e,i,r)})}t.dialog=h;function g(i){if(!t.enabled)return;r++;try{i=e.coalesce(e.coalesce(i,window.location.hash),"");if(i.charAt(0)=="#")i=i.substr(1,i.length-1);var n=f();var a=i.split("/+/");var o=n.map(function(e){return $(e).data("qroute")});var l=0;while(l<n.length&&l<a.length&&o[l]==a[l]){l++}for(var s=l;s<n.length;s++){var u=$(n[s]);if(u.hasClass("ui-dialog-content"))u.dialog("close");else if(u.hasClass("s-Panel"))Serenity.TemplatedDialog.closePanel(u)}for(var s=l;s<a.length;s++){var c=a[s];var d=c.split("@");var p;if(d.length==2){var h=s>0?$(n[s-1]):$([]);if(h.length){var g=h.attr("id");if(g){p=$("#"+g+"_"+d[0]);if(p.length){c=d[1]}}}if(!p||!p.length){p=$("#"+d[0]);if(p.length){c=d[1]}}}if(!p||!p.length){p=s>0?$(n[s-1]):$(".route-handler").first()}p.triggerHandler("handleroute",{handled:false,route:c,parts:a,index:s})}}finally{r--}}t.resolve=g;function y(e,t){if(o>0){if((new Date).getTime()-l>1e3){o=0}else{o--;return}}g()}function v(){o++;l=(new Date).getTime()}window.addEventListener("hashchange",y,false);var m=1;$(document).on("dialogopen panelopen",".ui-dialog-content, .s-Panel",function(e,i){if(!t.enabled)return;var r=$(e.target);r.data("qrouterorder",m++);if(r.data("qroute"))return;r.data("qprhash",window.location.hash);var a=$(f).not(r).last();if(!a.length)a=$("html");p(a,r,function(){return"!"+(++n).toString(36)})})})(t=e.Router||(e.Router={}))})(Q||(Q={}));var Serenity;(function(e){var t;(function(e){function t(e){return e.filter(function(t,i){return e.indexOf(t)===i})}function i(e,i){if(!e||!i)return(e||i||[]).slice();return t(e.concat(i))}function r(e,t,r){if(t!=null){e.__typeName=t;e.__assembly=ss.__assemblies["App"];e.__assembly.__types[t]=e}else if(!e.__typeName)e.__register=true;if(r)e.__interfaces=i(e.__interfaces,r)}function n(e,t){return function(i){if(typeof e=="string")r(i,e,t);else r(i,null,e);i.__class=true}}e.registerClass=n;function a(e,t){return function(i){if(typeof e=="string")r(i,e,t);else r(i,null,e);i.__interface=true;i.isAssignableFrom=function(e){return ss.contains(ss.getInterfaces(e),this)}}}e.registerInterface=a;function o(e,t){return n(e,t)}e.registerEditor=o})(t=e.Decorators||(e.Decorators={}))})(Serenity||(Serenity={}));var System;(function(e){var t;(function(e){var t=function(){function e(e){this.displayName=e}e=__decorate([Serenity.Decorators.registerClass("System.DisplayNameAttribute")],e);return e}();e.DisplayNameAttribute=t})(t=e.ComponentModel||(e.ComponentModel={}))})(System||(System={}));(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.ISlickFormatter")],t);return t}();e.ISlickFormatter=t;function i(t){return e.Decorators.registerClass("Serenity."+t+"Attribute")}var r=function(){function e(e){this.category=e}e=__decorate([i("Category")],e);return e}();e.CategoryAttribute=r;var n=function(){function e(e){this.value=e}e=__decorate([i("ColumnsKey")],e);return e}();e.ColumnsKeyAttribute=n;var a=function(){function e(e){this.cssClass=e}e=__decorate([i("CssClass")],e);return e}();e.CssClassAttribute=a;var o=function(){function e(e){this.value=e}e=__decorate([i("DefaultValue")],e);return e}();e.DefaultValueAttribute=o;var l=function(){function e(e){this.value=e}e=__decorate([i("DialogType")],e);return e}();e.DialogTypeAttribute=l;var s=function(){function e(){}e=__decorate([i("Editor")],e);return e}();e.EditorAttribute=s;var u=function(){function e(e,t){this.key=e;this.value=t}e=__decorate([i("EditorOption")],e);return e}();e.EditorOptionAttribute=u;var c=function(){function t(e){this.editorType=e}t.prototype.setParams=function(e){};t=__decorate([e.Decorators.registerClass("Serenity.EditorTypeAttributeBase")],t);return t}();e.EditorTypeAttributeBase=c;var d=function(e){__extends(t,e);function t(t){return e.call(this,t)||this}t=__decorate([i("EditorType")],t);return t}(c);e.EditorTypeAttribute=d;var f=function(){function e(e){this.value=e}e=__decorate([i("Element")],e);return e}();e.ElementAttribute=f;var p=function(){function e(e){this.value=e}e=__decorate([i("EntityType")],e);return e}();e.EntityTypeAttribute=p;var h=function(){function e(e){this.value=e}e=__decorate([i("EnumKey")],e);return e}();e.EnumKeyAttribute=h;var g=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([i("Flexify")],e);return e}();e.FlexifyAttribute=g;var y=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([i("Filterable")],e);return e}();e.FilterableAttribute=y;var v=function(){function e(e){this.value=e}e=__decorate([i("FormKey")],e);return e}();e.FormKeyAttribute=v;var m=function(){function e(e){this.origin=e}e=__decorate([i("GeneratedCode")],e);return e}();e.GeneratedCodeAttribute=m;var b=function(){function e(){}e=__decorate([i("Hidden")],e);return e}();e.HiddenAttribute=b;var C=function(){function e(e){this.hint=e}e=__decorate([i("Hint")],e);return e}();e.HintAttribute=C;var _=function(){function e(e){this.value=e}e=__decorate([i("IdProperty")],e);return e}();e.IdPropertyAttribute=_;var x=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([i("Insertable")],e);return e}();e.InsertableAttribute=x;var S=function(){function e(e){this.value=e}e=__decorate([i("IsActiveProperty")],e);return e}();e.IsActivePropertyAttribute=S;var w=function(){function e(e){this.value=e}e=__decorate([i("ItemName")],e);return e}();e.ItemNameAttribute=w;var T=function(){function e(e){this.value=e}e=__decorate([i("LocalTextPrefix")],e);return e}();e.LocalTextPrefixAttribute=T;var I=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([i("Maximizable")],e);return e}();e.MaximizableAttribute=I;var k=function(){function e(e){this.maxLength=e}e=__decorate([i("MaxLength")],e);return e}();e.MaxLengthAttribute=k;var F=function(){function e(e){this.value=e}e=__decorate([i("NameProperty")],e);return e}();e.NamePropertyAttribute=F;var D=function(){function e(){}e=__decorate([i("OneWay")],e);return e}();e.OneWayAttribute=D;var Q=function(){function e(){}e=__decorate([i("Option")],e);return e}();e.OptionAttribute=Q;var E=function(){function e(e){this.value=e}e=__decorate([i("OptionsType")],e);return e}();e.OptionsTypeAttribute=E;var O=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([i("Panel")],e);return e}();e.PanelAttribute=O;var P=function(){function e(e){this.value=e}e=__decorate([i("Placeholder")],e);return e}();e.PlaceholderAttribute=P;var A=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([i("ReadOnly")],e);return e}();e.ReadOnlyAttribute=A;var N=function(){function e(e){if(e===void 0){e=true}this.isRequired=e}e=__decorate([i("Required")],e);return e}();e.RequiredAttribute=N;var $=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([i("Resizable")],e);return e}();e.ResizableAttribute=$;var R=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([i("Responsive")],e);return e}();e.ResponsiveAttribute=R;var V=function(){function e(e){this.value=e}e=__decorate([i("Service")],e);return e}();e.ServiceAttribute=V;var B=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([i("Updatable")],e);return e}();e.UpdatableAttribute=B})(Serenity||(Serenity={}));(function(e){var t;(function(t){function i(i,r){if(i===void 0){i=[e.ISlickFormatter]}if(r===void 0){r=[e.ISlickFormatter]}return t.registerClass(i,r)}t.registerFormatter=i;function r(e,t){e.__metadata=e.__metadata||{};e.__metadata.attr=e.__metadata.attr||[];e.__metadata.attr.push(t)}t.addAttribute=r;function n(t){return function(i){r(i,new e.DialogTypeAttribute(t))}}t.dialogType=n;function a(t){return function(i){var n=new e.EditorAttribute;if(t!==undefined)n.key=t;r(i,n)}}t.editor=a;function o(t){return function(i){r(i,new e.ElementAttribute(t))}}t.element=o;function l(t){return function(i){r(i,new e.EnumKeyAttribute(t))}}t.enumKey=l;function s(t){if(t===void 0){t=true}return function(i){r(i,new e.FlexifyAttribute(t))}}t.flexify=s;function u(t,i,n){if(!t.__enum){Object.defineProperty(t,"__enum",{get:function(){return true}});t.prototype=t.prototype||{};for(var a=0,o=Object.keys(t);a<o.length;a++){var l=o[a];if(isNaN(Q.parseInteger(l))&&t[l]!=null&&!isNaN(Q.parseInteger(t[l])))t.prototype[l]=t[l]}if(n!=null){t.__typeName=n;t.__assembly=ss.__assemblies["App"];t.__assembly.__types[n]=t}else if(!t.__typeName)t.__register=true;if(i)r(t,new e.EnumKeyAttribute(i))}}t.registerEnum=u;function c(e,t,i){u(e,Q.coalesce(i,t),t)}t.registerEnumType=c;function d(t){if(t===void 0){t=true}return function(i){r(i,new e.FilterableAttribute(t))}}t.filterable=d;function f(t){return function(i){r(i,new e.ItemNameAttribute(t))}}t.itemName=f;function p(t){if(t===void 0){t=true}return function(i){r(i,new e.MaximizableAttribute(t))}}t.maximizable=p;function h(){return function(t,i){var r=Q.startsWith(i,"get_")||Q.startsWith(i,"set_");var n=r?i.substr(4):i;var a=t.constructor;a.__metadata=a.__metadata||{};a.__metadata.members=a.__metadata.members||[];var o=undefined;for(var l=0,s=a.__metadata.members;l<s.length;l++){var u=s[l];if(u.name==n){o=u;break}}if(!o){o={attr:[new e.OptionAttribute],name:n,returnType:Object};if(r){o.type=16;o.getter={name:"get_"+n,type:8,sname:"get_"+n,returnType:Object,params:[]};o.setter={name:"set_"+n,type:8,sname:"set_"+n,returnType:Object,params:[Object]}}else{o.type=4;o.sname=n}a.__metadata.members.push(o)}else{o.attr=o.attr||[];o.attr.push(new e.OptionAttribute)}}}t.option=h;function g(t){return function(i){r(i,new e.OptionsTypeAttribute(t))}}t.optionsType=g;function y(t){if(t===void 0){t=true}return function(i){r(i,new e.PanelAttribute(t))}}t.panel=y;function v(t){if(t===void 0){t=true}return function(i){r(i,new e.ResizableAttribute(t))}}t.resizable=v;function m(t){if(t===void 0){t=true}return function(i){r(i,new e.ResponsiveAttribute(t))}}t.responsive=m;function b(t){return function(i){r(i,new e.ServiceAttribute(t))}}t.service=b})(t=e.Decorators||(e.Decorators={}))})(Serenity||(Serenity={}));var Serenity;(function(e){function t(e){return[e]}e.Criteria=t;(function(e){var t=e;function i(e){return e==null||e.length===0||e.length===1&&typeof e[0]=="string"&&e[0].length===0}e.isEmpty=i;function r(e,i,r){if(t.isEmpty(e))return r;if(t.isEmpty(r))return e;return[e,i,r]}e.join=r;function n(e){return t.isEmpty(e)?e:["()",e]}e.paren=n;function a(e,t){var i=[];for(var n=2;n<arguments.length;n++){i[n-2]=arguments[n]}var a=r(e,"and",t);if(i){for(var o=0,l=i;o<l.length;o++){var s=l[o];a=r(a,"and",s)}}return a}e.and=a;function o(e,t){var i=[];for(var n=2;n<arguments.length;n++){i[n-2]=arguments[n]}var a=r(e,"or",t);if(i){for(var o=0,l=i;o<l.length;o++){var s=l[o];a=r(a,"or",s)}}return a}e.or=o})(t=e.Criteria||(e.Criteria={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(e,t){var i=this;this.include={};this.grid=e;this.idField=e.getView().idField;this.options=t||{};e.getGrid().onClick.subscribe(function(t,r){if($(t.target).hasClass("select-item")){t.preventDefault();var n=e.getView().getItem(r.row);var a=n[i.idField].toString();if(i.include[a]){delete i.include[a]}else{i.include[a]=true}for(var o=0;o<e.getView().getLength();o++){e.getGrid().updateRow(o)}i.updateSelectAll()}});e.getGrid().onHeaderClick.subscribe(function(t,r){if(t.isDefaultPrevented()){return}if($(t.target).hasClass("select-all-items")){t.preventDefault();var n=e.getView();if(Object.keys(i.include).length>0){ss.clearKeys(i.include)}else{var a=e.getView().getItems();for(var o=0,l=a.filter(i.isSelectable.bind(i));o<l.length;o++){var s=l[o];var u=s[i.idField];i.include[u]=true}}i.updateSelectAll();e.getView().setItems(e.getView().getItems(),true)}});e.getView().onRowsChanged.subscribe(function(){return i.updateSelectAll()})}t.prototype.updateSelectAll=function(){var e=this.grid.getElement().find(".select-all-header .slick-column-name .select-all-items");if(e){var t=Object.keys(this.include);e.toggleClass("checked",t.length>0&&this.grid.getView().getItems().filter(this.isSelectable.bind(this)).length<=t.length)}};t.prototype.clear=function(){ss.clearKeys(this.include);this.updateSelectAll()};t.prototype.resetCheckedAndRefresh=function(){this.include={};this.updateSelectAll();this.grid.getView().populate()};t.prototype.selectKeys=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this.include[r]=true}this.updateSelectAll()};t.prototype.getSelectedKeys=function(){return Object.keys(this.include)};t.prototype.getSelectedAsInt32=function(){return Object.keys(this.include).map(function(e){return parseInt(e,10)})};t.prototype.getSelectedAsInt64=function(){return Object.keys(this.include).map(function(e){return parseInt(e,10)})};t.prototype.setSelectedKeys=function(e){this.clear();for(var t=0,i=e;t<i.length;t++){var r=i[t];this.include[r]=true}this.updateSelectAll()};t.prototype.isSelectable=function(e){return e&&(this.options.selectable==null||this.options.selectable(e))};t.createSelectColumn=function(e){return{name:'<span class="select-all-items check-box no-float "></span>',toolTip:" ",field:"__select__",width:26,minWidth:26,headerCssClass:"select-all-header",sortable:false,format:function(t){var i=t.item;var r=e();if(!r||!r.isSelectable(i)){return""}var n=r.include[t.item[r.idField]];return'<span class="select-item check-box no-float '+(n?" checked":"")+'"></span>'}}};t=__decorate([e.Decorators.registerClass("Serenity.GridRowSelectionMixin")],t);return t}();e.GridRowSelectionMixin=t;var i=function(){function t(e){var t=this;this.include={};this.grid=e;this.idField=e.getView().idField;e.getGrid().onClick.subscribe(function(i,r){if($(i.target).hasClass("rad-select-item")){i.preventDefault();var n=e.getView().getItem(r.row);var a=n[t.idField].toString();if(t.include[a]==true){ss.clearKeys(t.include)}else{ss.clearKeys(t.include);t.include[a]=true}for(var o=0;o<e.getView().getLength();o++){e.getGrid().updateRow(o)}}})}t.prototype.clear=function(){ss.clearKeys(this.include)};t.prototype.resetCheckedAndRefresh=function(){this.include={};this.grid.getView().populate()};t.prototype.getSelectedKey=function(){var e=Object.keys(this.include);if(e!=null&&e.length>0){return e[0]}return null};t.prototype.getSelectedAsInt32=function(){var e=Object.keys(this.include).map(function(e){return parseInt(e,10)});if(e!=null&&e.length>0){return e[0]}return null};t.prototype.getSelectedAsInt64=function(){var e=Object.keys(this.include).map(function(e){return parseInt(e,10)});if(e!=null&&e.length>0){return e[0]}return null};t.prototype.setSelectedKey=function(e){this.clear();this.include[e]=true};t.createSelectColumn=function(e){return{name:"",toolTip:" ",field:"__select__",width:26,minWidth:26,headerCssClass:"",sortable:false,formatter:function(t,i,r,n,a){var o=e();if(!o){return""}var l=o.include[a[o.idField]];return'<input type="radio" name="radio-selection-group" class="rad-select-item no-float" style="cursor: pointer;width: 13px; height:13px;" '+(l?" checked":"")+" /> "}}};t=__decorate([e.Decorators.registerClass("Serenity.GridRadioSelectionMixin")],t);return t}();e.GridRadioSelectionMixin=i;var r;(function(t){function i(t,i){var r=t.element.children(".s-Toolbar");if(r.length===0){return}var n=r.getWidget(e.Toolbar).findButton("select-all-button");var a=t.getView().getItems();n.toggleClass("checked",a.length>0&&!a.some(function(e){return!i(e)}))}t.update=i;function r(t,i,r,n,a,o){if(a==null){a=Q.coalesce(Q.tryGetText("Controls.CheckTreeEditor.SelectAll"),"Select All")}return{title:a,cssClass:"select-all-button",onClick:function(){var r=t();var a=r.getView();var l=r.element.children(".s-Toolbar").getWidget(e.Toolbar).findButton("select-all-button");var s=!l.hasClass("checked");a.beginUpdate();try{for(var u=0,c=a.getItems();u<c.length;u++){var d=c[u];n(d,s);a.updateItem(i(d),d)}o&&o()}finally{a.endUpdate()}l.toggleClass("checked",s)}}}t.define=r})(r=e.GridSelectAllButtonHelper||(e.GridSelectAllButtonHelper={}));var n;(function(t){function i(e,t,i,r,n){var a=$('<div><a href="#"></a></div>').addClass("s-ToggleButton").addClass(t).prependTo(e);a.children("a").click(function(e){e.preventDefault();a.toggleClass("pressed");var t=a.hasClass("pressed");i&&i(t)}).attr("title",Q.coalesce(r,""));if(n){a.addClass("pressed")}}t.addToggleButton=i;function r(e,t,r,n){var a=false;var o=t.onSubmit;t.onSubmit=function(e){e.params.IncludeDeleted=a;if(o!=null){return o(e)}return true};if(r==null)r=Q.text("Controls.EntityGrid.IncludeDeletedToggle");i(e,"s-IncludeDeletedToggle",function(e){a=e;t.seekToPage=1;t.populate()},r,n);e.bind("remove",function(){t.onSubmit=null;o=null})}t.addIncludeDeletedToggle=r;function n(e,t,i){var r=t.onSubmit;var n="";var o="";t.onSubmit=function(e){if(n!=null&&n.length>0){e.params.ContainsText=n}else{delete e.params["ContainsText"]}if(o!=null&&o.length>0){e.params.ContainsField=o}else{delete e.params["ContainsField"]}if(r!=null)return r(e);return true};var l=null;a(e,function(e,i,r){n=i;o=e;t.seekToPage=1;l=r;t.populate()},i);t.onDataLoaded.subscribe(function(e,i){if(l!=null){l(t.getLength()>0);l=null}})}t.addQuickSearchInput=n;function a(t,i,r){var n=$('<div><input type="text"/></div>').addClass("s-QuickSearchBar").prependTo(t);if(r!=null&&r.length>0){n.addClass("has-quick-search-fields")}new e.QuickSearchInput(n.children(),{fields:r,onSearch:i})}t.addQuickSearchInputCustom=a;function o(e,t){var i=new Slick.RowMoveManager({cancelEditOnDrag:true});i.onBeforeMoveRows.subscribe(function(e,t){for(var i=0;!!(i<t.rows.length);i++){if(!!(t.rows[i]===t.insertBefore||t.rows[i]===t.insertBefore-1)){e.stopPropagation();return false}}return true});i.onMoveRows.subscribe(function(i,r){t(r.rows,r.insertBefore);try{e.setSelectedRows([])}catch(n){}});e.registerPlugin(i)}t.makeOrderable=o;function l(e,t,i,r,n){o(e.slickGrid,function(a,o){if(a.length===0){return}var l;var s=o;if(s<0){l=1}else if(o>=e.rowCount()){l=Q.coalesce(i(e.itemAt(e.rowCount()-1)),0);if(l===0){l=o+1}else{l=l+1}}else{l=Q.coalesce(i(e.itemAt(o)),0);if(l===0){l=o+1}}var u=0;var c=null;c=function(){Q.serviceCall({service:r,request:n(t(e.itemAt(a[u])),l++),onSuccess:function(t){u++;if(u<a.length){c()}else{e.view.populate()}}})};c()})}t.makeOrderableWithUpdateRequest=l})(n=e.GridUtils||(e.GridUtils={}));var a;(function(t){function i(e){var t=[];if(e==null){return t}for(var i=0;i<e.length;i++){t.push(r(e[i]))}return t}t.toSlickColumns=i;function r(t){var i={field:t.name,sourceItem:t,cssClass:t.cssClass,headerCssClass:t.headerCssClass,sortable:t.sortable!==false,sortOrder:Q.coalesce(t.sortOrder,0),width:t.width!=null?t.width:80,minWidth:Q.coalesce(t.minWidth,30),maxWidth:t.maxWidth==null||t.maxWidth===0?null:t.maxWidth,resizable:t.resizable==null||!!t.resizable};i.visible=t.visible!==false&&t.filterOnly!==true&&(t.readPermission==null||Q.Authorization.hasPermission(t.readPermission));var r=Q.tryGetText(t.title);if(r==null)r=t.title;i.name=r;if(t.alignment!=null&&t.alignment.length>0){if(!Q.isEmptyOrNull(i.cssClass)){i.cssClass+=" align-"+t.alignment}else{i.cssClass="align-"+t.alignment}}if(t.formatterType!=null&&t.formatterType.length>0){var n=ss.cast(ss.createInstance(e.FormatterTypeRegistry.get(t.formatterType)),e.ISlickFormatter);if(t.formatterParams!=null){e.ReflectionOptionsSetter.set(n,t.formatterParams)}var a=ss.safeCast(n,e.IInitializeColumn);if(a!=null){a.initializeColumn(i)}i.format=function(e){return n.format(e)}}return i}t.toSlickColumn=r})(a=e.PropertyItemSlickConverter||(e.PropertyItemSlickConverter={}));var o;(function(t){function i(t,i){return e.EnumFormatter.getText(t,i)}t.getEnumText=i;function r(e,t,i){return function(r){var n=i(r);var a=e();var o=Q.coalesce(r.item._indent,0);var l='<span class="s-TreeIndent" style="width:'+15*o+'px"></span>';var s=t(r.item);var u=a.getIdxById(s);var c=a.getItemByIdx(u+1);if(c!=null){var d=Q.coalesce(c._indent,0);if(d>o){if(!!!!r.item._collapsed){return l+'<span class="s-TreeToggle s-TreeExpand"></span>'+n}else{return l+'<span class="s-TreeToggle s-TreeCollapse"></span>'+n}}}return l+'<span class="s-TreeToggle"></span>'+n}}t.treeToggle=r;function n(t){if(t==null){t=Q.Culture.dateFormat}return function(i){return Q.htmlEncode(e.DateFormatter.format(i.value,t))}}t.date=n;function a(t){if(t==null){t=Q.Culture.dateTimeFormat}return function(i){return Q.htmlEncode(e.DateFormatter.format(i.value,t))}}t.dateTime=a;function o(){return function(e){return'<span class="check-box no-float '+(!!e.value?" checked":"")+'"></span>'}}t.checkBox=o;function l(t){return function(i){return e.NumberFormatter.format(i.value,t)}}t.number=l;function s(e){return e.data("item-type")}t.getItemType=s;function u(e){var t=e.data("item-id");return t==null?null:t.toString()}t.getItemId=u;function c(e,t,i,r,n){return"<a"+(t!=null?' href="#'+Q.replaceAll(e,".","-")+"/"+t+'"':"")+' data-item-type="'+Q.attrEncode(e)+'"'+' data-item-id="'+Q.attrEncode(t)+'"'+' class="s-EditLink s-'+Q.replaceAll(e,".","-")+"Link"+(Q.isEmptyOrNull(r)?"":" "+r)+'">'+(n?Q.htmlEncode(Q.coalesce(i,"")):Q.coalesce(i,""))+"</a>"}t.itemLinkText=c;function d(e,t,i,r,n){return function(a){return c(e,a.item[t],i==null?a.value:i(a),r==null?"":r(a),n)}}t.itemLink=d})(o=e.SlickFormatting||(e.SlickFormatting={}));var l;(function(e){function t(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r];a.sortable=a.sortable!=null?a.sortable:true;var o=a.id;if(o==null){o=a.field}a.id=o;if(t!=null&&a.id!=null&&(a.name==null||Q.startsWith(a.name,"~"))){var l=a.name!=null?a.name.substr(1):a.id;a.name=Q.text(t+l)}if(a.formatter==null&&a.format!=null){a.formatter=i(a.format)}else if(a.formatter==null){a.formatter=function(e,t,i,r,n){return Q.htmlEncode(i)}}}return e}e.setDefaults=t;function i(e){if(e==null){return null}else{return function(t,i,r,n,a){return e({row:t,cell:i,value:r,column:n,item:a})}}}e.convertToFormatter=i})(l=e.SlickHelper||(e.SlickHelper={}));var s;(function(e){function t(e,t){var i=t(e);var r=0;while(i!=null){if(!!i._collapsed){return false}i=t(i);if(r++>1e3){throw new ss.InvalidOperationException("Possible infinite loop, check parents has no circular reference!")}}return true}e.filterCustom=t;function i(e,i,r){return t(e,function(e){var t=r(e);if(t==null){return null}return i.getItemById(t)})}e.filterById=i;function r(e,t){if(e!=null){for(var i=0,r=e;i<r.length;i++){var n=r[i];n._collapsed=t}}}e.setCollapsed=r;function n(e,t){e._collapsed=t}e.setCollapsedFlag=n;function a(e,t,i,r){var n=0;var a={};for(var o=0;o<e.length;o++){var l=e[o];if(o>0){var s=i(l);if(s!=null&&s===t(e[o-1])){n+=1}else if(s==null){n=0}else if(s!==i(e[o-1])){if(a[s]!=null){n=a[s]+1}else{n=0}}}a[t(l)]=n;l._indent=n;if(r!=null){l._collapsed=r}}}e.setIndents=a;function o(e,t,i,n,a){var o=$(e.target);if(!o.hasClass("s-TreeToggle")){return}if(o.hasClass("s-TreeCollapse")||o.hasClass("s-TreeExpand")){var l=n.getItem(t);if(l!=null){if(!!!l._collapsed){l._collapsed=true}else{l._collapsed=false}n.updateItem(a(l),l)}if(e.shiftKey){n.beginUpdate();try{r(n.getItems(),!!l._collapsed);n.setItems(n.getItems(),true)}finally{n.endUpdate()}}}}e.toggleClick=o})(s=e.SlickTreeHelper||(e.SlickTreeHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=0;function i(e,i){t++;var r="ExecuteOnceWhenShown"+t;var n=false;if(e.is(":visible")){i()}else{var a=e.closest(".ui-tabs");if(a.length>0){a.bind("tabsactivate."+r,function(t){if(e.is(":visible")){a.unbind("tabsactivate."+r);if(!n){n=true;e.unbind("shown."+r);i()}}})}var o=e.closest(".nav-tabs");if(o.length>0){o.one("shown.bs.tab",function(t){if(!n&&e.is(":visible")){n=true;i()}})}var l;if(e.hasClass("ui-dialog")){l=e.children(".ui-dialog-content")}else{l=e.closest(".ui-dialog-content, .s-TemplatedDialog")}if(l.length>0){l.bind("dialogopen."+r+" panelopen."+r,function(){l.unbind("dialogopen."+r);l.unbind("panelopen."+r);if(e.is(":visible")&&!n){n=true;e.unbind("shown."+r);i()}})}e.bind("shown."+r,function(){if(e.is(":visible")){e.unbind("shown."+r);if(!n){n=true;i()}}})}}e.executeOnceWhenShown=i;function r(e,i,r){t++;var n="ExecuteEverytimeWhenShown"+t;var a=e.is(":visible");if(a&&r){i()}var o=function(t){if(e.is(":visible")){if(!a){a=true;i()}}else{a=false}};var l=e.closest(".ui-tabs");if(l.length>0){l.bind("tabsactivate."+n,o)}var s=e.closest(".ui-dialog-content, .s-TemplatedDialog");if(s.length>0){s.bind("dialogopen."+n+" panelopen."+n,o)}e.bind("shown."+n,o)}e.executeEverytimeWhenShown=r})(t=e.LazyLoadHelper||(e.LazyLoadHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e,t,i,r){var n=t.widgetName;e.element.bind("ondatachange."+n,function(e,t){if(r){window.setTimeout(function(){i(e,t)},0)}else{i(e,t)}}).bind("remove."+n,function(){e.element.unbind("ondatachange."+n)});return e}e.bindToDataChange=t;function i(e){e.element.triggerHandler("ondatachange");return e}e.triggerDataChange=i;function r(e){e.triggerHandler("ondatachange");return e}e.triggerDataChanged=r;function n(e,i,r){return t(e,i,function(e,t){i.element.triggerHandler("ondatachange")},r)}e.bubbleDataChange=n;function a(e,t){e.element.one("dialogopen",function(i){e.element.dialog().dialog("option","position",o(t))});return e}e.cascade=a;function o(e){return{my:"left top",at:"left+20 top+20",of:e[0]}}e.cascadedDialogOffset=o})(t=e.SubDialogHelper||(e.SubDialogHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e,t,i){if(!e)return;var r=n(e);if(!r)return;var a=r[t];if(a==null){return}if(i&&a===e.tabs("option","active")){e.tabs("option","active",0)}e.tabs(i?"disable":"enable",a)}e.setDisabled=t;function i(e,t,i){if(!e)return;var r=n(e);if(!r)return;var a=r[t];if(a==null){return}if(!i&&a===e.tabs("option","active")){e.tabs("option","active",0)}e.children("ul").children("li").eq(a).toggle(i)}e.toggle=i;function r(e){var t=e.children("ul").children("li").eq(e.tabs("option","active")).children("a").attr("href").toString();var i="_Tab";var r=t.lastIndexOf(i);if(r>=0){t=t.substr(r+i.length)}return t}e.activeTabKey=r;function n(e){var t=e.data("indexByKey");if(!t){t={};e.children("ul").children("li").children("a").each(function(e,i){var r=i.getAttribute("href").toString();var n="_Tab";var a=r.lastIndexOf(n);if(a>=0){r=r.substr(a+n.length)}t[r]=e});e.data("indexByKey",t)}return t}e.indexByKey=n;function a(e,t){var i=n(e);if(!i)return;var r=i[t];if(r==null){return}if(r!==e.tabs("option","active")){e.tabs("option","active",r)
}}e.selectTab=a})(t=e.TabsExtensions||(e.TabsExtensions={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e){e.container.addClass("fileinput-button");var t=$("<input/>").attr("type","file").attr("name",e.inputName+"[]").attr("data-url",Q.resolveUrl("~/File/TemporaryUpload")).attr("multiple","multiple").appendTo(e.container);if(e.allowMultiple){t.attr("multiple","multiple")}t.fileupload({dataType:"json",dropZone:e.zone,pasteZone:e.zone,done:function(t,i){var r=i.result;if(e.fileDone!=null){e.fileDone(r,i.files[0].name,i)}},start:function(){Q.blockUI(null);if(e.progress!=null){e.progress.show()}},stop:function(){Q.blockUndo();if(e.progress!=null){e.progress.hide()}},progress:function(t,i){if(e.progress!=null){var r=i.loaded/i.total*100;e.progress.children().css("width",r.toString()+"%")}}});return t}e.addUploadInput=t;function i(t,i){if(!t.IsImage&&!i.allowNonImage){Q.alert(Q.text("Controls.ImageUpload.NotAnImageFile"));return false}if(i.minSize>0&&t.Size<i.minSize){Q.alert(Q.format(Q.text("Controls.ImageUpload.UploadFileTooSmall"),e.fileSizeDisplay(i.minSize)));return false}if(i.maxSize>0&&t.Size>i.maxSize){Q.alert(Q.format(Q.text("Controls.ImageUpload.UploadFileTooBig"),e.fileSizeDisplay(i.maxSize)));return false}if(!t.IsImage){return true}if(i.minWidth>0&&t.Width<i.minWidth){Q.alert(Q.format(Q.text("Controls.ImageUpload.MinWidth"),i.minWidth));return false}if(i.maxWidth>0&&t.Width>i.maxWidth){Q.alert(Q.format(Q.text("Controls.ImageUpload.MaxWidth"),i.maxWidth));return false}if(i.minHeight>0&&t.Height<i.minHeight){Q.alert(Q.format(Q.text("Controls.ImageUpload.MinHeight"),i.minHeight));return false}if(i.maxHeight>0&&t.Height>i.maxHeight){Q.alert(Q.format(Q.text("Controls.ImageUpload.MaxHeight"),i.maxHeight));return false}return true}e.checkImageConstraints=i;function r(e,t){return e+" ("+n(t)+")"}e.fileNameSizeDisplay=r;function n(e){var t=ss.round(e*100/1024)*.01;var i="KB";if(t>=1024){t=ss.round(t*100/1024)*.01;i="MB"}var r=t.toString().split(String.fromCharCode(46));var n;if(r.length>1){n=r[0]+"."+r[1].substr(0,2)}else{n=r[0]}return n+" "+i}e.fileSizeDisplay=n;function a(e){if(Q.isEmptyOrNull(e)){return false}e=e.toLowerCase();return Q.endsWith(e,".jpg")||Q.endsWith(e,".jpeg")||Q.endsWith(e,".gif")||Q.endsWith(e,".png")}e.hasImageExtension=a;function o(e){e=Q.coalesce(e,"");var t=e.lastIndexOf(".");if(t>=0){e=e.substr(0,t)}return e+"_t.jpg"}e.thumbFileName=o;function l(e){e=Q.replaceAll(Q.coalesce(e,""),"\\","/");return Q.resolveUrl("~/upload/")+e}e.dbFileUrl=l;function s(e,t){e.colorbox({current:Q.text("Controls.ImageUpload.ColorboxCurrent"),previous:Q.text("Controls.ImageUpload.ColorboxPrior"),next:Q.text("Controls.ImageUpload.ColorboxNext"),close:Q.text("Controls.ImageUpload.ColorboxClose")})}e.colorBox=s;function u(e,t,i,r){t=t||[];e.html("");for(var n=0;n<t.length;n++){var u=t[n];var c=$("<li/>").addClass("file-item").data("index",n);var d=a(u.Filename);if(d){c.addClass("file-image")}else{c.addClass("file-binary")}var f="#"+n;var p=$("<a/>").addClass("thumb").appendTo(c);var h=Q.coalesce(u.OriginalName,"");var g=u.Filename;if(r!=null&&g!=null&&!Q.startsWith(g,"temporary/")){g=r+g}p.attr("href",l(g));p.attr("target","_blank");if(!Q.isEmptyOrNull(h)){p.attr("title",h)}if(d){p.css("backgroundImage","url('"+l(o(u.Filename))+"')");s(p,new Object)}if(i){$("<div/>").addClass("filename").text(h).attr("title",h).appendTo(c)}c.appendTo(e)}}e.populateFileSymbols=u})(t=e.UploadHelper||(e.UploadHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IAsyncInit")],t);return t}();e.IAsyncInit=t;if(typeof React==="undefined"){if(window["preact"]!=null){window["React"]=window["ReactDOM"]=window["preact"];React.Fragment=Q.coalesce(React.Fragment,"x-fragment")}else if(window["Nerv"]!=null){window["React"]=window["ReactDOM"]=window["Nerv"];React.Fragment=Q.coalesce(React.Fragment,"x-fragment")}else{window["React"]={Component:function(){},Fragment:"x-fragment",createElement:function(){return{_reactNotLoaded:true}}};window["ReactDOM"]={render:function(){throw Error("To use React, it should be included before Serenity.CoreLib.js")}}}}var i=function(t){__extends(i,t);function i(e,i){var n=t.call(this,i)||this;n.element=e;n.options=i||{};n.widgetName=r.getWidgetName(ss.getInstanceType(n));n.uniqueName=n.widgetName+(r.nextWidgetNumber++).toString();if(e.data(n.widgetName)){throw new ss.Exception(Q.format("The element already has widget '{0}'!",n.widgetName))}e.bind("remove."+n.widgetName,function(e){if(e.bubbles||e.cancelable){return}n.destroy()}).data(n.widgetName,n);n.addCssClass();if(n.isAsyncWidget()){window.setTimeout(function(){if(e&&!n.asyncPromise){n.asyncPromise=n.initializeAsync()}},0)}return n}r=i;i.prototype.destroy=function(){this.element.removeClass("s-"+ss.getTypeName(ss.getInstanceType(this)));this.element.unbind("."+this.widgetName).unbind("."+this.uniqueName).removeData(this.widgetName);this.element=null;this.asyncPromise=null};i.prototype.addCssClass=function(){this.element.addClass(this.getCssClass())};i.prototype.getCssClass=function(){var e=ss.getInstanceType(this);var t="s-"+ss.getTypeName(e);var i=Q.replaceAll(ss.getTypeFullName(e),".","-");for(var r=0,n=Q.Config.rootNamespaces;r<n.length;r++){var a=n[r];if(Q.startsWith(i,a+"-")){i=i.substr(a.length+1);break}}i="s-"+i;if(t===i){return t}return t+" "+i};i.prototype.initializeAsync=function(){return Promise.resolve()};i.prototype.isAsyncWidget=function(){return ss.isInstanceOfType(this,e.IAsyncInit)};i.getWidgetName=function(e){return Q.replaceAll(ss.getTypeFullName(e),".","_")};i.elementFor=function(t){var i=ss.getAttributes(t,e.ElementAttribute,true);var r=i.length>0?i[0].value:"<input/>";return $(r)};i.create=function(t){var i;if(ss.isAssignableFrom(e.IDialog,t.type)){i=new t.type(t.options);if(t.container)i.element.appendTo(t.container);t.element&&t.element(i.element)}else{var n=r.elementFor(t.type);if(t.container)n.appendTo(t.container);t.element&&t.element(n);i=new t.type(n,t.options)}if(i.isAsyncWidget())i.init(t.init);else{i.init(null);t.init&&t.init(i)}return i};i.prototype.init=function(e){var t=this;var i=this.initialize();if(e){i.then(function(){return e(t)})}return this};i.prototype.initialize=function(){if(!this.isAsyncWidget()){return Promise.resolve()}if(!this.asyncPromise){this.asyncPromise=this.initializeAsync()}return this.asyncPromise};var r;i.nextWidgetNumber=0;i.__isWidgetType=true;i=r=__decorate([e.Decorators.registerClass()],i);return i}(React.Component);e.Widget=i;i.prototype.addValidationRule=function(t,i){return e.VX.addValidationRule(this.element,t,i)}})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e,t,i){var r=e.validate();var n=r.settings;if(n.abortHandler){return false}if(t!=null&&t()===false){return false}n["abortHandler"]=Q.validatorAbortHandler;n["submitHandler"]=function(){if(i!=null){i()}return false};e.trigger("submit");return true}e.asyncSubmit=t;function i(e,t,i){var r=e.validate();var n=r.settings;if(n.abortHandler!=null){return false}if(t!=null&&t()===false){return false}if(!r.form()){return false}if(i!=null){i()}return true}e.submit=i;function r(e){var t=e.closest("form");if(t.length===0){return null}return t.data("validator")}e.getValidator=r})(t=e.ValidationHelper||(e.ValidationHelper={}));var i;(function(e){function t(e,t,i){if(e.length===0){return e}if(i==null){throw new ss.Exception("rule is null!")}e.addClass("customValidate").bind("customValidate."+t,i);return e}e.addValidationRule=t;function i(e,t){e.unbind("customValidate."+t);return e}e.removeValidationRule=i;function r(e,t){return e.element(t.element[0])}e.validateElement=r})(i=e.VX||(e.VX={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.idPrefix=r.uniqueName+"_";var n=r.getTemplate().replace(new RegExp("~_","g"),r.idPrefix);var a=0;while(true){var o=n.indexOf('{{text:"',a);if(o<0)break;var a=n.indexOf('"}}',o);if(a<0)break;var l=n.substr(o+8,a-o-8);var s=Q.text(l);n=n.substr(0,o)+s+n.substr(a+3);a=o+s.length}r.element.html(n);return r}r=i;i.prototype.byId=function(e){return $("#"+this.idPrefix+e)};i.prototype.byID=function(t,i){return e.WX.getWidget(this.byId(t),i)};i.noGeneric=function(e){var t=e.indexOf("$");if(t>=0){return e.substr(0,t)}return e};i.prototype.getDefaultTemplateName=function(){return r.noGeneric(ss.getTypeName(ss.getInstanceType(this)))};i.prototype.getTemplateName=function(){var t=ss.getInstanceType(this);var i=ss.getTypeFullName(t);var n=r.templateNames;var a=r.templateNames[i];if(a!=null){return a}while(t&&t!==e.Widget){var o=r.noGeneric(ss.getTypeFullName(t));for(var l=0,s=Q.Config.rootNamespaces;l<s.length;l++){var u=s[l];if(Q.startsWith(o,u+".")){o=o.substr(u.length+1);break}}if(Q.canLoadScriptData("Template."+o)){n[i]=o;return o}o=Q.replaceAll(o,".","_");if(Q.canLoadScriptData("Template."+o)||$("script#Template_"+o).length>0){n[i]=o;return o}o=r.noGeneric(ss.getTypeName(t));if(Q.canLoadScriptData("Template."+o)||$("script#Template_"+o).length>0){r.templateNames[i]=o;return o}t=ss.getBaseType(t)}n[i]=a=this.getDefaultTemplateName();return a};i.prototype.getFallbackTemplate=function(){return null};i.prototype.getTemplate=function(){var e=this.getTemplateName();var t=$("script#Template_"+e);if(t.length>0){return t.html()}var i;if(!Q.canLoadScriptData("Template."+e)&&this.getDefaultTemplateName()==e){i=this.getFallbackTemplate();if(i!=null)return i}i=Q.getTemplate(e);if(i==null){throw new Error(Q.format("Can't locate template for widget '{0}' with name '{1}'!",ss.getTypeName(ss.getInstanceType(this)),e))}return i};var r;i.templateNames={};i=r=__decorate([e.Decorators.registerClass()],i);return i}(e.Widget);e.TemplatedWidget=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.IBooleanValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.IDoubleValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.IGetEditValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.ISetEditValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.IStringValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IReadOnly")],t);return t}();e.IReadOnly=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){e[e["Disabled"]=-1]="Disabled";e[e["None"]=0]="None";e[e["Sum"]=1]="Sum";e[e["Avg"]=2]="Avg";e[e["Min"]=3]="Min";e[e["Max"]=4]="Max"})(t=e.SummaryType||(e.SummaryType={}));e.Decorators.registerEnum(t,"Serenity.SummaryType")})(Serenity||(Serenity={}));var Serenity;(function(e){var t=e.Decorators.option;var i=function(i){__extends(r,i);function r(t){var r=i.call(this,t)||this;t.addClass("dateQ");t.datepicker({showOn:"button",beforeShow:function(e,i){return!t.hasClass("readonly")},yearRange:Q.coalesce(r.yearRange,"-100:+50")});t.bind("keyup."+r.uniqueName,function(t){if(t.which===32&&!r.get_readOnly()){if(r.get_valueAsDate()!=ss.today()){r.set_valueAsDate(ss.today());r.element.trigger("change")}}else{e.DateEditor.dateInputKeyup(t)}});t.bind("change."+r.uniqueName,e.DateEditor.dateInputChange);e.VX.addValidationRule(t,r.uniqueName,function(e){var t=r.get_value();if(Q.isEmptyOrNull(t)){return null}if(!Q.isEmptyOrNull(r.get_minValue())&&ss.compareStrings(t,r.get_minValue())<0){return Q.format(Q.text("Validation.MinDate"),Q.formatDate(r.get_minValue(),null))}if(!Q.isEmptyOrNull(r.get_maxValue())&&ss.compareStrings(t,r.get_maxValue())>=0){return Q.format(Q.text("Validation.MaxDate"),Q.formatDate(r.get_maxValue(),null))}return null});r.set_sqlMinMax(true);return r}r.prototype.get_value=function(){var e=this.element.val().trim();if(e!=null&&e.length===0){return null}return Q.formatDate(e,"yyyy-MM-dd")};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){if(e==null){this.element.val("")}else if(e.toLowerCase()==="today"||e.toLowerCase()==="now"){this.element.val(Q.formatDate(ss.today(),null))}else{this.element.val(Q.formatDate(e,null))}};r.prototype.get_valueAsDate=function(){if(Q.isEmptyOrNull(this.get_value())){return null}return Q.parseISODateTime(this.get_value())};Object.defineProperty(r.prototype,"valueAsDate",{get:function(){return this.get_valueAsDate()},set:function(e){this.set_valueAsDate(e)},enumerable:true,configurable:true});r.prototype.set_valueAsDate=function(e){if(e==null){this.set_value(null)}this.set_value(Q.formatDate(e,"yyyy-MM-dd"))};r.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};r.prototype.set_readOnly=function(e){if(e!==this.get_readOnly()){if(e){this.element.addClass("readonly").attr("readonly","readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1")}else{this.element.removeClass("readonly").removeAttr("readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","1")}}};r.prototype.get_minValue=function(){return this.minValue};r.prototype.set_minValue=function(e){this.minValue=e};r.prototype.get_maxValue=function(){return this.maxValue};r.prototype.set_maxValue=function(e){this.maxValue=e};r.prototype.get_minDate=function(){return Q.parseISODateTime(this.get_minValue())};r.prototype.set_minDate=function(e){this.set_minValue(Q.formatDate(e,"yyyy-MM-dd"))};r.prototype.get_maxDate=function(){return Q.parseISODateTime(this.get_maxValue())};r.prototype.set_maxDate=function(e){this.set_maxValue(Q.formatDate(e,"yyyy-MM-dd"))};r.prototype.get_sqlMinMax=function(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"};r.prototype.set_sqlMinMax=function(e){if(e){this.set_minValue("1753-01-01");this.set_maxValue("9999-12-31")}else{this.set_minValue(null);this.set_maxValue(null)}};r.dateInputKeyup=function(e){if(Q.Culture.dateOrder!=="dmy"){return}var t=$(e.target);if(!t.is(":input")){return}if(t.is("[readonly]")||t.is(":disabled")){return}var i=Q.coalesce(t.val(),"");if(!!(i.length===0||t[0].selectionEnd!==i.length)){return}if(i.indexOf(Q.Culture.dateSeparator+Q.Culture.dateSeparator)!==-1){t.val(Q.replaceAll(i,Q.Culture.dateSeparator+Q.Culture.dateSeparator,Q.Culture.dateSeparator));return}function r(e){return e>=48&&e<=57}if(e.which===47||e.which===111){if(i.length>=2&&i.charAt(i.length-1)===Q.Culture.dateSeparator&&i.charAt(i.length-2)===Q.Culture.dateSeparator){t.val(i.substr(0,i.length-1));return}if(i.charAt(i.length-1)!==Q.Culture.dateSeparator){return}switch(i.length){case 2:{if(r(i.charCodeAt(0))){i="0"+i;break}else{return}}case 4:{if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&i.charAt(1)==Q.Culture.dateSeparator){i="0"+i.charAt(0)+Q.Culture.dateSeparator+"0"+i.charAt(2)+Q.Culture.dateSeparator;break}else{return}}case 5:{if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&r(i.charCodeAt(3))&&i.charAt(1)===Q.Culture.dateSeparator){i="0"+i;break}else if(r(i.charCodeAt(0))&&r(i.charCodeAt(1))&&r(i.charCodeAt(3))&&i.charAt(2)===Q.Culture.dateSeparator){i=i.charAt(0)+i.charAt(1)+Q.Culture.dateSeparator+"0"+i.charAt(3)+Q.Culture.dateSeparator;break}else{break}}default:{return}}t.val(i)}if(i.length<6&&(e.which>=48&&e.which<=57||e.which>=96&&e.which<=105)&&r(i.charCodeAt(i.length-1))){switch(i.length){case 1:{if(i.charCodeAt(0)<=51){return}i="0"+i;break}case 2:{if(!r(i.charCodeAt(0))){return}break}case 3:{if(!r(i.charCodeAt(0))||i.charAt(1)!==Q.Culture.dateSeparator||i.charCodeAt(2)<=49){return}i="0"+i.charAt(0)+Q.Culture.dateSeparator+"0"+i.charAt(2);break}case 4:{if(i.charAt(1)==Q.Culture.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(2))){return}i="0"+i;break}else if(i.charAt(2)==Q.Culture.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||i.charCodeAt(3)<=49){return}i=i.charAt(0)+i.charAt(1)+Q.Culture.dateSeparator+"0"+i.charAt(3);break}else{return}}case 5:{if(i.charAt(2)!==Q.Culture.dateSeparator||!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||!r(i.charCodeAt(3))){return}break}default:{return}}t.val(i+Q.Culture.dateSeparator)}};r.dateInputChange=function(e){if(Q.Culture.dateOrder!=="dmy"){return}var t=$(e.target);if(!t.is(":input")){return}var i=Q.coalesce(t.val(),"");var r={};if(i.length>=6&&ss.Int32.tryParse(i,r)){t.val(i.substr(0,2)+Q.Culture.dateSeparator+i.substr(2,2)+Q.Culture.dateSeparator+i.substr(4))}i=Q.coalesce(t.val(),"");if(!!(i.length>=5&&Q.parseDate(i)!==false)){var n=Q.parseDate(i);t.val(Q.formatDate(n,null))}};__decorate([t()],r.prototype,"yearRange",void 0);__decorate([t()],r.prototype,"get_minValue",null);__decorate([t()],r.prototype,"get_maxValue",null);__decorate([t()],r.prototype,"get_maxDate",null);__decorate([t()],r.prototype,"get_sqlMinMax",null);r=__decorate([e.Decorators.registerEditor("Serenity.DateEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="text"/>')],r);return r}(e.Widget);e.DateEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=e.Decorators.option;var i=function(i){__extends(r,i);function r(t,r){var a=i.call(this,t,r)||this;t.addClass("dateQ s-DateTimeEditor").datepicker({showOn:"button",beforeShow:function(){return!t.hasClass("readonly")},yearRange:Q.coalesce(a.options.yearRange,"-100:+50")});t.bind("keyup."+a.uniqueName,function(t){if(t.which===32&&!a.get_readOnly()){if(a.get_valueAsDate()!==new Date){a.set_valueAsDate(new Date);a.element.trigger("change")}}else{e.DateEditor.dateInputKeyup(t)}});t.bind("change."+a.uniqueName,e.DateEditor.dateInputChange);a.time=$("<select/>").addClass("editor s-DateTimeEditor time");var o=t.next(".ui-datepicker-trigger");if(o.length>0){a.time.insertAfter(o)}else{o=t.prev(".ui-datepicker-trigger");if(o.length>0){a.time.insertBefore(o)}else{a.time.insertAfter(t)}}var l=n.getTimeOptions(Q.coalesce(a.options.startHour,0),0,Q.coalesce(a.options.endHour,23),59,Q.coalesce(a.options.intervalMinutes,5));for(var s=0,u=l;s<u.length;s++){var c=u[s];Q.addOption(a.time,c,c)}e.VX.addValidationRule(t,a.uniqueName,function(e){var t=a.get_value();if(Q.isEmptyOrNull(t)){return null}if(!Q.isEmptyOrNull(a.get_minValue())&&ss.compareStrings(t,a.get_minValue())<0){return Q.format(Q.text("Validation.MinDate"),Q.formatDate(a.get_minValue(),null))}if(!Q.isEmptyOrNull(a.get_maxValue())&&ss.compareStrings(t,a.get_maxValue())>=0){return Q.format(Q.text("Validation.MaxDate"),Q.formatDate(a.get_maxValue(),null))}return null});a.set_sqlMinMax(true);$("<div class='inplace-button inplace-now'><b></b></div>").attr("title","set to now").insertAfter(a.time).click(function(e){if(a.element.hasClass("readonly")){return}a.set_valueAsDate(new Date);t.triggerHandler("change")});a.time.on("change",function(e){t.triggerHandler("change")});return a}n=r;r.prototype.get_value=function(){var e=this.element.val().trim();if(e!=null&&e.length===0){return null}var t=Q.formatDate(e,"yyyy-MM-dd");var i=this.time.val();var r=t+"T"+i+":00.000";if(this.options.useUtc){r=Q.formatISODateTimeUTC(Q.parseISODateTime(r))}return r};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(t){if(Q.isEmptyOrNull(t)){this.element.val("");this.time.val("00:00")}else if(t.toLowerCase()==="today"){this.element.val(Q.formatDate(ss.today(),null));this.time.val("00:00")}else{var i=t.toLowerCase()==="now"?new Date:Q.parseISODateTime(t);i=e.DateTimeEditor.roundToMinutes(i,Q.coalesce(this.options.intervalMinutes,5));this.element.val(Q.formatDate(i,null));this.time.val(Q.formatDate(i,"HH:mm"))}};r.prototype.get_valueAsDate=function(){if(Q.isEmptyOrNull(this.get_value())){return null}return Q.parseISODateTime(this.get_value())};Object.defineProperty(r.prototype,"valueAsDate",{get:function(){return this.get_valueAsDate()},set:function(e){this.set_valueAsDate(e)},enumerable:true,configurable:true});r.prototype.set_valueAsDate=function(e){if(e==null){this.set_value(null)}this.set_value(Q.formatDate(e,"yyyy-MM-ddTHH:mm"))};r.prototype.get_minValue=function(){return this.minValue};r.prototype.set_minValue=function(e){this.minValue=e};r.prototype.get_maxValue=function(){return this.maxValue};r.prototype.set_maxValue=function(e){this.maxValue=e};r.prototype.get_minDate=function(){return Q.parseISODateTime(this.get_minValue())};r.prototype.set_minDate=function(e){this.set_minValue(Q.formatDate(e,"yyyy-MM-ddTHH:mm:ss"))};r.prototype.get_maxDate=function(){return Q.parseISODateTime(this.get_maxValue())};r.prototype.set_maxDate=function(e){this.set_maxValue(Q.formatDate(e,"yyyy-MM-ddTHH:mm:ss"))};r.prototype.get_sqlMinMax=function(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"};r.prototype.set_sqlMinMax=function(e){if(e){this.set_minValue("1753-01-01");this.set_maxValue("9999-12-31")}else{this.set_minValue(null);this.set_maxValue(null)}};r.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};r.prototype.set_readOnly=function(t){if(t!==this.get_readOnly()){if(t){this.element.addClass("readonly").attr("readonly","readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1");this.element.nextAll(".inplace-now").css("opacity","0.1")}else{this.element.removeClass("readonly").removeAttr("readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","1");this.element.nextAll(".inplace-now").css("opacity","1")}e.EditorUtils.setReadonly(this.time,t)}};r.roundToMinutes=function(e,t){e=new Date(e.getTime());var i=ss.Int32.trunc(ss.round(e.getMinutes()/t)*t);e.setMinutes(i);e.setSeconds(0);e.setMilliseconds(0);return e};var n;r.getTimeOptions=function(e,t,i,r,n){var a=[];if(i>=23){i=23}if(r>=60){r=59}var o=e;var l=t;while(true){if(o>i||o===i&&l>r){break}var s=(o>=10?"":"0")+o+":"+(l>=10?"":"0")+l;a.push(s);l+=n;if(l>=60){l-=60;o++}}return a};__decorate([t()],r.prototype,"get_minValue",null);__decorate([t()],r.prototype,"get_maxValue",null);__decorate([t()],r.prototype,"get_maxDate",null);__decorate([t()],r.prototype,"get_sqlMinMax",null);r=n=__decorate([e.Decorators.registerEditor("Serenity.DateTimeEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="text"/>')],r);return r}(e.Widget);e.DateTimeEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;n.pageSize=100;n.items=[];n.itemById={};var a=n.emptyItemText();if(a!=null){i.attr("placeholder",a)}var o=n.getSelect2Options();i.select2(o);i.attr("type","text");i.bind("change."+n.uniqueName,function(t,r){if(!!(e.WX.hasOriginalEvent(t)||!r)){if(e.ValidationHelper.getValidator(i)!=null){i.valid()}}});n.setCascadeFrom(n.options.cascadeFrom);if(n.useInplaceAdd())n.addInplaceCreate(Q.text("Controls.SelectEditor.InplaceAdd"),null);return n}i.prototype.destroy=function(){if(this.element!=null){this.element.select2("destroy")}t.prototype.destroy.call(this)};i.prototype.emptyItemText=function(){return Q.coalesce(this.element.attr("placeholder"),Q.text("Controls.SelectEditor.EmptyItemText"))};i.prototype.allowClear=function(){return this.options.allowClear!=null?!!this.options.allowClear:this.emptyItemText()!=null};i.prototype.isMultiple=function(){return!!this.options.multiple};i.prototype.getSelect2Options=function(){var e=this;var t=this.emptyItemText();var i={data:this.items,multiple:this.isMultiple(),placeHolder:!Q.isEmptyOrNull(t)?t:null,allowClear:this.allowClear(),createSearchChoicePosition:"bottom",query:function(t){var i=Q.isEmptyOrNull(t.term)?"":Select2.util.stripDiacritics(Q.coalesce(t.term,"")).toUpperCase();var r=e.items.filter(function(e){return i==null||Q.startsWith(Select2.util.stripDiacritics(Q.coalesce(e.text,"")).toUpperCase(),i)});r.push.apply(r,e.items.filter(function(e){return i!=null&&!Q.startsWith(Select2.util.stripDiacritics(Q.coalesce(e.text,"")).toUpperCase(),i)&&Select2.util.stripDiacritics(Q.coalesce(e.text,"")).toUpperCase().indexOf(i)>=0}));t.callback({results:r.slice((t.page-1)*e.pageSize,t.page*e.pageSize),more:r.length>=t.page*e.pageSize})},initSelection:function(t,i){var r=t.val();var n=e.isAutoComplete();if(e.isMultiple()){var a=[];var o=r.split(",");for(var l=0;l<o.length;l++){var s=o[l];var u=e.itemById[s];if(u==null&&n){u={id:s,text:s};e.addItem(u)}if(u!=null){a.push(u)}}i(a);return}var c=e.itemById[r];if(c==null&&n){c={id:r,text:r};e.addItem(c)}i(c)}};if(this.options.minimumResultsForSearch!=null)i.minimumResultsForSearch=this.options.minimumResultsForSearch;if(this.isAutoComplete()||this.useInplaceAdd())i.createSearchChoice=this.getCreateSearchChoice(null);return i};i.prototype.get_delimited=function(){return!!this.options.delimited};i.prototype.clearItems=function(){ss.clear(this.items);this.itemById={}};i.prototype.addItem=function(e){this.items.push(e);this.itemById[e.id]=e};i.prototype.addOption=function(e,t,i,r){this.addItem({id:e,text:t,source:i,disabled:r})};i.prototype.addInplaceCreate=function(t,i){var r=this;var n=this;t=Q.coalesce(t,Q.text("Controls.SelectEditor.InplaceAdd"));i=Q.coalesce(i,Q.text("Controls.SelectEditor.InplaceEdit"));var a=$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",t).insertAfter(this.element).click(function(e){n.inplaceCreateClick(e)});this.get_select2Container().add(this.element).addClass("has-inplace-button");e.WX.change(this,function(e){var n=r.isMultiple()||Q.isEmptyOrNull(r.get_value());a.attr("title",n?t:i).toggleClass("edit",!n)});e.WX.changeSelect2(this,function(e){if(r.isMultiple()){var t=r.get_values();if(t.length>0&&t[t.length-1]==(-2147483648).toString()){r.set_values(t.slice(0,t.length-1));r.inplaceCreateClick(e)}}else if(r.get_value()==(-2147483648).toString()){r.set_value(null);r.inplaceCreateClick(e)}});if(this.isMultiple()){this.get_select2Container().on("dblclick."+this.uniqueName,".select2-search-choice",function(e){var t=$(e.target);if(!t.hasClass("select2-search-choice")){t=t.closest(".select2-search-choice")}var i=t.index();var n=r.get_values();if(i<0||i>=r.get_values().length){return}e["editItem"]=n[i];r.inplaceCreateClick(e)})}};i.prototype.useInplaceAdd=function(){return!this.isAutoComplete()&&this.options.inplaceAdd&&(this.options.inplaceAddPermission==null||Q.Authorization.hasPermission(this.options.inplaceAddPermission))};i.prototype.isAutoComplete=function(){return!!this.options.autoComplete};i.prototype.getCreateSearchChoice=function(e){var t=this;return function(i){t.lastCreateTerm=i;i=Q.coalesce(Select2.util.stripDiacritics(i),"").toLowerCase();if(Q.isTrimmedEmpty(i)){return null}if(Q.any(t.get_items(),function(t){var r=e?e(t.source):t.text;return Select2.util.stripDiacritics(Q.coalesce(r,"")).toLowerCase()==i}))return null;if(!Q.any(t.get_items(),function(e){return Q.coalesce(Select2.util.stripDiacritics(e.text),"").toLowerCase().indexOf(i)!==-1})){if(t.isAutoComplete()){return{id:t.lastCreateTerm,text:t.lastCreateTerm}}return{id:(-2147483648).toString(),text:Q.text("Controls.SelectEditor.NoResultsClickToDefine")}}if(t.isAutoComplete()){return{id:t.lastCreateTerm,text:t.lastCreateTerm}}return{id:(-2147483648).toString(),text:Q.text("Controls.SelectEditor.ClickToDefine")}}};i.prototype.setEditValue=function(e,t){var i=e[t.name];if(Q.isArray(i)){this.set_values(i)}else{this.set_value(i==null?null:i.toString())}};i.prototype.getEditValue=function(e,t){if(!this.isMultiple()||this.get_delimited()){t[e.name]=this.get_value()}else{t[e.name]=this.get_values()}};i.prototype.get_select2Container=function(){return this.element.prevAll(".select2-container")};i.prototype.get_items=function(){return this.items};i.prototype.get_itemByKey=function(){return this.itemById};i.prototype.get_value=function(){var e;if(this.element.data("select2")){e=this.element.select2("val");if(e!=null&&Q.isArray(e)){return e.join(",")}}else e=this.element.val();return e};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e!=this.get_value()){var t=e;if(!Q.isEmptyOrNull(e)&&this.isMultiple()){t=e.split(String.fromCharCode(44)).map(function(e){return Q.trimToNull(e)}).filter(function(e){return e!=null})}this.element.select2("val",t).triggerHandler("change",[true]);this.updateInplaceReadOnly()}};Object.defineProperty(i.prototype,"selectedItem",{get:function(){var e=this.get_value();if(e&&this.itemById){var t=this.itemById[e];if(t)return t.source}return null},enumerable:true,configurable:true});i.prototype.get_values=function(){var e=this.element.select2("val");if(e==null){return[]}if(Q.isArray(e)){return e}var t=e;if(Q.isEmptyOrNull(t)){return[]}return[t]};Object.defineProperty(i.prototype,"values",{get:function(){return this.get_values()},set:function(e){this.set_values(e)},enumerable:true,configurable:true});i.prototype.set_values=function(e){if(e==null||e.length===0){this.set_value(null);return}this.set_value(e.join(","))};i.prototype.get_text=function(){return Q.coalesce(this.element.select2("data"),{}).text};Object.defineProperty(i.prototype,"text",{get:function(){return this.get_text()},enumerable:true,configurable:true});i.prototype.get_readOnly=function(){return!Q.isEmptyOrNull(this.element.attr("readonly"))};Object.defineProperty(i.prototype,"readOnly",{get:function(){return this.get_readOnly()},set:function(e){this.set_readOnly(e)},enumerable:true,configurable:true});i.prototype.updateInplaceReadOnly=function(){var e=this.get_readOnly()&&(this.isMultiple()||!this.value);this.element.nextAll(".inplace-create").attr("disabled",e?"disabled":"").css("opacity",e?"0.1":"").css("cursor",e?"default":"")};i.prototype.set_readOnly=function(t){if(t!==this.get_readOnly()){e.EditorUtils.setReadonly(this.element,t);this.updateInplaceReadOnly()}};i.prototype.getCascadeFromValue=function(t){return e.EditorUtils.getValue(t)};i.prototype.setCascadeFrom=function(t){var i=this;if(Q.isEmptyOrNull(t)){if(this.cascadeLink!=null){this.cascadeLink.set_parentID(null);this.cascadeLink=null}this.options.cascadeFrom=null;return}this.cascadeLink=new e.CascadedWidgetLink(e.Widget,this,function(e){i.set_cascadeValue(i.getCascadeFromValue(e))});this.cascadeLink.set_parentID(t);this.options.cascadeFrom=t};i.prototype.get_cascadeFrom=function(){return this.options.cascadeFrom};Object.defineProperty(i.prototype,"cascadeFrom",{get:function(){return this.get_cascadeFrom()},set:function(e){this.set_cascadeFrom(e)},enumerable:true,configurable:true});i.prototype.set_cascadeFrom=function(e){if(e!==this.options.cascadeFrom){this.setCascadeFrom(e);this.updateItems()}};i.prototype.get_cascadeField=function(){return Q.coalesce(this.options.cascadeField,this.options.cascadeFrom)};Object.defineProperty(i.prototype,"cascadeField",{get:function(){return this.get_cascadeField()},set:function(e){this.set_cascadeField(e)},enumerable:true,configurable:true});i.prototype.set_cascadeField=function(e){this.options.cascadeField=e};i.prototype.get_cascadeValue=function(){return this.options.cascadeValue};Object.defineProperty(i.prototype,"cascadeValue",{get:function(){return this.get_cascadeValue()},set:function(e){this.set_cascadeValue(e)},enumerable:true,configurable:true});i.prototype.set_cascadeValue=function(e){if(this.options.cascadeValue!==e){this.options.cascadeValue=e;this.set_value(null);this.updateItems()}};i.prototype.get_filterField=function(){return this.options.filterField};Object.defineProperty(i.prototype,"filterField",{get:function(){return this.get_filterField()},set:function(e){this.set_filterField(e)
},enumerable:true,configurable:true});i.prototype.set_filterField=function(e){this.options.filterField=e};i.prototype.get_filterValue=function(){return this.options.filterValue};Object.defineProperty(i.prototype,"filterValue",{get:function(){return this.get_filterValue()},set:function(e){this.set_filterValue(e)},enumerable:true,configurable:true});i.prototype.set_filterValue=function(e){if(this.options.filterValue!==e){this.options.filterValue=e;this.set_value(null);this.updateItems()}};i.prototype.cascadeItems=function(t){var i=this.get_cascadeValue();if(i==null||i===""){if(!Q.isEmptyOrNull(this.get_cascadeField())){return[]}return t}var r=i.toString();var n=this.get_cascadeField();return t.filter(function(t){var i=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(i!=null&&i.toString()===r)})};i.prototype.filterItems=function(t){var i=this.get_filterValue();if(i==null||i===""){return t}var r=i.toString();var n=this.get_filterField();return t.filter(function(t){var i=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(i!=null&&i.toString()===r)})};i.prototype.updateItems=function(){};i.prototype.getDialogTypeKey=function(){if(this.options.dialogType!=null){return this.options.dialogType}return null};i.prototype.createEditDialog=function(t){var i=this.getDialogTypeKey();var r=e.DialogTypeRegistry.get(i);e.Widget.create({type:r,init:function(e){return t(e)}})};i.prototype.initNewEntity=function(e){if(!Q.isEmptyOrNull(this.get_cascadeField())){e[this.get_cascadeField()]=this.get_cascadeValue()}if(!Q.isEmptyOrNull(this.get_filterField())){e[this.get_filterField()]=this.get_filterValue()}if(this.onInitNewEntity!=null){this.onInitNewEntity(e)}};i.prototype.setEditDialogReadOnly=function(e){e.element&&e.element.find(".tool-button.delete-button").addClass("disabled").unbind("click")};i.prototype.editDialogDataChange=function(){};i.prototype.setTermOnNewEntity=function(e,t){};i.prototype.inplaceCreateClick=function(t){var i=this;if(this.get_readOnly()&&(this.isMultiple()&&!t["editItem"]||!this.value))return;this.createEditDialog(function(r){if(i.get_readOnly())i.setEditDialogReadOnly(r);e.SubDialogHelper.bindToDataChange(r,i,function(e,t){i.editDialogDataChange();i.updateItems();i.lastCreateTerm=null;if((t.type==="create"||t.type==="update")&&t.entityId!=null){var r=t.entityId.toString();if(i.isMultiple()){var n=i.get_values().slice();if(n.indexOf(r)<0){n.push(r)}i.set_values(null);i.set_values(n.slice())}else{i.set_value(null);i.set_value(r)}}else if(i.isMultiple()&&t.type==="delete"&&t.entityId!=null){var a=t.entityId.toString();var o=i.get_values().slice();var l=o.indexOf(a);if(l>=0)o.splice(l,1);i.set_values(o.slice())}else if(!i.isMultiple()){i.set_value(null)}},true);var n=t["editItem"];if(n!=null){r.load(n,function(){r.dialogOpen(i.openDialogAsPanel)},null)}else if(i.isMultiple()||Q.isEmptyOrNull(i.get_value())){var a={};i.setTermOnNewEntity(a,Q.trimToEmpty(i.lastCreateTerm));i.initNewEntity(a);r.load(a,function(){r.dialogOpen(i.openDialogAsPanel)},null)}else{r.load(i.get_value(),function(){r.dialogOpen(i.openDialogAsPanel)},null)}})};i=__decorate([e.Decorators.registerClass("Serenity.Select2Editor",[e.ISetEditValue,e.IGetEditValue,e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="hidden"/>')],i);return i}(e.Widget);e.Select2Editor=t;var i=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.updateItems();return r}i.prototype.getItems=function(){return this.options.items||[]};i.prototype.emptyItemText=function(){if(!Q.isEmptyOrNull(this.options.emptyOptionText)){return this.options.emptyOptionText}return t.prototype.emptyItemText.call(this)};i.prototype.updateItems=function(){var e=this.getItems();this.clearItems();if(e.length>0){var t=typeof e[0]==="string";for(var i=0,r=e;i<r.length;i++){var n=r[i];var a=t?n:n[0];var o=t?n:Q.coalesce(n[1],n[0]);this.addOption(a,o,n,false)}}};i=__decorate([e.Decorators.registerClass("Serenity.SelectEditor")],i);return i}(t);e.SelectEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.updateItems();return r}i.prototype.getItems=function(){var e=this.options;if(e.items!=null&&e.items.length>=1){return e.items}var t=[];var i=(new Date).getFullYear();var r=(new Date).getFullYear();e.minYear=Q.coalesce(e.minYear,"-10").toString();if(Q.startsWith(e.minYear,"-")){i-=parseInt(e.minYear.substr(1),10)}else if(Q.startsWith(e.minYear,"+")){i+=parseInt(e.minYear.substr(1),10)}else{i=parseInt(e.minYear,10)}e.maxYear=Q.coalesce(e.maxYear,"+10").toString();if(Q.startsWith(e.maxYear,"-")){r-=parseInt(e.maxYear.substr(1),10)}else if(Q.startsWith(e.maxYear,"+")){r+=parseInt(e.maxYear.substr(1),10)}else{r=parseInt(e.maxYear,10)}if(e.descending){for(var n=r;n>=i;n--){t.push(n.toString())}}else{for(var a=i;a<=r;a++){t.push(a.toString())}}return t};i=__decorate([e.Decorators.registerEditor("Serenity.DateYearEditor")],i);return i}(e.SelectEditor);e.DateYearEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;var n=r;if(!r.isAsyncWidget()){r.updateItems();Q.ScriptData.bindToChange("Lookup."+r.getLookupKey(),r.uniqueName,function(){n.updateItems()})}return r}i.prototype.initializeAsync=function(){var e=this;return this.updateItemsAsync().then(function(){Q.ScriptData.bindToChange("Lookup."+e.getLookupKey(),e.uniqueName,function(){e.updateItemsAsync()})},null)};i.prototype.destroy=function(){Q.ScriptData.unbindFromChange(this.uniqueName);t.prototype.destroy.call(this)};i.prototype.getLookupKey=function(){if(this.options.lookupKey!=null){return this.options.lookupKey}var e=ss.getTypeFullName(ss.getInstanceType(this));var t=e.indexOf(".");if(t>=0){e=e.substring(t+1)}if(Q.endsWith(e,"Editor")){e=e.substr(0,e.length-6)}return e};i.prototype.getLookup=function(){return Q.getLookup(this.getLookupKey())};i.prototype.getLookupAsync=function(){var e=this;return Promise.resolve().then(function(){var t=e.getLookupKey();return Q.getLookupAsync(t)},null)};i.prototype.getItems=function(e){return this.filterItems(this.cascadeItems(e.items))};i.prototype.getItemText=function(e,t){var i=t.textFormatter?t.textFormatter(e):e[t.textField];return i==null?"":i.toString()};i.prototype.getItemDisabled=function(e,t){return false};i.prototype.updateItems=function(){var e=this.getLookup();this.clearItems();var t=this.getItems(e);for(var i=0;i<t.length;i++){var r=t[i];var n=this.getItemText(r,e);var a=this.getItemDisabled(r,e);var o=r[e.idField];var l=o==null?"":o.toString();this.addItem({id:l,text:n,source:r,disabled:a})}};i.prototype.updateItemsAsync=function(){var e=this;return this.getLookupAsync().then(function(t){e.clearItems();var i=e.getItems(t);for(var r=0;r<i.length;r++){var n=i[r];var a=e.getItemText(n,t);var o=e.getItemDisabled(n,t);var l=n[t.idField];var s=l==null?"":l.toString();e.addItem({id:s,text:a,source:n,disabled:o})}},null)};i.prototype.getDialogTypeKey=function(){var e=t.prototype.getDialogTypeKey.call(this);if(e)return e;return this.getLookupKey()};i.prototype.setCreateTermOnNewEntity=function(e,t){e[this.getLookup().textField]=t};i.prototype.editDialogDataChange=function(){Q.reloadLookup(this.getLookupKey())};i=__decorate([e.Decorators.registerEditor("Serenity.LookupEditorBase")],i);return i}(e.Select2Editor);e.LookupEditorBase=t;var i=function(t){__extends(i,t);function i(e,i){return t.call(this,e,i)||this}i=__decorate([e.Decorators.registerEditor("Serenity.LookupEditor")],i);return i}(t);e.LookupEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=e.Decorators.option;var i;(function(t){var i;function r(e){if(Q.isEmptyOrNull(e)){throw new ss.ArgumentNullException("key")}n();var t=i[e.toLowerCase()];if(t==null){var r=Q.typeByFullName(e);if(r!=null){i[e.toLowerCase()]=r;return r}throw new ss.Exception(Q.format("Can't find {0} editor type!",e))}return t}t.get=r;function n(){if(i!=null)return;i={};var t=ss.getAssemblies();for(var r=0,n=t;r<n.length;r++){var a=n[r];for(var l=0,s=ss.getAssemblyTypes(a);l<s.length;l++){var u=s[l];if(!(u.prototype instanceof e.Widget)){continue}if(ss.isGenericTypeDefinition(u)){continue}var c=ss.getTypeFullName(u).toLowerCase();i[c]=u;var d=ss.getAttributes(u,e.EditorAttribute,false);if(d!=null&&d.length>0){var f=d[0].key;if(!Q.isEmptyOrNull(f)){i[f.toLowerCase()]=u}}for(var p=0,h=Q.Config.rootNamespaces;p<h.length;p++){var g=h[p];if(Q.startsWith(c,g.toLowerCase()+".")){var y=c.substr(g.length+1).toLowerCase();if(i[y]==null){i[y]=u}}}}}o()}function a(){i=null}t.reset=a;function o(){var e="editor";var t=Object.keys(i);for(var r=0,n=t;r<n.length;r++){var a=n[r];l(a,i[a])}}function l(e,t){var r="editor";if(!Q.endsWith(e,r))return;var n=e.substr(0,e.length-r.length);if(Q.isEmptyOrNull(n))return;if(i[n]!=null)return;i[n]=i[e]}})(i=e.EditorTypeRegistry||(e.EditorTypeRegistry={}));var r;(function(t){function i(e){var t=e.element.data("select2");if(t!=null){var i=e.element.select2("data");if(i==null)return"";return Q.coalesce(i.text,"")}var r=n(e);if(r==null){return""}if(typeof r==="string")return r;if(r instanceof Boolean)return!!r?Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorNames.true"),"True"):Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorNames.true"),"False");return r.toString()}t.getDisplayText=i;var r={name:"_"};function n(e){var t={};a(e,r,t);return t["_"]}t.getValue=n;function a(t,i,r){var n=ss.safeCast(t,e.IGetEditValue);if(n!=null){n.getEditValue(i,r);return}var a=ss.safeCast(t,e.IStringValue);if(a!=null){r[i.name]=a.get_value();return}var o=ss.safeCast(t,e.IBooleanValue);if(o!=null){r[i.name]=o.get_value();return}var l=ss.safeCast(t,e.IDoubleValue);if(l!=null){var s=l.get_value();r[i.name]=isNaN(s)?null:s;return}if(t.getEditValue!=null){t.getEditValue(i,r);return}if(t.element.is(":input")){r[i.name]=t.element.val();return}}t.saveValue=a;function o(e,t){var i={_:t};l(e,r,i)}t.setValue=o;function l(t,i,r){var n=ss.safeCast(t,e.ISetEditValue);if(n!=null){n.setEditValue(r,i);return}var a=ss.safeCast(t,e.IStringValue);if(a!=null){var o=r[i.name];if(o!=null){o=o.toString()}a.set_value(ss.cast(o,String));return}var l=ss.safeCast(t,e.IBooleanValue);if(l!=null){var s=r[i.name];if(typeof s==="number"){l.set_value(s>0)}else{l.set_value(!!s)}return}var u=ss.safeCast(t,e.IDoubleValue);if(u!=null){var c=r[i.name];if(!!(c==null||ss.isInstanceOfType(c,String)&&Q.isTrimmedEmpty(ss.cast(c,String)))){u.set_value(null)}else if(ss.isInstanceOfType(c,String)){u.set_value(ss.cast(Q.parseDecimal(ss.cast(c,String)),Number))}else if(ss.isInstanceOfType(c,Boolean)){u.set_value(!!c?1:0)}else{u.set_value(ss.cast(c,Number))}return}if(t.setEditValue!=null){t.setEditValue(r,i);return}if(t.element.is(":input")){var d=r[i.name];if(d==null){t.element.val("")}else{t.element.val(d)}return}}t.loadValue=l;function s(e,t){e.each(function(e,i){var r=$(i);var n=r.attr("type");if(r.is("select")||n==="radio"||n==="checkbox"){if(t){r.addClass("readonly").attr("disabled","disabled")}else{r.removeClass("readonly").removeAttr("disabled")}}else if(t){r.addClass("readonly").attr("readonly","readonly")}else{r.removeClass("readonly").removeAttr("readonly")}return true});return e}t.setReadonly=s;function u(t,i){var r=ss.safeCast(t,e.IReadOnly);if(r!=null){r.set_readOnly(i)}else if(t.element.is(":input")){s(t.element,i)}}t.setReadOnly=u;function c(t,i){var r=ss.safeCast(t,e.IValidateRequired);if(r!=null){r.set_required(i)}else if(t.element.is(":input")){t.element.toggleClass("required",!!i)}var n=e.WX.getGridField(t);var a=n.find("sup").get().length>0;if(i&&!a){$("<sup>*</sup>").attr("title",Q.text("Controls.PropertyGrid.RequiredHint")).prependTo(n.find(".caption")[0])}else if(!i&&a){$(n.find("sup")[0]).remove()}}t.setRequired=c;function d(t,i){if(!i){if(!t.hasClass("readonly-container"))return;t.removeClass("readonly-container").find(".editor.container-readonly").removeClass("container-readonly").each(function(t,i){var r=$(i).tryGetWidget(e.Widget);if(r!=null)e.EditorUtils.setReadOnly(r,false);else e.EditorUtils.setReadonly($(i),false)});return}t.addClass("readonly-container").find(".editor").not(".container-readonly").each(function(t,i){var r=$(i).tryGetWidget(e.Widget);if(r!=null){if(r["get_readOnly"]){if(r["get_readOnly"]())return}else if($(i).is("[readonly]")||$(i).is("[disabled]")||$(i).is(".readonly")||$(i).is(".disabled"))return;$(i).addClass("container-readonly");e.EditorUtils.setReadOnly(r,true)}else{if($(i).is("[readonly]")||$(i).is("[disabled]")||$(i).is(".readonly")||$(i).is(".disabled"))return;e.EditorUtils.setReadonly($(i).addClass("container-readonly"),true)}})}t.setContainerReadOnly=d})(r=e.EditorUtils||(e.EditorUtils={}));function n(t,i){return e.Decorators.registerEditor("Serenity."+t+"Editor",i)}var a=e.Decorators.element;var o=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;e.removeClass("flexify");return i}Object.defineProperty(i.prototype,"value",{get:function(){return this.element.is(":checked")},set:function(e){this.element.prop("checked",!!e)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i=__decorate([n("Boolean",[e.IBooleanValue]),a('<input type="checkbox"/>')],i);return i}(e.Widget);e.BooleanEditor=o;var l=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;i.addClass("decimalQ");var a=$.extend(e.DecimalEditor.defaultAutoNumericOptions(),{vMin:Q.coalesce(n.options.minValue,n.options.allowNegatives?n.options.maxValue!=null?"-"+n.options.maxValue:"-999999999999.99":"0.00"),vMax:Q.coalesce(n.options.maxValue,"999999999999.99")});if(n.options.decimals!=null){a.mDec=n.options.decimals}if(n.options.padDecimals!=null){a.aPad=n.options.padDecimals}i.autoNumeric(a);return n}i.prototype.get_value=function(){var e=this.element.autoNumeric("get");if(!!(e==null||e===""))return null;return parseFloat(e)};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e==null||e===""){this.element.val("")}else{this.element.autoNumeric("set",e)}};i.prototype.get_isValid=function(){return!isNaN(this.get_value())};i.defaultAutoNumericOptions=function(){return{aDec:Q.Culture.decimalSeparator,altDec:Q.Culture.decimalSeparator==="."?",":".",aSep:Q.Culture.decimalSeparator==="."?",":".",aPad:true}};i=__decorate([n("Decimal",[e.IDoubleValue]),a('<input type="text"/>')],i);return i}(e.Widget);e.DecimalEditor=l;var s=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;i.addClass("integerQ");var a=$.extend(e.DecimalEditor.defaultAutoNumericOptions(),{vMin:Q.coalesce(n.options.minValue,n.options.allowNegatives?n.options.maxValue!=null?"-"+n.options.maxValue:"-2147483647":"0"),vMax:Q.coalesce(n.options.maxValue,2147483647),aSep:null});i.autoNumeric(a);return n}i.prototype.get_value=function(){var e=this.element.autoNumeric("get");if(!!Q.isTrimmedEmpty(e)){return null}else{return parseInt(e,10)}};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e==null||e===""){this.element.val("")}else{this.element.autoNumeric("set",e)}};i.prototype.get_isValid=function(){return!isNaN(this.get_value())};i=__decorate([n("Integer",[e.IDoubleValue]),a('<input type="text"/>')],i);return i}(e.Widget);e.IntegerEditor=s;var u=function(t){__extends(i,t);function i(e,i){var n=t.call(this,e,i)||this;r.registerValidationMethods();e.addClass("emailuser").removeClass("flexify");var a=$("<span/>").text("@").addClass("emailat").insertAfter(e);var o=$('<input type="text"/>').addClass("emaildomain").addClass("flexify").insertAfter(a);o.bind("blur."+n.uniqueName,function(){var t=o.closest("form").data("validator");if(t!=null){t.element(e[0])}});if(!Q.isEmptyOrNull(n.options.domain)){o.val(n.options.domain)}if(n.options.readOnlyDomain){o.attr("readonly","readonly").addClass("disabled").attr("tabindex","-1")}e.bind("keypress."+n.uniqueName,function(e){if(e.which===64){e.preventDefault();if(!n.options.readOnlyDomain){o.focus();o.select()}}});o.bind("keypress."+n.uniqueName,function(e){if(e.which===64){e.preventDefault()}});if(!n.options.readOnlyDomain){e.change(function(t){return n.set_value(e.val())})}return n}r=i;i.registerValidationMethods=function(){if($.validator.methods["emailuser"]!=null)return;$.validator.addMethod("emailuser",function(e,t){var i=$(t).nextAll(".emaildomain");if(i.length>0&&i.attr("readonly")==null){if(this.optional(t)&&this.optional(i[0])){return true}e=e+"@"+i.val();if(Q.Config.emailAllowOnlyAscii){return new RegExp("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}"+"[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$").test(e)}return new RegExp("^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|"+"[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|"+"((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|"+"\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])"+"([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)"+"+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$","i").test(e)}else{if(Q.Config.emailAllowOnlyAscii){return this.optional(t)||new RegExp("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+$").test(e)}return this.optional(t)||new RegExp("^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+"+"(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*"+"(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-"+"\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*"+"(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))$","i").test(e)}},Q.text("Validation.Email"))};i.prototype.get_value=function(){var e=this.element.nextAll(".emaildomain");var t=this.element.val();var i=e.val();if(Q.isEmptyOrNull(t)){if(this.options.readOnlyDomain||Q.isEmptyOrNull(i)){return""}return"@"+i}return t+"@"+i};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){var t=this.element.nextAll(".emaildomain");e=Q.trimToNull(e);if(e==null){if(!this.options.readOnlyDomain){t.val("")}this.element.val("")}else{var i=e.split("@");if(i.length>1){if(!this.options.readOnlyDomain){t.val(i[1]);this.element.val(i[0])}else if(!Q.isEmptyOrNull(this.options.domain)){if(i[1]!==this.options.domain){this.element.val(e)}else{this.element.val(i[0])}}else{this.element.val(i[0])}}else{this.element.val(i[0])}}};i.prototype.get_readOnly=function(){var e=this.element.nextAll(".emaildomain");return!(this.element.attr("readonly")==null&&(!this.options.readOnlyDomain||e.attr("readonly")==null))};i.prototype.set_readOnly=function(e){var t=this.element.nextAll(".emaildomain");if(e){this.element.attr("readonly","readonly").addClass("readonly");if(!this.options.readOnlyDomain){t.attr("readonly","readonly").addClass("readonly")}}else{this.element.removeAttr("readonly").removeClass("readonly");if(!this.options.readOnlyDomain){t.removeAttr("readonly").removeClass("readonly")}}};var r;i=r=__decorate([n("Email",[e.IStringValue,e.IReadOnly]),a('<input type="text"/>')],i);return i}(e.Widget);e.EmailEditor=u;var c=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.updateItems();return r}i.prototype.updateItems=function(){this.clearItems();var t=this.options.enumType||e.EnumTypeRegistry.get(this.options.enumKey);var i=this.options.enumKey;if(i==null&&t!=null){var r=ss.getAttributes(t,e.EnumKeyAttribute,false);if(r.length>0){i=r[0].value}}var n=ss.Enum.getValues(t);for(var a=0,o=n;a<o.length;a++){var l=o[a];var s=ss.Enum.toString(t,l);this.addOption(ss.cast(l,ss.Int32).toString(),Q.coalesce(Q.tryGetText("Enums."+i+"."+s),s),null,false)}};i.prototype.allowClear=function(){return Q.coalesce(this.options.allowClear,true)};i=__decorate([n("Enum")],i);return i}(e.Select2Editor);e.EnumEditor=c;var d=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;var a=new google.maps.LatLng(Q.coalesce(n.options.latitude,0),Q.coalesce(n.options.longitude,0));var o=new Object;o.center=a;o.mapTypeId=Q.coalesce(n.options.mapTypeId,"roadmap");o.zoom=Q.coalesce(n.options.zoom,15);o.zoomControl=true;n.map=new google.maps.Map(i[0],o);if(n.options.markerTitle!=null){var l=new Object;var s=n.options.markerLatitude;if(s==null){s=Q.coalesce(n.options.latitude,0)}var u=n.options.markerLongitude;if(u==null){u=Q.coalesce(n.options.longitude,0)}l.position=new google.maps.LatLng(s,u);l.map=n.map;l.title=n.options.markerTitle;l.animation=2;new google.maps.Marker(l)}e.LazyLoadHelper.executeOnceWhenShown(i,function(){google.maps.event.trigger(n.map,"resize",[]);n.map.setCenter(a)});return n}i.prototype.get_map=function(){return this.map};i=__decorate([n("GoogleMap",[]),a("<div/>")],i);return i}(e.Widget);e.GoogleMap=d;var f=function(t){__extends(i,t);function i(i,n){var a=t.call(this,i,n)||this;a._instanceReady=false;r.includeCKEditor();var o=i.attr("id");if(Q.isTrimmedEmpty(o)){i.attr("id",a.uniqueName);o=a.uniqueName}if(a.options.cols!=null)i.attr("cols",a.options.cols);if(a.options.rows!=null)i.attr("rows",a.options.rows);a.addValidationRule(a.uniqueName,function(e){if(e.hasClass("required")){var t=Q.trimToNull(a.get_value());if(t==null)return Q.text("Validation.Required")}return null});e.LazyLoadHelper.executeOnceWhenShown(a.element,function(){var e=a.getConfig();window["CKEDITOR"]&&window["CKEDITOR"].replace(o,e)});return a}r=i;i.prototype.instanceReady=function(e){this._instanceReady=true;$(e.editor.container.$).addClass(this.element.attr("class"));this.element.addClass("select2-offscreen").css("display","block");e.editor.setData(this.element.val());e.editor.setReadOnly(this.get_readOnly())};i.prototype.getLanguage=function(){if(!window["CKEDITOR"])return"en";var e=window["CKEDITOR"];var t=Q.coalesce(Q.trimToNull($("html").attr("lang")),"en");if(!!e.lang.languages[t]){return t}if(t.indexOf(String.fromCharCode(45))>=0){t=t.split(String.fromCharCode(45))[0]}if(!!e.lang.languages[t]){return t}return"en"};i.prototype.getConfig=function(){var e=this;return{customConfig:"",language:this.getLanguage(),bodyClass:"s-HtmlContentBody",on:{instanceReady:function(t){return e.instanceReady(t)},change:function(t){t.editor.updateElement();e.element.triggerHandler("change")}},toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"insert",groups:["links","insert","blocks","bidi","list","indent"]},{name:"forms",groups:["forms","mode","document","doctools","others","about","tools"]},{name:"colors"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"align"},{name:"styles"}],removeButtons:"SpecialChar,Anchor,Subscript,Styles",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",removePlugins:"uploadimage,image2",contentsCss:Q.resolveUrl("~/Content/site/site.htmlcontent.css"),entities:false,entities_latin:false,entities_greek:false,autoUpdateElement:true,height:this.options.rows==null||this.options.rows===0?null:this.options.rows*20+"px"}};i.prototype.getEditorInstance=function(){var e=this.element.attr("id");return window["CKEDITOR"].instances[e]};i.prototype.destroy=function(){var e=this.getEditorInstance();e&&e.destroy(true);t.prototype.destroy.call(this)};i.prototype.get_value=function(){var e=this.getEditorInstance();if(this._instanceReady&&e){return e.getData()}else{return this.element.val()}};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){var t=this.getEditorInstance();this.element.val(e);if(this._instanceReady&&t)t.setData(e)};i.prototype.get_readOnly=function(){return!Q.isEmptyOrNull(this.element.attr("disabled"))};i.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.element.attr("disabled","disabled")}else{this.element.removeAttr("disabled")}var t=this.getEditorInstance();if(this._instanceReady&&t)t.setReadOnly(e)}};i.includeCKEditor=function(){if(window["CKEDITOR"]){return}var e=$("#CKEditorScript");if(e.length>0){return}$("<script/>").attr("type","text/javascript").attr("id","CKEditorScript").attr("src",Q.resolveUrl("~/Scripts/CKEditor/ckeditor.js?v="+r.CKEditorVer)).appendTo(window.document.head)};var r;i.CKEditorVer="4.7.1";i=r=__decorate([n("HtmlContent",[e.IStringValue,e.IReadOnly]),a("<textarea/>")],i);return i}(e.Widget);e.HtmlContentEditor=f;var p=function(e){__extends(t,e);function t(t,i){return e.call(this,t,i)||this}t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);t.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,"+"Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,"+"PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,"+"HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,"+"CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,"+"JustifyRight,JustifyBlock,Superscript,RemoveFormat";t.removePlugins="elementspath,uploadimage,image2";return t};t=__decorate([n("HtmlNoteContent")],t);return t}(f);e.HtmlNoteContentEditor=p;var h=function(e){__extends(t,e);function t(t,i){return e.call(this,t,i)||this}t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);t.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,"+"Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,"+"PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,"+"Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,"+"Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,"+"JustifyRight,JustifyBlock,Superscript,RemoveFormat";t.removePlugins="elementspath,uploadimage,image2";return t};t=__decorate([n("HtmlReportContent")],t);return t}(f);e.HtmlReportContentEditor=h;var g=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;i.addClass("s-ImageUploadEditor");if(Q.isEmptyOrNull(n.options.originalNameProperty))i.addClass("hide-original-name");n.toolbar=new e.Toolbar($("<div/>").appendTo(n.element),{buttons:n.getToolButtons()});var a=$("<div><div></div></div>").addClass("upload-progress").prependTo(n.toolbar.element);var o=n.getUploadInputOptions();n.uploadInput=e.UploadHelper.addUploadInput(o);n.fileSymbols=$("<ul/>").appendTo(n.element);n.updateInterface();return n}i.prototype.getUploadInputOptions=function(){var t=this;return{container:this.toolbar.findButton("add-file-button"),zone:this.element,inputName:this.uniqueName,progress:this.progress,fileDone:function(i,r,n){if(!e.UploadHelper.checkImageConstraints(i,t.options)){return}var a={OriginalName:r,Filename:i.TemporaryFile};t.entity=a;t.populate();t.updateInterface()}}};i.prototype.addFileButtonText=function(){return Q.text("Controls.ImageUpload.AddFileButton")};i.prototype.getToolButtons=function(){var e=this;return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}},{title:"",hint:Q.text("Controls.ImageUpload.DeleteButtonHint"),cssClass:"delete-button",onClick:function(){e.entity=null;e.populate();e.updateInterface()}}]};i.prototype.populate=function(){var t=this.options.displayFileName||!Q.isTrimmedEmpty(this.options.originalNameProperty);if(this.entity==null){e.UploadHelper.populateFileSymbols(this.fileSymbols,null,t,this.options.urlPrefix)}else{e.UploadHelper.populateFileSymbols(this.fileSymbols,[this.entity],t,this.options.urlPrefix)}};i.prototype.updateInterface=function(){var e=this.toolbar.findButton("add-file-button");var t=this.toolbar.findButton("delete-button");e.toggleClass("disabled",this.get_readOnly());t.toggleClass("disabled",this.get_readOnly()||this.entity==null)};i.prototype.get_readOnly=function(){return this.uploadInput.attr("disabled")!=null};i.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled").fileupload("disable")}else{this.uploadInput.removeAttr("disabled").fileupload("enable")}this.updateInterface()}};i.prototype.get_value=function(){if(this.entity==null){return null}var e=$.extend({},this.entity);return e};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e!=null){if(e.Filename==null){this.entity=null}else{this.entity=$.extend({},e)}}else{this.entity=null}this.populate();this.updateInterface()};i.prototype.getEditValue=function(e,t){t[e.name]=this.entity==null?null:Q.trimToNull(this.entity.Filename)};i.prototype.setEditValue=function(e,t){var i={};i.Filename=e[t.name];if(Q.isEmptyOrNull(this.options.originalNameProperty)){if(this.options.displayFileName){var r=Q.coalesce(i.Filename,"");var n=ss.lastIndexOfAnyString(r,[47,92]);if(n>=0){i.OriginalName=r.substr(n+1)}else{i.OriginalName=r}}}else{i.OriginalName=e[this.options.originalNameProperty]}this.set_value(i)};i=__decorate([n("ImageUpload",[e.IReadOnly]),a("<div/>")],i);return i}(e.Widget);e.ImageUploadEditor=g;var y=function(i){__extends(r,i);function r(t,r){var n=i.call(this,t,r)||this;n.entities=[];t.addClass("s-MultipleImageUploadEditor");var a=n;n.toolbar=new e.Toolbar($("<div/>").appendTo(n.element),{buttons:n.getToolButtons()});var o=$("<div><div></div></div>").addClass("upload-progress").prependTo(n.toolbar.element);var l=n.toolbar.findButton("add-file-button");n.uploadInput=e.UploadHelper.addUploadInput({container:l,zone:n.element,inputName:n.uniqueName,progress:o,fileDone:function(t,i,r){if(!e.UploadHelper.checkImageConstraints(t,n.options)){return}var o={OriginalName:i,Filename:t.TemporaryFile};a.entities.push(o);a.populate();a.updateInterface()}});n.fileSymbols=$("<ul/>").appendTo(n.element);n.updateInterface();return n}r.prototype.addFileButtonText=function(){return Q.text("Controls.ImageUpload.AddFileButton")};r.prototype.getToolButtons=function(){return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}}]};r.prototype.populate=function(){var t=this;e.UploadHelper.populateFileSymbols(this.fileSymbols,this.entities,true,this.options.urlPrefix);this.fileSymbols.children().each(function(e,i){var r=e;$("<a class='delete'></a>").appendTo($(i).children(".filename")).click(function(e){e.preventDefault();ss.removeAt(t.entities,r);t.populate()})})};r.prototype.updateInterface=function(){var e=this.toolbar.findButton("add-file-button");e.toggleClass("disabled",this.get_readOnly());this.fileSymbols.find("a.delete").toggle(!this.get_readOnly())};r.prototype.get_readOnly=function(){return this.uploadInput.attr("disabled")!=null};r.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled").fileupload("disable")}else{this.uploadInput.removeAttr("disabled").fileupload("enable")}this.updateInterface()}};r.prototype.get_value=function(){return this.entities.map(function(e){return $.extend({},e)
})};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){this.entities=(e||[]).map(function(e){return $.extend({},e)});this.populate();this.updateInterface()};r.prototype.getEditValue=function(e,t){if(this.jsonEncodeValue){t[e.name]=$.toJSON(this.get_value())}else{t[e.name]=this.get_value()}};r.prototype.setEditValue=function(e,t){var i=e[t.name];if(ss.isInstanceOfType(i,String)){var r=Q.coalesce(Q.trimToNull(i),"[]");if(Q.startsWith(r,"[")&&Q.endsWith(r,"]")){this.set_value($.parseJSON(r))}else{this.set_value([{Filename:r,OriginalName:"UnknownFile"}])}}else{this.set_value(i)}};__decorate([t()],r.prototype,"jsonEncodeValue",void 0);r=__decorate([n("MultipleImageUpload",[e.IReadOnly]),a("<div/>")],r);return r}(e.Widget);e.MultipleImageUploadEditor=y;var v=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.mask(r.options.mask||"",{placeholder:Q.coalesce(r.options.placeholder,"_")});return r}Object.defineProperty(i.prototype,"value",{get:function(){this.element.triggerHandler("blur.mask");return this.element.val()},set:function(e){this.element.val(e)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i=__decorate([n("Masked",[e.IStringValue]),a('<input type="text"/>')],i);return i}(e.Widget);e.MaskedEditor=v;var m=function(t){__extends(i,t);function i(e){return t.call(this,e)||this}Object.defineProperty(i.prototype,"value",{get:function(){return this.element.val()},set:function(e){this.element.val(e)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i=__decorate([n("String",[e.IStringValue]),a('<input type="text"/>')],i);return i}(e.Widget);e.StringEditor=m;var b=function(e){__extends(t,e);function t(t){var i=e.call(this,t)||this;t.attr("type","email").addClass("email");return i}t=__decorate([n("EmailAddress")],t);return t}(e.StringEditor);e.EmailAddressEditor=b;var C=function(e){__extends(t,e);function t(t){var i=e.call(this,t)||this;t.attr("type","password");return i}t=__decorate([n("Password")],t);return t}(m);e.PasswordEditor=C;var _=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;if(Q.isEmptyOrNull(n.options.enumKey)&&n.options.enumType==null&&Q.isEmptyOrNull(n.options.lookupKey)){return n}if(!Q.isEmptyOrNull(n.options.lookupKey)){var a=Q.getLookup(n.options.lookupKey);for(var o=0,l=a.items;o<l.length;o++){var s=l[o];var u=s[a.textField];var c=u==null?"":u.toString();var d=s[a.idField];var f=d==null?"":d.toString();n.addRadio(f,c)}}else{var p=n.options.enumType||e.EnumTypeRegistry.get(n.options.enumKey);var h=n.options.enumKey;if(h==null&&p!=null){var g=ss.getAttributes(p,e.EnumKeyAttribute,false);if(g.length>0){h=g[0].value}}var y=ss.Enum.getValues(p);for(var v=0,m=y;v<m.length;v++){var b=m[v];var C=ss.Enum.toString(p,b);n.addRadio(b.toString(),Q.coalesce(Q.tryGetText("Enums."+h+"."+C),C))}}return n}i.prototype.addRadio=function(e,t){var i=$("<label/>").text(t);$('<input type="radio"/>').attr("name",this.uniqueName).attr("id",this.uniqueName+"_"+e).attr("value",e).prependTo(i);i.appendTo(this.element)};i.prototype.get_value=function(){return this.element.find("input:checked").first().val()};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e!==this.get_value()){var t=this.element.find("input");var i=t.filter(":checked");if(i.length>0){i[0].checked=false}if(!Q.isEmptyOrNull(e)){i=t.filter("[value="+e+"]");if(i.length>0){i[0].checked=true}}}};i.prototype.get_readOnly=function(){return this.element.attr("disabled")!=null};i.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.element.attr("disabled","disabled").find("input").attr("disabled","disabled")}else{this.element.removeAttr("disabled").find("input").removeAttr("disabled")}}};i=__decorate([n("RadioButton",[e.IStringValue,e.IReadOnly]),a("<div/>")],i);return i}(e.Widget);e.RadioButtonEditor=_;var x=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;n.element.addClass("g-recaptcha").attr("data-sitekey",n.options.siteKey);if(!!(window["grecaptcha"]==null&&$("script#RecaptchaInclude").length===0)){var a="https://www.google.com/recaptcha/api.js";var o=n.options.language;if(o==null){o=Q.coalesce($("html").attr("lang"),"")}a+="?hl="+o;$("<script/>").attr("id","RecaptchaInclude").attr("src",a).appendTo(document.body)}var l=$("<input />").insertBefore(n.element).attr("id",n.uniqueName+"_validate").val("x");var s={};s["visibility"]="hidden";s["width"]="0px";s["height"]="0px";s["padding"]="0px";var u=l.css(s);var c=n;e.VX.addValidationRule(u,n.uniqueName,function(e){if(Q.isEmptyOrNull(n.get_value())){return Q.text("Validation.Required")}return null});return n}i.prototype.get_value=function(){return this.element.find(".g-recaptcha-response").val()};i.prototype.set_value=function(e){};i=__decorate([e.Decorators.registerEditor("Serenity.Recaptcha",[e.IStringValue]),e.Decorators.element("<div/>")],i);return i}(e.Widget);e.Recaptcha=x;var S=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;if(r.options.cols!==0){e.attr("cols",Q.coalesce(r.options.cols,80))}if(r.options.rows!==0){e.attr("rows",Q.coalesce(r.options.rows,6))}return r}Object.defineProperty(i.prototype,"value",{get:function(){return this.element.val()},set:function(e){this.element.val(e)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i=__decorate([n("TextArea",[e.IStringValue]),a("<textarea />")],i);return i}(e.Widget);e.TextAreaEditor=S;var w=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("editor s-TimeEditor hour");if(!r.options.noEmptyOption){Q.addOption(e,"","--")}for(var n=r.options.startHour||0;n<=(r.options.endHour||23);n++){Q.addOption(e,n.toString(),n<10?"0"+n:n.toString())}r.minutes=$("<select/>").addClass("editor s-TimeEditor minute").insertAfter(e);r.minutes.change(function(){return r.element.trigger("change")});for(var a=0;a<=59;a+=r.options.intervalMinutes||5){Q.addOption(r.minutes,a.toString(),a<10?"0"+a:a.toString())}return r}Object.defineProperty(i.prototype,"value",{get:function(){var e=Q.toId(this.element.val());var t=Q.toId(this.minutes.val());if(e==null||t==null){return null}return e*60+t},set:function(e){if(!e){if(this.options.noEmptyOption){this.element.val(this.options.startHour);this.minutes.val("0")}else{this.element.val("");this.minutes.val("0")}}else{this.element.val(Math.floor(e/60).toString());this.minutes.val(e%60)}},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};i.prototype.set_readOnly=function(t){if(t!==this.get_readOnly()){if(t){this.element.addClass("readonly").attr("readonly","readonly")}else{this.element.removeClass("readonly").removeAttr("readonly")}e.EditorUtils.setReadonly(this.minutes,t)}};i=__decorate([n("Time",[e.IDoubleValue,e.IReadOnly]),a("<select />")],i);return i}(e.Widget);e.TimeEditor=w;var T=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;e.addClass("url").attr("title","URL should be entered in format: 'http://www.site.com/page'.");e.on("blur."+i.uniqueName,function(t){var i=e.closest("form").data("validator");if(i==null)return;if(!e.hasClass("error"))return;var r=Q.trimToNull(e.val());if(!r)return;r="http://"+r;if($.validator.methods["url"].call(i,r,e[0])==true){e.val(r);i.element(e)}});return i}i=__decorate([n("URL",[e.IStringValue])],i);return i}(m);e.URLEditor=T;var I=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;n.pageSize=50;var a=n.emptyItemText();if(a!=null)i.attr("placeholder",a);i.select2(n.getSelect2Options());i.attr("type","text");i.on("change."+n.uniqueName,function(t,r){if(e.WX.hasOriginalEvent(t)||!r){if(e.ValidationHelper.getValidator(i)!=null)i.valid()}});return n}i.prototype.emptyItemText=function(){var e=this.element.attr("placeholder");if(e==null){e=Q.text("Controls.SelectEditor.EmptyItemText")}return e};i.prototype.getService=function(){throw new ss.NotImplementedException};i.prototype.query=function(e,t){var i={blockUI:false,service:this.getService()+"/List",request:e,onSuccess:function(e){t(e)}};this.executeQuery(i)};i.prototype.executeQuery=function(e){Q.serviceCall(e)};i.prototype.queryByKey=function(e,t){var i={blockUI:false,service:this.getService()+"/Retrieve",request:{EntityId:e},onSuccess:function(e){t(e.Entity)}};this.executeQueryByKey(i)};i.prototype.executeQueryByKey=function(e){Q.serviceCall(e)};i.prototype.getItemKey=function(e){return null};i.prototype.getItemText=function(e){return null};i.prototype.getTypeDelay=function(){return 500};i.prototype.getSelect2Options=function(){var e=this;var t=this.emptyItemText();var i=0;return{minimumResultsForSearch:10,placeHolder:!Q.isEmptyOrNull(t)?t:null,allowClear:Q.isValue(t),query:function(t){var r={ContainsText:Q.trimToNull(t.term),Skip:(t.page-1)*e.pageSize,Take:e.pageSize+1};if(i!==0){window.clearTimeout(i)}i=window.setTimeout(function(){e.query(r,function(i){t.callback({results:i.Entities.slice(0,e.pageSize).map(function(t){return{id:e.getItemKey(t),text:e.getItemText(t),source:t}}),more:i.Entities.length>=e.pageSize})})},e.getTypeDelay())},initSelection:function(t,i){var r=t.val();if(Q.isEmptyOrNull(r)){i(null);return}e.queryByKey(r,function(t){i(t==null?null:{id:e.getItemKey(t),text:e.getItemText(t),source:t})})}}};i.prototype.addInplaceCreate=function(e){var t=this;$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(e){t.inplaceCreateClick(e)});this.get_select2Container().add(this.element).addClass("has-inplace-button")};i.prototype.inplaceCreateClick=function(e){};i.prototype.get_select2Container=function(){return this.element.prevAll(".select2-container")};i.prototype.get_value=function(){return ss.safeCast(this.element.select2("val"),String)};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e!==this.get_value()){this.element.select2("val",e).triggerHandler("change",[true])}};i=__decorate([n("Select2Ajax",[e.IStringValue]),a('<input type="hidden" />')],i);return i}(e.Widget);e.Select2AjaxEditor=I})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){e.isTrue="true";e.isFalse="false";e.contains="contains";e.startsWith="startswith";e.EQ="eq";e.NE="ne";e.GT="gt";e.GE="ge";e.LT="lt";e.LE="le";e.BW="bw";e.IN="in";e.isNull="isnull";e.isNotNull="isnotnull";e.toCriteriaOperator={eq:"=",ne:"!=",gt:">",ge:">=",lt:"<",le:"<="}})(t=e.FilterOperators||(e.FilterOperators={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(e){this.items=[];if(e==null){throw new ss.ArgumentNullException("source")}this.fields=e.slice();this.get_fields().sort(function(e,t){var i=Q.tryGetText(e.title);if(i==null){i=e.title;if(i==null)i=e.name}var r=Q.tryGetText(t.title);if(r==null){r=t.title;if(r==null)r=t.name}return Q.turkishLocaleCompare(i,r)});this.fieldByName={};for(var t=0,i=e;t<i.length;t++){var r=i[t];this.get_fieldByName()[r.name]=r}}i=t;t.getCriteriaFor=function(t){if(t==null)return[""];var i=false;var r=[""];var n=false;var a=[""];for(var o=0;o<t.length;o++){var l=t[o];if(l.leftParen||i&&l.rightParen){if(!e.Criteria.isEmpty(r)){if(i)r=e.Criteria.paren(r);if(n)a=e.Criteria.join(a,"or",r);else a=e.Criteria.join(a,"and",r);r=[""]}i=false}if(l.leftParen){n=l.isOr;i=true}if(l.isOr)r=e.Criteria.join(r,"or",l.criteria);else r=e.Criteria.join(r,"and",l.criteria)}if(!e.Criteria.isEmpty(r)){if(n)a=e.Criteria.join(a,"or",e.Criteria.paren(r));else a=e.Criteria.join(a,"and",e.Criteria.paren(r))}return a};t.getDisplayTextFor=function(e){if(e==null)return"";var t=false;var i="";for(var r=0;r<e.length;r++){var n=e[r];if(t&&(n.rightParen||n.leftParen)){i+=")";t=false}if(i.length>0){i+=" "+Q.text("Controls.FilterPanel."+(n.isOr?"Or":"And"))+" "}if(n.leftParen){i+="(";t=true}i+=n.displayText}if(t){i+=")"}return i};t.prototype.get_fields=function(){return this.fields};t.prototype.get_fieldByName=function(){return this.fieldByName};t.prototype.get_items=function(){return this.items};t.prototype.raiseChanged=function(){this.displayText=null;this.changed&&this.changed(this,ss.EventArgs.Empty)};t.prototype.add_changed=function(e){this.changed=ss.delegateCombine(this.changed,e)};t.prototype.remove_changed=function(e){this.changed=ss.delegateRemove(this.changed,e)};t.prototype.get_activeCriteria=function(){return i.getCriteriaFor(this.items)};t.prototype.get_displayText=function(){if(this.displayText==null)this.displayText=i.getDisplayTextFor(this.items);return this.displayText};var i;t=i=__decorate([e.Decorators.registerClass("FilterStore")],t);return t}();e.FilterStore=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IFiltering")],t);return t}();e.IFiltering=t;var i=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IQuickFiltering")],t);return t}();e.IQuickFiltering=i;var r=e.FilterOperators;var n=e.Decorators.option;var a=function(){function r(){}r.prototype.get_field=function(){return this.field};r.prototype.set_field=function(e){this.field=e};r.prototype.get_container=function(){return this.container};r.prototype.set_container=function(e){this.container=e};r.prototype.get_operator=function(){return this.operator};r.prototype.set_operator=function(e){this.operator=e};r.prototype.appendNullableOperators=function(t){if(!this.isNullable()){return t}t.push({key:e.FilterOperators.isNotNull});t.push({key:e.FilterOperators.isNull});return t};r.prototype.appendComparisonOperators=function(t){t.push({key:e.FilterOperators.EQ});t.push({key:e.FilterOperators.NE});t.push({key:e.FilterOperators.LT});t.push({key:e.FilterOperators.LE});t.push({key:e.FilterOperators.GT});t.push({key:e.FilterOperators.GE});return t};r.prototype.isNullable=function(){return this.get_field().required!==true};r.prototype.createEditor=function(){switch(this.get_operator().key){case"true":case"false":case"isnull":case"isnotnull":{return}case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{this.get_container().html('<input type="text"/>');return}}throw new ss.Exception(Q.format("Filtering '{0}' has no editor for '{1}' operator",ss.getTypeName(ss.getInstanceType(this)),this.get_operator().key))};r.prototype.operatorFormat=function(e){return Q.coalesce(e.format,Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorFormats."+e.key),e.key))};r.prototype.getTitle=function(e){return Q.coalesce(Q.tryGetText(e.title),Q.coalesce(e.title,e.name))};r.prototype.displayText=function(e,t){if(!t||t.length===0){return Q.format(this.operatorFormat(e),this.getTitle(this.field))}else if(t.length===1){return Q.format(this.operatorFormat(e),this.getTitle(this.field),t[0])}else{return Q.format(this.operatorFormat(e),this.getTitle(this.field),t[0],t[1])}};r.prototype.getCriteriaField=function(){return this.field.name};r.prototype.getCriteria=function(){var t={};var i;switch(this.get_operator().key){case"true":{t.displayText=this.displayText(this.get_operator(),[]);t.criteria=[[this.getCriteriaField()],"=",true];return t}case"false":{t.displayText=this.displayText(this.get_operator(),[]);t.criteria=[[this.getCriteriaField()],"=",false];return t}case"isnull":{t.displayText=this.displayText(this.get_operator(),[]);t.criteria=["is null",[this.getCriteriaField()]];return t}case"isnotnull":{t.displayText=this.displayText(this.get_operator(),[]);t.criteria=["is not null",[this.getCriteriaField()]];return t}case"contains":{i=this.getEditorText();t.displayText=this.displayText(this.get_operator(),[i]);t.criteria=[[this.getCriteriaField()],"like","%"+i+"%"];return t}case"startswith":{i=this.getEditorText();t.displayText=this.displayText(this.get_operator(),[i]);t.criteria=[[this.getCriteriaField()],"like",i+"%"];return t}case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{i=this.getEditorText();t.displayText=this.displayText(this.get_operator(),[i]);t.criteria=[[this.getCriteriaField()],e.FilterOperators.toCriteriaOperator[this.get_operator().key],this.getEditorValue()];return t}}throw new ss.Exception(Q.format("Filtering '{0}' has no handler for '{1}' operator",ss.getTypeName(ss.getInstanceType(this)),this.get_operator().key))};r.prototype.loadState=function(e){var t=this.get_container().find(":input").first();t.val(e)};r.prototype.saveState=function(){switch(this.get_operator().key){case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{var e=this.get_container().find(":input").first();return e.val()}}return null};r.prototype.argumentNull=function(){return new ss.ArgumentNullException("value",Q.text("Controls.FilterPanel.ValueRequired"))};r.prototype.validateEditorValue=function(e){if(e.length===0){throw this.argumentNull()}return e};r.prototype.getEditorValue=function(){var e=this.get_container().find(":input").not(".select2-focusser").first();if(e.length!==1){throw new ss.Exception(Q.format("Couldn't find input in filter container for {0}",Q.coalesce(this.field.title,this.field.name)))}var t;if(e.data("select2")!=null){t=e.select2("val")}else{t=e.val()}t=Q.coalesce(t,"").trim();return this.validateEditorValue(t)};r.prototype.getEditorText=function(){var e=this.get_container().find(":input").not(".select2-focusser").not(".select2-input").first();if(e.length===0){return this.get_container().text().trim()}var t;if(e.data("select2")!=null){t=Q.coalesce(e.select2("data"),{}).text}else{t=e.val()}return t};r.prototype.initQuickFilter=function(t){t.field=this.getCriteriaField();t.type=e.StringEditor;t.title=this.getTitle(this.field);t.options=Q.deepClone({},this.get_field().quickFilterParams)};r=__decorate([e.Decorators.registerClass("Serenity.BaseFiltering",[t,i])],r);return r}();e.BaseFiltering=a;function o(t){return e.Decorators.registerClass("Serenity."+t+"Filtering")}var l=function(t){__extends(i,t);function i(e){var i=t.call(this)||this;i.editorType=e;return i}i.prototype.useEditor=function(){switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return true}return false};i.prototype.createEditor=function(){if(this.useEditor()){this.editor=e.Widget.create({type:this.editorType,container:this.get_container(),options:this.getEditorOptions(),init:null});return}this.editor=null;t.prototype.createEditor.call(this)};i.prototype.useIdField=function(){return false};i.prototype.getCriteriaField=function(){if(this.useEditor()&&this.useIdField()&&!Q.isEmptyOrNull(this.get_field().filteringIdField)){return this.get_field().filteringIdField}return t.prototype.getCriteriaField.call(this)};i.prototype.getEditorOptions=function(){var e=Q.deepClone({},this.get_field().editorParams);delete e["cascadeFrom"];return Q.deepClone(e,this.get_field().filteringParams)};i.prototype.loadState=function(i){if(this.useEditor()){if(i==null){return}e.EditorUtils.setValue(this.editor,i);return}t.prototype.loadState.call(this,i)};i.prototype.saveState=function(){if(this.useEditor()){return e.EditorUtils.getValue(this.editor)}return t.prototype.saveState.call(this)};i.prototype.getEditorValue=function(){if(this.useEditor()){var i=e.EditorUtils.getValue(this.editor);if(i==null||typeof i=="string"&&i.trim().length===0)throw this.argumentNull();return i}return t.prototype.getEditorValue.call(this)};i.prototype.initQuickFilter=function(e){t.prototype.initQuickFilter.call(this,e);e.type=this.editorType;e.options=Q.deepClone({},this.getEditorOptions(),this.get_field().quickFilterParams)};i=__decorate([o("BaseEditor")],i);return i}(a);e.BaseEditorFiltering=l;var s=function(t){__extends(i,t);function i(){return t.call(this,e.DateEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i=__decorate([o("Date")],i);return i}(l);e.DateFiltering=s;var u=function(t){__extends(i,t);function i(){return t!==null&&t.apply(this,arguments)||this}i.prototype.getOperators=function(){return this.appendNullableOperators([{key:e.FilterOperators.isTrue},{key:e.FilterOperators.isFalse}])};i=__decorate([o("Boolean")],i);return i}(a);e.BooleanFiltering=u;var c=function(t){__extends(i,t);function i(){return t.call(this,e.DateTimeEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i.prototype.getCriteria=function(){var i={};switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{{var r=this.getEditorText();i.displayText=this.displayText(this.get_operator(),[r]);var n=Q.parseISODateTime(this.getEditorValue());n=new Date(n.getFullYear(),n.getMonth(),n.getDate());var a=new Date(n.getFullYear(),n.getMonth(),n.getDate()+1);var o=[this.getCriteriaField()];var l=Q.formatDate(n,"yyyy-MM-dd");var s=Q.formatDate(a,"yyyy-MM-dd");switch(this.get_operator().key){case"eq":{i.criteria=e.Criteria.join([o,">=",l],"and",[o,"<",s]);return i}case"ne":{i.criteria=e.Criteria.paren(e.Criteria.join([o,"<",l],"or",[o,">",s]));return i}case"lt":{i.criteria=[o,"<",l];return i}case"le":{i.criteria=[o,"<",s];return i}case"gt":{i.criteria=[o,">=",s];return i}case"ge":{i.criteria=[o,">=",l];return i}}}break}}return t.prototype.getCriteria.call(this)};i=__decorate([o("DateTime")],i);return i}(l);e.DateTimeFiltering=c;var d=function(t){__extends(i,t);function i(){return t.call(this,e.DecimalEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i=__decorate([o("Decimal")],i);return i}(l);e.DecimalFiltering=d;var f=function(t){__extends(i,t);function i(){return t.call(this,e.Widget)||this}i.prototype.getOperators=function(){var e=[];e.push({key:r.EQ});e.push({key:r.NE});if(this.useRelative){e.push({key:r.LT});e.push({key:r.LE});e.push({key:r.GT});e.push({key:r.GE})}if(this.useLike){e.push({key:r.contains});e.push({key:r.startsWith})}this.appendNullableOperators(e);return e};i.prototype.useEditor=function(){var e=this.get_operator().key;return e===r.EQ||e===r.NE||this.useRelative&&(e===r.LT||e===r.LE||e===r.GT||e===r.GE)};i.prototype.getEditorOptions=function(){var e=t.prototype.getEditorOptions.call(this);if(this.useEditor()&&this.editorType===Q.coalesce(this.get_field().editorType,"String")){e=$.extend(e,this.get_field().editorParams)}return e};i.prototype.createEditor=function(){var i=this;if(this.useEditor()){var r=e.EditorTypeRegistry.get(this.editorType);this.editor=e.Widget.create({type:r,element:function(e){return e.appendTo(i.get_container())},options:this.getEditorOptions()});return}t.prototype.createEditor.call(this)};i.prototype.useIdField=function(){return this.useEditor()};i.prototype.initQuickFilter=function(i){t.prototype.initQuickFilter.call(this,i);i.type=e.EditorTypeRegistry.get(this.editorType)};__decorate([n()],i.prototype,"editorType",void 0);__decorate([n()],i.prototype,"useRelative",void 0);__decorate([n()],i.prototype,"useLike",void 0);i=__decorate([o("Editor")],i);return i}(l);e.EditorFiltering=f;var p=function(t){__extends(i,t);function i(){return t.call(this,e.EnumEditor)||this}i.prototype.getOperators=function(){var e=[{key:r.EQ},{key:r.NE}];return this.appendNullableOperators(e)};i=__decorate([o("Enum")],i);return i}(l);e.EnumFiltering=p;var h=function(t){__extends(i,t);function i(){return t.call(this,e.IntegerEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i=__decorate([o("Integer")],i);return i}(l);e.IntegerFiltering=h;var g=function(t){__extends(i,t);function i(){return t.call(this,e.LookupEditor)||this}i.prototype.getOperators=function(){var e=[{key:r.EQ},{key:r.NE},{key:r.contains},{key:r.startsWith}];return this.appendNullableOperators(e)};i.prototype.useEditor=function(){var e=this.get_operator().key;return e==r.EQ||e==r.NE};i.prototype.useIdField=function(){return this.useEditor()};i.prototype.getEditorText=function(){if(this.useEditor()){return this.editor.text}return t.prototype.getEditorText.call(this)};i=__decorate([o("Lookup")],i);return i}(l);e.LookupFiltering=g;var y=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getOperators=function(){var e=[{key:r.contains},{key:r.startsWith},{key:r.EQ},{key:r.NE}];return this.appendNullableOperators(e)};t.prototype.validateEditorValue=function(t){if(t.length===0){return t}return e.prototype.validateEditorValue.call(this,t)};t=__decorate([o("String")],t);return t}(a);e.StringFiltering=y;var v;(function(t){var i;function r(){if(i!=null)return;i={};for(var t=0,r=ss.getAssemblies();t<r.length;t++){var a=r[t];for(var o=0,l=ss.getAssemblyTypes(a);o<l.length;o++){var s=l[o];if(!ss.isAssignableFrom(e.IFiltering,s))continue;if(ss.isGenericTypeDefinition(s))continue;var u=ss.getTypeFullName(s).toLowerCase();i[u]=s;for(var c=0,d=Q.Config.rootNamespaces;c<d.length;c++){var f=d[c];if(Q.startsWith(u,f.toLowerCase()+".")){var p=u.substr(f.length+1).toLowerCase();if(i[p]==null){i[p]=s}}}}}n()}function n(){var e="filtering";for(var t=0,r=Object.keys(i);t<r.length;t++){var n=r[t];if(!Q.endsWith(n,e))continue;var a=n.substr(0,n.length-e.length);if(Q.isEmptyOrNull(a))continue;if(i[a]!=null)continue;i[a]=i[n]}}function a(){i=null}function o(e){if(Q.isEmptyOrNull(e))throw new ss.ArgumentNullException("key");r();var t=i[e.toLowerCase()];if(t==null)throw new ss.Exception(Q.format("Can't find {0} filter handler type!",e));return t}t.get=o})(v=e.FilteringTypeRegistry||(e.FilteringTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;n.store=new e.FilterStore([]);n.onFilterStoreChanged=function(){return n.filterStoreChanged()};n.store.add_changed(n.onFilterStoreChanged);return n}i.prototype.destroy=function(){if(this.store){this.store.remove_changed(this.onFilterStoreChanged);this.onFilterStoreChanged=null;this.store=null}t.prototype.destroy.call(this)};i.prototype.filterStoreChanged=function(){};i.prototype.get_store=function(){return this.store};i.prototype.set_store=function(t){if(this.store!==t){if(this.store!=null)this.store.remove_changed(this.onFilterStoreChanged);this.store=t||new e.FilterStore([]);this.store.add_changed(this.onFilterStoreChanged);this.filterStoreChanged()}};i=__decorate([e.Decorators.registerClass("Serenity.FilterWidgetBase")],i);return i}(e.TemplatedWidget);e.FilterWidgetBase=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i){var r=t.call(this,i)||this;r.element.find(".cap").text(Q.text("Controls.FilterPanel.EffectiveFilter"));r.element.find(".edit").text(Q.text("Controls.FilterPanel.EditFilter"));r.element.find(".reset").attr("title",Q.text("Controls.FilterPanel.ResetFilterHint"));var n=function(t){t.preventDefault();var i=new e.FilterDialog;i.get_filterPanel().set_store(r.get_store());i.dialogOpen(null)};r.element.find(".edit").click(n);r.element.find(".txt").click(n);r.element.find(".reset").click(function(e){e.preventDefault();ss.clear(r.get_store().get_items());r.get_store().raiseChanged()});return r}i.prototype.filterStoreChanged=function(){t.prototype.filterStoreChanged.call(this);var e=Q.trimToNull(this.get_store().get_displayText());this.element.find(".current").toggle(e!=null);this.element.find(".reset").toggle(e!=null);if(e==null)e=Q.text("Controls.FilterPanel.EffectiveEmpty");this.element.find(".txt").text("["+e+"]")};i.prototype.getTemplate=function(){return"<div><a class='reset'></a><a class='edit'></a>"+"<div class='current'><span class='cap'></span>"+"<a class='txt'></a></div></div>"};i=__decorate([e.Decorators.registerClass("Serenity.FilterDisplayBar")],i);return i}(e.FilterWidgetBase);e.FilterDisplayBar=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e)||this;for(var n=0,a=i;n<a.length;n++){var o=a[n];r.addOption(o.name,Q.coalesce(Q.tryGetText(o.title),Q.coalesce(o.title,o.name)),o)}return r}i.prototype.emptyItemText=function(){if(Q.isEmptyOrNull(this.value)){return Q.text("Controls.FilterPanel.SelectField")}return null};i.prototype.getSelect2Options=function(){var e=t.prototype.getSelect2Options.call(this);e.allowClear=false;return e};i=__decorate([e.Decorators.registerClass("Serenity.FilterFieldSelect")],i);return i}(e.Select2Editor);var i=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e)||this;for(var n=0,a=i;n<a.length;n++){var o=a[n];var l=Q.coalesce(o.title,Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorNames."+o.key),o.key));r.addOption(o.key,l,o)}if(i.length&&i[0])r.value=i[0].key;return r}i.prototype.emptyItemText=function(){return null};i.prototype.getSelect2Options=function(){var e=t.prototype.getSelect2Options.call(this);e.allowClear=false;return e};i=__decorate([e.Decorators.registerClass("Serenity.FilterOperatorSelect")],i);return i}(e.Select2Editor);var r=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;t.element.addClass("s-FilterPanel");t.rowsDiv=t.byId("Rows");t.initButtons();t.updateButtons();return t}n.prototype.get_showInitialLine=function(){return this.showInitialLine};n.prototype.set_showInitialLine=function(e){if(this.showInitialLine!==e){this.showInitialLine=e;if(this.showInitialLine&&this.rowsDiv.children().length===0){this.addEmptyRow(false)}}};n.prototype.filterStoreChanged=function(){r.prototype.filterStoreChanged.call(this);this.updateRowsFromStore()};n.prototype.updateRowsFromStore=function(){this.rowsDiv.empty();var e=this.get_store().get_items();for(var r=0,n=e;r<n.length;r++){var a=n[r];this.addEmptyRow(false);var o=this.rowsDiv.children().last();var l=o.children("div.l");l.children(".leftparen").toggleClass("active",!!a.leftParen);l.children(".rightparen").toggleClass("active",!!a.rightParen);l.children(".andor").toggleClass("or",!!a.isOr).text(Q.text(!!a.isOr?"Controls.FilterPanel.Or":"Controls.FilterPanel.And"));var s=o.children("div.f").find("input.field-select").getWidget(t);s.value=a.field;this.rowFieldChange(o);var u=o.children("div.o").find("input.op-select").getWidget(i);u.set_value(a.operator);this.rowOperatorChange(o);var c=this.getFilteringFor(o);if(c!=null){c.set_operator({key:a.operator});c.loadState(a.state)}}if(this.get_showInitialLine()&&this.rowsDiv.children().length===0){this.addEmptyRow(false)}this.updateParens()};n.prototype.get_showSearchButton=function(){return this.showSearchButton};n.prototype.set_showSearchButton=function(e){if(this.showSearchButton!==e){this.showSearchButton=e;this.updateButtons()}};n.prototype.get_updateStoreOnReset=function(){return this.updateStoreOnReset};n.prototype.set_updateStoreOnReset=function(e){if(this.updateStoreOnReset!==e){this.updateStoreOnReset=e}};n.prototype.getTemplate=function(){return"<div id='~_Rows' class='filter-lines'>"+"</div>"+"<div id='~_Buttons' class='buttons'>"+"<button id='~_AddButton' class='btn btn-primary add'></button>"+"<button id='~_SearchButton' class='btn btn-success search'></button>"+"<button id='~_ResetButton' class='btn btn-danger reset'></button>"+"</div>"+"<div style='clear: both'>"+"</div>"};n.prototype.initButtons=function(){var e=this;this.byId("AddButton").text(Q.text("Controls.FilterPanel.AddFilter")).click(function(t){return e.addButtonClick(t)});this.byId("SearchButton").text(Q.text("Controls.FilterPanel.SearchButton")).click(function(t){return e.searchButtonClick(t)
});this.byId("ResetButton").text(Q.text("Controls.FilterPanel.ResetButton")).click(function(t){return e.resetButtonClick(t)})};n.prototype.searchButtonClick=function(e){e.preventDefault();this.search()};n.prototype.get_hasErrors=function(){return this.rowsDiv.children().children("div.v").children("span.error").length>0};n.prototype.search=function(){this.rowsDiv.children().children("div.v").children("span.error").remove();var e=[];var t=null;var r=null;for(var n=0;n<this.rowsDiv.children().length;n++){try{r=this.rowsDiv.children().eq(n);var a=this.getFilteringFor(r);if(a==null){continue}var o=this.getFieldFor(r);var l=r.children("div.o").find("input.op-select").getWidget(i).value;if(l==null||l.length===0)throw new ss.ArgumentOutOfRangeException("operator",Q.text("Controls.FilterPanel.InvalidOperator"));var s={};s.field=o.name;s.operator=l;s.isOr=r.children("div.l").children("a.andor").hasClass("or");s.leftParen=r.children("div.l").children("a.leftparen").hasClass("active");s.rightParen=r.children("div.l").children("a.rightparen").hasClass("active");a.set_operator({key:l});var u=a.getCriteria();s.criteria=u.criteria;s.state=a.saveState();s.displayText=u.displayText;e.push(s)}catch(c){c=ss.Exception.wrap(c);if(ss.isInstanceOfType(c,ss.ArgumentException)){t=c.get_message();break}else{throw c}}}if(t!=null){$("<span/>").addClass("error").attr("title",t).appendTo(r.children("div.v"));r.children("div.v").find("input:first").focus();return}ss.clear(this.get_store().get_items());ss.arrayAddRange(this.get_store().get_items(),e);this.get_store().raiseChanged()};n.prototype.addButtonClick=function(e){this.addEmptyRow(true);e.preventDefault()};n.prototype.resetButtonClick=function(e){e.preventDefault();if(this.get_updateStoreOnReset()){if(this.get_store().get_items().length>0){ss.clear(this.get_store().get_items());this.get_store().raiseChanged()}}this.rowsDiv.empty();this.updateButtons();if(this.get_showInitialLine()){this.addEmptyRow(false)}};n.prototype.findEmptyRow=function(){var e=null;this.rowsDiv.children().each(function(t,i){var r=$(i).children("div.f").children("input.field-select").first();if(r.length===0){return true}var n=r.val();if(n==null||n.length===0){e=$(i);return false}return true});return e};n.prototype.addEmptyRow=function(e){var i=this;var r=this.findEmptyRow();if(r!=null){r.find("input.field-select").select2("focus");if(e){r.find("input.field-select").select2("open")}return r}var n=this.rowsDiv.children().last().children("a.andor").hasClass("or");var a=$("<div class='filter-line'>"+"<a class='delete'><span></span></a>"+"<div class='l'>"+"<a class='rightparen' href='#'>)</a>"+"<a class='andor' href='#'></a>"+"<a class='leftparen' href='#'>(</a>"+"</div>"+"<div class='f'>"+"<input type='hidden' class='field-select'>"+"</div>"+"<div class='o'></div>"+"<div class='v'></div>"+"<div style='clear: both'></div>"+"</div>").appendTo(this.rowsDiv);var o=a.children("div.l").hide();o.children("a.leftparen, a.rightparen").click(function(e){return i.leftRightParenClick(e)});var l=o.children("a.andor").attr("title",Q.text("Controls.FilterPanel.ChangeAndOr"));if(n){l.addClass("or").text(Q.text("Controls.FilterPanel.Or"))}else{l.text(Q.text("Controls.FilterPanel.And"))}l.click(function(e){return i.andOrClick(e)});a.children("a.delete").attr("title",Q.text("Controls.FilterPanel.RemoveField")).click(function(e){return i.deleteRowClick(e)});var s=new t(a.children("div.f").children("input"),this.get_store().get_fields()).changeSelect2(function(e){return i.onRowFieldChange(e)});this.updateParens();this.updateButtons();a.find("input.field-select").select2("focus");if(e){a.find("input.field-select").select2("open")}return a};n.prototype.onRowFieldChange=function(e){var t=$(e.target).closest("div.filter-line");this.rowFieldChange(t);var i=t.children("div.o").find("input.op-select");i.select2("focus")};n.prototype.rowFieldChange=function(e){e.removeData("Filtering");var i=e.children("div.f").find("input.field-select").getWidget(t);var r=i.get_value();var n=r==null||r==="";this.removeFiltering(e);this.populateOperatorList(e);this.rowOperatorChange(e);this.updateParens();this.updateButtons()};n.prototype.removeFiltering=function(e){e.data("Filtering",null);e.data("FilteringField",null)};n.prototype.populateOperatorList=function(e){var t=this;e.children("div.o").html("");var r=this.getFilteringFor(e);if(r==null)return;var n=e.children("div.o").html("<input/>").children().attr("type","hidden").addClass("op-select");var a=r.getOperators();var o=new i(n,a);o.changeSelect2(function(e){return t.onRowOperatorChange(e)})};n.prototype.getFieldFor=function(e){if(e.length===0){return null}var i=e.children("div.f").find("input.field-select").getWidget(t);if(Q.isEmptyOrNull(i.value)){return null}return this.get_store().get_fieldByName()[i.get_value()]};n.prototype.getFilteringFor=function(t){var i=this.getFieldFor(t);if(i==null)return null;var r=ss.cast(t.data("Filtering"),e.IFiltering);if(r!=null)return r;var n=e.FilteringTypeRegistry.get(Q.coalesce(i.filteringType,"String"));var a=t.children("div.v");r=ss.cast(ss.createInstance(n),e.IFiltering);e.ReflectionOptionsSetter.set(r,i.filteringParams);r.set_container(a);r.set_field(i);t.data("Filtering",r);return r};n.prototype.onRowOperatorChange=function(e){var t=$(e.target).closest("div.filter-line");this.rowOperatorChange(t);var i=t.children("div.v").find(":input:visible").first();try{i.focus()}catch(r){}};n.prototype.rowOperatorChange=function(e){if(e.length===0){return}var t=e.children("div.v");t.html("");var r=this.getFilteringFor(e);if(r==null)return;var n=e.children("div.o").find("input.op-select").getWidget(i);if(Q.isEmptyOrNull(n.get_value()))return;var a=r.getOperators().filter(function(e){return e.key===n.value});var o=a.length>0?a[0]:null;if(o==null)return;r.set_operator(o);r.createEditor()};n.prototype.deleteRowClick=function(e){e.preventDefault();var t=$(e.target).closest("div.filter-line");t.remove();if(this.rowsDiv.children().length===0){this.search()}this.updateParens();this.updateButtons()};n.prototype.updateButtons=function(){this.byId("SearchButton").toggle(this.rowsDiv.children().length>=1&&this.showSearchButton);this.byId("ResetButton").toggle(this.rowsDiv.children().length>=1)};n.prototype.andOrClick=function(e){e.preventDefault();var t=$(e.target).toggleClass("or");t.text(Q.text("Controls.FilterPanel."+(t.hasClass("or")?"Or":"And")))};n.prototype.leftRightParenClick=function(e){e.preventDefault();$(e.target).toggleClass("active");this.updateParens()};n.prototype.updateParens=function(){var e=this.rowsDiv.children();if(e.length===0){return}e.removeClass("paren-start");e.removeClass("paren-end");e.children("div.l").css("display",e.length===1?"none":"block");e.first().children("div.l").children("a.rightparen, a.andor").css("visibility","hidden");for(var t=1;t<e.length;t++){var i=e.eq(t);i.children("div.l").css("display","block").children("a.lefparen, a.andor").css("visibility","visible")}var r=false;for(var n=0;n<e.length;n++){var a=e.eq(n);var o=a.children("div.l");var l=o.children("a.leftparen");var s=o.children("a.rightparen");if(s.hasClass("active")&&r){r=false;if(n>0){e.eq(n-1).addClass("paren-end")}}if(l.hasClass("active")){r=true;if(n>0){a.addClass("paren-start")}}}};return n}(e.FilterWidgetBase);e.FilterPanel=r})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;i.attr("title",Q.text("Controls.QuickSearch.Hint")).attr("placeholder",Q.text("Controls.QuickSearch.Placeholder"));n.lastValue=Q.trim(Q.coalesce(i.val(),""));var a=n;n.element.bind("keyup."+n.uniqueName,function(){a.checkIfValueChanged()});n.element.bind("change."+n.uniqueName,function(){a.checkIfValueChanged()});$("<span><i></i></span>").addClass("quick-search-icon").insertBefore(i);if(Q.isValue(n.options.fields)&&n.options.fields.length>0){var o=$("<a/>").addClass("quick-search-field").attr("title",Q.text("Controls.QuickSearch.FieldSelection")).insertBefore(i);var l=$("<ul></ul>").css("width","120px");for(var s=0,u=n.options.fields;s<u.length;s++){var c=u[s];var d={$:c};$("<li><a/></li>").appendTo(l).children().attr("href","#").text(Q.coalesce(c.title,"")).click(ss.mkdel({field:d,$this:n},function(e){e.preventDefault();this.$this.fieldChanged=!ss.referenceEquals(a.field,this.field.$);a.field=this.field.$;this.$this.updateInputPlaceHolder();this.$this.checkIfValueChanged()}))}new e.PopupMenuButton(o,{positionMy:"right top",positionAt:"right bottom",menu:l});n.field=n.options.fields[0];n.updateInputPlaceHolder()}n.element.bind("execute-search."+n.uniqueName,function(e){if(!!n.timer){window.clearTimeout(n.timer)}n.searchNow(Q.trim(Q.coalesce(n.element.val(),"")))});return n}i.prototype.checkIfValueChanged=function(){if(this.element.hasClass("ignore-change")){return}var e=Q.trim(Q.coalesce(this.element.val(),""));if(e==this.lastValue&&(!this.fieldChanged||Q.isEmptyOrNull(e))){this.fieldChanged=false;return}this.fieldChanged=false;if(!!this.timer){window.clearTimeout(this.timer)}var t=this;this.timer=window.setTimeout(function(){t.searchNow(e)},Q.coalesce(this.options.typeDelay,500));this.lastValue=e};i.prototype.get_field=function(){return this.field};i.prototype.set_field=function(e){if(this.field!==e){this.fieldChanged=true;this.field=e;this.updateInputPlaceHolder();this.checkIfValueChanged()}};i.prototype.updateInputPlaceHolder=function(){var e=this.element.prevAll(".quick-search-field");if(this.field){e.text(this.field.title)}else{e.text("")}};i.prototype.searchNow=function(e){var t=this;this.element.parent().toggleClass(Q.coalesce(this.options.filteredParentClass,"s-QuickSearchFiltered"),!!(e.length>0));this.element.parent().addClass(Q.coalesce(this.options.loadingParentClass,"s-QuickSearchLoading")).addClass(Q.coalesce(this.options.loadingParentClass,"s-QuickSearchLoading"));var i=function(e){t.element.removeClass(Q.coalesce(t.options.loadingParentClass,"s-QuickSearchLoading")).parent().removeClass(Q.coalesce(t.options.loadingParentClass,"s-QuickSearchLoading"));if(!e){t.element.closest(".s-QuickSearchBar").find(".quick-search-icon i").effect("shake",{distance:2})}};if(this.options.onSearch!=null){this.options.onSearch(this.field!=null&&!Q.isEmptyOrNull(this.field.name)?this.field.name:null,e,i)}else{i(true)}};return i}(e.Widget);e.QuickSearchInput=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IInitializeColumn")],t);return t}();e.IInitializeColumn=t;var i=e.Decorators.option;function r(t,i){return e.Decorators.registerFormatter("Serenity."+t+"Formatter",i)}var n=function(){function e(){}e.prototype.format=function(e){if(e.value==null){return""}var t;if(!!e.value){t=Q.tryGetText(this.trueText);if(t==null){t=this.trueText;if(t==null){t=Q.coalesce(Q.tryGetText("Dialogs.YesButton"),"Yes")}}}else{t=Q.tryGetText(this.falseText);if(t==null){t=this.falseText;if(t==null){t=Q.coalesce(Q.tryGetText("Dialogs.NoButton"),"No")}}}return Q.htmlEncode(t)};__decorate([i()],e.prototype,"falseText",void 0);__decorate([i()],e.prototype,"trueText",void 0);e=__decorate([r("Boolean")],e);return e}();e.BooleanFormatter=n;var a=function(){function e(){}e.prototype.format=function(e){return'<span class="check-box no-float readonly '+(!!e.value?" checked":"")+'"></span>'};e=__decorate([r("Checkbox")],e);return e}();e.CheckboxFormatter=a;var o=function(){function e(){this.displayFormat=Q.Culture.dateFormat}t=e;e.format=function(e,t){if(e==null){return""}var i;if(e instanceof Date){i=e}else if(typeof e==="string"){i=Q.parseISODateTime(e);if(i==null){return Q.htmlEncode(e)}}else{return e.toString()}return Q.htmlEncode(Q.formatDate(i,t))};e.prototype.format=function(e){return t.format(e.value,this.displayFormat)};var t;__decorate([i()],e.prototype,"displayFormat",void 0);e=t=__decorate([r("Date")],e);return e}();e.DateFormatter=o;var l=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.displayFormat=Q.Culture.dateTimeFormat;return t}t=__decorate([r("DateTime")],t);return t}(o);e.DateTimeFormatter=l;var s=function(){function t(){}n=t;t.prototype.format=function(t){return n.format(e.EnumTypeRegistry.get(this.enumKey),t.value)};t.format=function(t,i){if(i==null){return""}var r;try{r=ss.Enum.toString(t,i)}catch(a){a=ss.Exception.wrap(a);if(ss.isInstanceOfType(a,ss.ArgumentException)){r=i.toString()}else{throw a}}var o=ss.getAttributes(t,e.EnumKeyAttribute,false);var l=o.length>0?o[0].value:ss.getTypeFullName(t);return n.getText(l,r)};t.getText=function(e,t){if(Q.isEmptyOrNull(t)){return""}return Q.htmlEncode(Q.coalesce(Q.tryGetText("Enums."+e+"."+t),t))};t.getName=function(e,t){if(t==null){return""}return ss.Enum.toString(e,t)};var n;__decorate([i()],t.prototype,"enumKey",void 0);t=n=__decorate([r("Enum")],t);return t}();e.EnumFormatter=s;var u=function(){function n(){}a=n;n.prototype.format=function(e){var t=ss.safeCast(e.value,String);if(Q.isEmptyOrNull(t)){return""}var i=a.dbFileUrl(t);var r=!Q.isEmptyOrNull(this.originalNameProperty)?ss.safeCast(e.item[this.originalNameProperty],String):null;r=Q.coalesce(r,"");var n=Q.format(Q.coalesce(this.displayFormat,"{0}"),r,t,i);return"<a class='file-download-link' target='_blank' href='"+Q.attrEncode(i)+"'>"+Q.htmlEncode(n)+"</a>"};n.dbFileUrl=function(e){e=Q.replaceAll(Q.coalesce(e,""),"\\","/");return Q.resolveUrl("~/upload/")+e};n.prototype.initializeColumn=function(e){e.referencedFields=e.referencedFields||[];if(!Q.isEmptyOrNull(this.originalNameProperty)){e.referencedFields.push(this.originalNameProperty);return}};var a;__decorate([i()],n.prototype,"displayFormat",void 0);__decorate([i()],n.prototype,"originalNameProperty",void 0);n=a=__decorate([r("FileDownload",[e.ISlickFormatter,t])],n);return n}();e.FileDownloadFormatter=u;var c=function(){function e(){}t=e;e.prototype.format=function(e){return t.format(e.value)};e.format=function(e){var t=Math.floor(e/60);var i=e-t*60;var r,n;if(e==null||isNaN(e))return"";if(t<10)r="0"+t;else r=t.toString();if(i<10)n="0"+i;else n=i.toString();return Q.format("{0}:{1}",r,n)};var t;e=t=__decorate([r("Minute")],e);return e}();e.MinuteFormatter=c;var d=function(){function e(){}t=e;e.prototype.format=function(e){return t.format(e.value,this.displayFormat)};e.format=function(e,t){t=Q.coalesce(t,"0.##");if(e==null)return"";if(typeof e==="number"){if(isNaN(e))return"";return Q.htmlEncode(Q.formatNumber(e,t))}var i=Q.parseDecimal(e.toString());if(i==null)return"";return Q.htmlEncode(e.toString())};var t;__decorate([i()],e.prototype,"displayFormat",void 0);e=t=__decorate([r("Number")],e);return e}();e.NumberFormatter=d;var f=function(){function n(){}n.prototype.format=function(e){var t=!Q.isEmptyOrNull(this.urlProperty)?Q.coalesce(e.item[this.urlProperty],"").toString():Q.coalesce(e.value,"").toString();if(Q.isEmptyOrNull(t))return"";if(!Q.isEmptyOrNull(this.urlFormat))t=Q.format(this.urlFormat,t);if(t!=null&&Q.startsWith(t,"~/"))t=Q.resolveUrl(t);var i=!Q.isEmptyOrNull(this.displayProperty)?Q.coalesce(e.item[this.displayProperty],"").toString():Q.coalesce(e.value,"").toString();if(!Q.isEmptyOrNull(this.displayFormat))i=Q.format(this.displayFormat,i);var r="<a href='"+Q.attrEncode(t)+"'";if(!Q.isEmptyOrNull(this.target))r+=" target='"+this.target+"'";r+=">"+Q.htmlEncode(i)+"</a>";return r};n.prototype.initializeColumn=function(e){e.referencedFields=e.referencedFields||[];if(!Q.isEmptyOrNull(this.displayProperty)){e.referencedFields.push(this.displayProperty);return}if(!Q.isEmptyOrNull(this.urlProperty)){e.referencedFields.push(this.urlProperty);return}};__decorate([i()],n.prototype,"displayProperty",void 0);__decorate([i()],n.prototype,"displayFormat",void 0);__decorate([i()],n.prototype,"urlProperty",void 0);__decorate([i()],n.prototype,"urlFormat",void 0);__decorate([i()],n.prototype,"target",void 0);n=__decorate([r("Url",[e.ISlickFormatter,t])],n);return n}();e.UrlFormatter=f;var p;(function(t){var i;function r(){var e="formatter";for(var t=0,r=Object.keys(i);t<r.length;t++){var n=r[t];if(!Q.endsWith(n,e))continue;var a=n.substr(0,n.length-e.length);if(Q.isEmptyOrNull(a))continue;if(i[a]!=null)continue;i[a]=i[n]}}function n(){if(i){return}i={};var t=ss.getAssemblies();for(var n=0,a=t;n<a.length;n++){var o=a[n];var l=ss.getAssemblyTypes(o);for(var s=0,u=l;s<u.length;s++){var c=u[s];if(!ss.isAssignableFrom(e.ISlickFormatter,c))continue;if(ss.isGenericTypeDefinition(c))continue;var d=ss.getTypeFullName(c).toLowerCase();i[d]=c;for(var f=0,p=Q.Config.rootNamespaces;f<p.length;f++){var h=p[f];if(Q.startsWith(d,h.toLowerCase()+".")){var g=d.substr(h.length+1).toLowerCase();if(i[g]==null){i[g]=c}}}}}r()}function a(e){if(Q.isEmptyOrNull(e))throw new ss.ArgumentNullException("key");n();var t=i[e.toLowerCase()];if(t==null){throw new ss.Exception(Q.format("Can't find {0} formatter type!",e))}return t}t.get=a;function o(){i=null}t.reset=o})(p=e.FormatterTypeRegistry||(e.FormatterTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;n.xDifference=0;n.yDifference=0;e.LazyLoadHelper.executeOnceWhenShown(i,function(){n.storeInitialSize()});return n}i.prototype.storeInitialSize=function(){var e=this;if(!!this.element.data("flexify-init")){return}var t=this.options.designWidth;if(t==null)t=this.element.width();this.element.data("flexify-width",t);var i=this.options.designHeight;if(i==null)i=this.element.height();this.element.data("flexify-height",i);this.element.data("flexify-init",true);this.element.bind("resize."+this.uniqueName,function(){return e.resizeElements()});this.element.bind("resizestop."+this.uniqueName,function(){return e.resizeElements()});var r=this.element.find(".ui-tabs");if(r.length>0){r.bind("tabsactivate."+this.uniqueName,function(){return e.resizeElements()})}if(this.options.designWidth!=null||this.options.designHeight!=null)this.resizeElements()};i.prototype.getXFactor=function(e){var t=null;if(this.options.getXFactor!=null)t=this.options.getXFactor(e);if(t==null)t=e.data("flex-x");return Q.coalesce(t,1)};i.prototype.getYFactor=function(e){var t=null;if(this.options.getYFactor!=null)t=this.options.getYFactor(e);if(t==null)t=e.data("flex-y");return Q.coalesce(t,0)};i.prototype.resizeElements=function(){var e=this;var t=this.element.width();var i=this.element.data("flexify-width");if(i==null){this.element.data("flexify-width",t);i=t}var r=this.element.height();var n=this.element.data("flexify-height");if(n==null){this.element.data("flexify-height",r);n=r}this.xDifference=t-i;this.yDifference=r-n;var a=this.element;var o=this.element.find(".ui-tabs-panel");if(o.length>0){a=o.filter(":visible")}a.find(".flexify").add(o.filter(".flexify:visible")).each(function(t,i){e.resizeElement($(i))})};i.prototype.resizeElement=function(e){var t=this.getXFactor(e);if(t!==0){var i=e.data("flexify-width");if(i==null){var r=e.width();e.data("flexify-width",r);i=r}e.width(i+t*this.xDifference|0)}var n=this.getYFactor(e);if(n!==0){var a=e.data("flexify-height");if(a==null){var o=e.height();e.data("flexify-height",o);a=o}e.height(a+n*this.yDifference|0)}if(e.hasClass("require-layout")){e.triggerHandler("layout")}};return i}(e.Widget);e.Flexify=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var i;function r(t){if(i==null){i={};for(var r=0,n=ss.getAssemblies();r<n.length;r++){var a=n[r];for(var o=0,l=ss.getAssemblyTypes(a);o<l.length;o++){var s=l[o];if(ss.isEnum(s)){var u=ss.getTypeFullName(s);i[u]=s;var c=ss.getAttributes(s,e.EnumKeyAttribute,false);if(c!=null&&c.length>0){i[c[0].value]=s}for(var d=0,f=Q.Config.rootNamespaces;d<f.length;d++){var p=f[d];if(Q.startsWith(u,p+".")){i[u.substr(p.length+1)]=s}}}}}}if(i[t]==null)return null;return i[t]}t.tryGet=r;function n(e){var i=t.tryGet(e);if(i==null){var r=Q.format("Can't find {0} enum type! If you have recently defined this enum type "+"in server side code, make sure your project builds successfully and transform T4 templates. "+"Also make sure that enum is under your project root namespace, and your namespace parts starts "+"with capital letters, e.g.MyProject.Pascal.Cased namespace",e);Q.notifyError(r,"",null);throw new ss.Exception(r)}return i}t.get=n})(t=e.EnumTypeRegistry||(e.EnumTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function e(e){this.idPrefix=e}e.prototype.byId=function(e){return $("#"+this.idPrefix+e)};e.prototype.w=function(e,t){return $("#"+this.idPrefix+e).getWidget(t)};return e}();e.PrefixedContext=t;var i;(function(t){function i(t,i){if(i==null){return}var n=ss.getInstanceType(t);if(n===Object){return}var a=n.__propByName;var o=n.__fieldByName;if(a==null){var l=ss.getMembers(n,16,20);var s=l.filter(function(t){return!!t.setter&&((t.attr||[]).filter(function(t){return ss.isInstanceOfType(t,e.OptionAttribute)}).length>0||(t.attr||[]).filter(function(e){return ss.isInstanceOfType(e,System.ComponentModel.DisplayNameAttribute)}).length>0)});a={};for(var u=0,c=s;u<c.length;u++){var d=c[u];a[r.makeCamelCase(d.name)]=d}n.__propByName=a}if(o==null){var f=ss.getMembers(n,4,20);var p=f.filter(function(t){return(t.attr||[]).filter(function(t){return ss.isInstanceOfType(t,e.OptionAttribute)}).length>0||(t.attr||[]).filter(function(e){return ss.isInstanceOfType(e,System.ComponentModel.DisplayNameAttribute)}).length>0});o={};for(var h=0;h<p.length;h++){var g=p[h];o[r.makeCamelCase(g.name)]=g}n.__fieldByName=o}var y=Object.keys(i);for(var v=0,m=y;v<m.length;v++){var b=m[v];var C=i[b];var _=r.makeCamelCase(b);var x=a[_]||a[b];if(x!=null){ss.midel(x.setter,t)(C)}else{var S=o[_]||o[b];if(S!=null){ss.fieldAccess(S,t,C)}}}}t.set=i})(i=e.ReflectionOptionsSetter||(e.ReflectionOptionsSetter={}));var r;(function(e){function t(e,t){var i=e;var n=i["get_"+t];if(!!!(typeof n==="undefined")){return n.apply(e)}var a=r(t);n=i["get_"+a];if(!!!(typeof n==="undefined")){return n.apply(e)}return i[a]}e.getPropertyValue=t;function i(e,t,i){var n=e;var a=n["set_"+t];if(!!!(typeof a==="undefined")){a.apply(e,[i]);return}var o=r(t);a=n["set_"+o];if(!!!(typeof a==="undefined")){a.apply(e,[i]);return}n[o]=i}e.setPropertyValue=i;function r(e){if(Q.isEmptyOrNull(e)){return e}if(e==="ID"){return"id"}var t=false;var i=0;for(var r=0;r<e.length;r++){if(e.charCodeAt(r)>=65&&e.charCodeAt(r)<=90){i++}else{t=true;break}}if(!t&&e.length!==1||i===0){return e}else if(i>1){return e.substr(0,i-1).toLowerCase()+e.substr(i-1)}else if(e.length===1){return e.toLowerCase()}else{return e.substr(0,1).toLowerCase()+e.substr(1)}}e.makeCamelCase=r})(r=e.ReflectionUtils||(e.ReflectionUtils={}));var n=function(){function t(){}t=__decorate([e.Decorators.registerClass("Serenity.ScriptContext")],t);return t}();e.ScriptContext=n})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e,t){if(e==null){throw new ss.ArgumentNullException("element")}if(e.length===0){throw new ss.Exception(Q.format("Searching for widget of type '{0}' on a non-existent element! ({1})",ss.getTypeFullName(t),e.selector))}var i=e.tryGetWidget(t);if(i==null){var r=Q.format("Element has no widget of type '{0}'! If you have recently changed editor "+"type of a property in a form class, or changed data type in row (which also changes editor type)"+" your script side Form definition might be out of date. Make sure your project builds successfully "+"and transform T4 templates",ss.getTypeFullName(t));Q.notifyError(r,"",null);throw new ss.Exception(r)}return i}e.getWidget=t;function i(e){return Q.replaceAll(ss.getTypeFullName(e),".","_")}e.getWidgetName=i;function r(e){return!!!(typeof e.originalEvent==="undefined")}e.hasOriginalEvent=r;function n(e,t){e.element.bind("change."+e.uniqueName,t)}e.change=n;function a(e,t){e.element.bind("change."+e.uniqueName,function(e,i){if(!!(r(e)||!i)){t(e)}})}e.changeSelect2=a;function o(e){return e.element.closest(".field")}e.getGridField=o})(t=e.WX||(e.WX={}));e.Widget.prototype["changeSelect2"]=function(e){var i=this;i.element.bind("change."+i.uniqueName,function(i,r){if(!!(t.hasOriginalEvent(i)||!r)){e(i)}})};e.Widget.prototype["change"]=function(e){var t=this;t.element.bind("change."+t.uniqueName,e)};e.Widget.prototype["getGridField"]=function(){return this.element.closest(".field")};$.fn.tryGetWidget=function(i){var r=this;var n;if(ss.isAssignableFrom(e.Widget,i)){var a=t.getWidgetName(i);n=r.data(a);if(n!=null&&!ss.isAssignableFrom(i,ss.getInstanceType(n))){n=null}if(n!=null){return n}}var o=r.data();if(o==null){return null}for(var l=0,s=Object.keys(o);l<s.length;l++){var u=s[l];n=o[u];if(n!=null&&ss.isAssignableFrom(i,ss.getInstanceType(n))){return n}}return null};$.fn.getWidget=function(e){var t=this;if(t==null){throw new ss.ArgumentNullException("element")}if(t.length===0){throw new ss.Exception(Q.format("Searching for widget of type '{0}' on a non-existent element! ({1})",ss.getTypeFullName(e),t.selector))}var i=t.tryGetWidget(e);if(i==null){var r=Q.format("Element has no widget of type '{0}'! If you have recently changed "+"editor type of a property in a form class, or changed data type in row (which also changes "+"editor type) your script side Form definition might be out of date. Make sure your project "+"builds successfully and transform T4 templates",ss.getTypeFullName(e));Q.notifyError(r,"",null);throw new ss.Exception(r)}return i}})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.categoryLinkClick=function(e){e.preventDefault();var t=$("a[name="+e.target.getAttribute("href").toString().substr(1)+"]");if(t.closest(".category").hasClass("collapsed"))t.closest(".category").children(".category-title").click();var i=function(){t.fadeTo(100,.5,function(){t.fadeTo(100,1,function(){})})};var r=t.closest(".category");if(r.closest(":scrollable(both)").length===0)i();else{r.scrollintoview({duration:"fast",direction:"y",complete:i})}};if(i.mode==null)i.mode=1;e.addClass("s-PropertyGrid");r.editors=[];var n=r.options.items||[];r.items=[];var a=Q.any(n,function(e){return!Q.isEmptyOrNull(e.tab)});if(a){var o=n.filter(function(e){return Q.isEmptyOrNull(e.tab)});if(o.length>0){r.createItems(r.element,o);$("<div class='pad'></div>").appendTo(r.element)}var l=n.filter(function(e){return!Q.isEmptyOrNull(e.tab)});var s=$("<ul class='nav nav-tabs property-tabs' role='tablist'></ul>").appendTo(r.element);var u=$("<div class='tab-content property-panes'></div>").appendTo(r.element);var c=0;var d=0;while(d<l.length){var f={$:Q.trimToEmpty(l[d].tab)};var p=[];var h=d;do{p.push(l[h])}while(++h<l.length&&Q.trimToEmpty(l[h].tab)===f.$);d=h;var g=$("<li><a data-toggle='tab' role='tab'></a></li>").appendTo(s);if(c===0){g.addClass("active")}var y=r.uniqueName+"_Tab"+c;g.children("a").attr("href","#"+y).text(r.determineText(f.$,ss.mkdel({tab:f},function(e){return e+"Tabs."+this.tab.$})));var v=$("<div class='tab-pane fade' role='tabpanel'>").appendTo(u);if(c===0){v.addClass("in active")}v.attr("id",y);r.createItems(v,p);c++}}else{r.createItems(r.element,n)}r.updateInterface();return r}r=i;i.prototype.destroy=function(){if(this.editors!=null){for(var t=0;t<this.editors.length;t++){this.editors[t].destroy()}this.editors=null}this.element.find("a.category-link").unbind("click",this.categoryLinkClick).remove();e.Widget.prototype.destroy.call(this)};i.prototype.createItems=function(e,t){var i={};var r=e;var n=this.options.useCategories!==false&&Q.any(t,function(e){return!Q.isEmptyOrNull(e.category)});if(n){var a=$("<div/>").addClass("category-links");i=this.createCategoryLinks(a,t);if(Object.keys(i).length>1){a.appendTo(e)}else{a.find("a.category-link").unbind("click",this.categoryLinkClick).remove()}}r=$("<div/>").addClass("categories").appendTo(e);var o;if(n){o=r}else{o=$("<div/>").addClass("category").appendTo(r)}var l=null;for(var s=0;s<t.length;s++){var u=t[s];var c=u.category;if(c==null){c=Q.coalesce(this.options.defaultCategory,"")}if(n&&l!==c){var d=this.createCategoryDiv(r,i,c,u.collapsible!==true?null:Q.coalesce(u.collapsed,false));if(l==null){d.addClass("first-category")}l=c;o=d}var f=this.createField(o,u);this.items.push(u);this.editors.push(f)}};i.prototype.createCategoryDiv=function(e,t,i,r){var n=$("<div/>").addClass("category").appendTo(e);var a=$("<div/>").addClass("category-title").append($("<a/>").addClass("category-anchor").text(this.determineText(i,function(e){return e+"Categories."+i})).attr("name",this.options.idPrefix+"Category"+t[i].toString())).appendTo(n);if(r!=null){n.addClass(r===true?"collapsible collapsed":"collapsible");var o=$("<i/>").addClass(r===true?"fa fa-plus":"fa fa-minus").appendTo(a);a.click(function(e){n.toggleClass("collapsed");o.toggleClass("fa-plus").toggleClass("fa-minus")})}return n};i.prototype.determineText=function(e,t){if(e!=null&&!Q.startsWith(e,"`")){var i=Q.tryGetText(e);if(i!=null){return i}}if(e!=null&&Q.startsWith(e,"`")){e=e.substr(1)}if(!Q.isEmptyOrNull(this.options.localTextPrefix)){var r=Q.tryGetText(t(this.options.localTextPrefix));if(r!=null){return r}}return e};i.prototype.createField=function(t,i){var n=$("<div/>").addClass("field").addClass(i.name).data("PropertyItem",i).appendTo(t);if(!Q.isEmptyOrNull(i.cssClass)){n.addClass(i.cssClass)}if(!Q.isEmptyOrNull(i.formCssClass)){n.addClass(i.formCssClass);if(i.formCssClass.indexOf("line-break-")>=0){var a=i.formCssClass.split(String.fromCharCode(32));if(a.indexOf("line-break-xs")>=0){$("<div class='line-break' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-sm")>=0){$("<div class='line-break hidden-xs' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-md")>=0){$("<div class='line-break hidden-sm' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-lg")>=0){$("<div class='line-break hidden-md' style='width: 100%' />").insertBefore(n)}}}var o=this.options.idPrefix+i.name;var l=this.determineText(i.title,function(e){return e+i.name});var s=this.determineText(i.hint,function(e){return e+i.name+"_Hint"});var u=this.determineText(i.placeholder,function(e){return e+i.name+"_Placeholder"});if(s==null){s=Q.coalesce(l,"")}var c=$("<label/>").addClass("caption").attr("for",o).attr("title",s).html(Q.coalesce(l,"")).appendTo(n);if(!Q.isEmptyOrNull(i.labelWidth)){if(i.labelWidth==="0"){c.hide()}else{c.css("width",i.labelWidth)}}if(i.required===true){$("<sup>*</sup>").attr("title",Q.text("Controls.PropertyGrid.RequiredHint")).prependTo(c)}var d=e.EditorTypeRegistry.get(Q.coalesce(i.editorType,"String"));var f=ss.getAttributes(d,e.ElementAttribute,true);var p=f.length>0?f[0].value:"<input/>";var h=e.Widget.elementFor(d).addClass("editor").addClass("flexify").attr("id",o).appendTo(n);if(h.is(":input")){h.attr("name",Q.coalesce(i.name,""))}if(!Q.isEmptyOrNull(u)){h.attr("placeholder",u)}var g=i.editorParams;var y=null;var v=ss.getAttributes(d,e.OptionsTypeAttribute,true);if(v!=null&&v.length>0){y=v[0].optionsType}var m;if(y!=null){g=$.extend(ss.createInstance(y),i.editorParams);m=new d(h,g)}else{g=$.extend(new Object,i.editorParams);m=new d(h,g)}m.initialize();if(ss.isInstanceOfType(m,e.BooleanEditor)&&(i.editorParams==null||!!!i.editorParams["labelFor"])){c.removeAttr("for")}if(ss.isInstanceOfType(m,e.RadioButtonEditor)&&(i.editorParams==null||!!!i.editorParams["labelFor"])){c.removeAttr("for")}if(i.maxLength!=null){r.setMaxLength(m,i.maxLength)}if(i.editorParams!=null){e.ReflectionOptionsSetter.set(m,i.editorParams)}$("<div/>").addClass("vx").appendTo(n);$("<div/>").addClass("clear").appendTo(n);return m};i.prototype.getCategoryOrder=function(e){var t=0;var i={};var r=Q.trimToNull(this.options.categoryOrder);if(r!=null){var n=r.split(";");for(var a=0,o=n;a<o.length;a++){var l=o[a];var s=Q.trimToNull(l);if(s==null){continue}if(i[s]!=null){continue}i[s]=t++}}for(var u=0,c=e;u<c.length;u++){var d=c[u];var f=d.category;if(f==null){f=Q.coalesce(this.options.defaultCategory,"")}if(i[f]==null){i[f]=t++}}return i};i.prototype.createCategoryLinks=function(e,t){var i=0;
var r={};var n={};for(var a=0,o=t;a<o.length;a++){var l=o[a];var s=l.name;var u=l.category;if(u==null){u=Q.coalesce(this.options.defaultCategory,"")}n[s]=u;r[l.name]=i++}var c=this;var d=this.getCategoryOrder(t);t.sort(function(e,t){var i=0;var a=n[e.name];var o=n[t.name];if(!ss.referenceEquals(a,o)){var l=d[a];var s=d[o];if(l!=null&&s!=null){i=l-s}else if(l!=null){i=-1}else if(s!=null){i=1}}if(i===0){i=ss.compareStrings(a,o)}if(i===0){i=ss.compare(r[e.name],r[t.name])}return i});var f={};for(var p=0;p<t.length;p++){var h=t[p];var g={$:n[h.name]};if(f[g.$]==null){var y=Object.keys(f).length+1;f[g.$]=y;if(y>1){$("<span/>").addClass("separator").text("|").prependTo(e)}$("<a/>").addClass("category-link").text(this.determineText(g.$,ss.mkdel({category:g},function(e){return e+"Categories."+this.category.$}))).attr("tabindex","-1").attr("href","#"+this.options.idPrefix+"Category"+y.toString()).click(this.categoryLinkClick).prependTo(e)}}$("<div/>").addClass("clear").appendTo(e);return f};i.prototype.get_editors=function(){return this.editors};i.prototype.get_items=function(){return this.items};i.prototype.get_idPrefix=function(){return this.options.idPrefix};i.prototype.get_mode=function(){return this.options.mode};i.prototype.set_mode=function(e){if(this.options.mode!==e){this.options.mode=e;this.updateInterface()}};i.loadEditorValue=function(e,t,i){};i.saveEditorValue=function(t,i,r){e.EditorUtils.saveValue(t,i,r)};i.setReadOnly=function(t,i){e.EditorUtils.setReadOnly(t,i)};i.setReadonly=function(t,i){return e.EditorUtils.setReadonly(t,i)};i.setRequired=function(t,i){e.EditorUtils.setRequired(t,i)};i.setMaxLength=function(e,t){if(e.element.is(":input")){if(t>0){e.element.attr("maxlength",t)}else{e.element.removeAttr("maxlength")}}};i.prototype.load=function(t){for(var i=0;i<this.editors.length;i++){var r=this.items[i];var n=this.editors[i];if(!!(this.get_mode()===1&&r.defaultValue!=null)&&typeof t[r.name]==="undefined"){t[r.name]=r.defaultValue}e.EditorUtils.loadValue(n,r,t)}};i.prototype.save=function(t){if(t==null)t=Object.create(null);for(var i=0;i<this.editors.length;i++){var r=this.items[i];if(r.oneWay!==true&&this.canModifyItem(r)){var n=this.editors[i];e.EditorUtils.saveValue(n,r,t)}}return t};Object.defineProperty(i.prototype,"value",{get:function(){return this.save()},set:function(e){if(e==null)e=Object.create(null);this.load(e)},enumerable:true,configurable:true});i.prototype.canModifyItem=function(e){if(this.get_mode()===1){if(e.insertable===false){return false}if(e.insertPermission==null){return true}return Q.Authorization.hasPermission(e.insertPermission)}else if(this.get_mode()===2){if(e.updatable===false){return false}if(e.updatePermission==null){return true}return Q.Authorization.hasPermission(e.updatePermission)}return true};i.prototype.updateInterface=function(){for(var t=0;t<this.editors.length;t++){var i=this.items[t];var r=this.editors[t];var n=i.readOnly===true||!this.canModifyItem(i);e.EditorUtils.setReadOnly(r,n);e.EditorUtils.setRequired(r,!n&&!!i.required&&i.editorType!=="Boolean");if(i.visible===false||i.readPermission!=null||i.insertPermission!=null||i.updatePermission!=null||i.hideOnInsert===true||i.hideOnUpdate===true){var a=i.readPermission!=null&&!Q.Authorization.hasPermission(i.readPermission)||i.visible===false||this.get_mode()===1&&i.hideOnInsert===true||this.get_mode()===2&&i.hideOnUpdate===true;r.getGridField().toggle(!a)}}};i.prototype.enumerateItems=function(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t];var r=this.editors[t];e(i,r)}};var r;i=r=__decorate([e.Decorators.registerClass("PropertyGrid")],i);return i}(e.Widget);e.PropertyGrid=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("s-PopupMenuButton");e.click(function(e){e.preventDefault();e.stopPropagation();if(r.options.onPopup!=null){r.options.onPopup()}var t=r.options.menu;t.show().position({my:Q.coalesce(r.options.positionMy,"left top"),at:Q.coalesce(r.options.positionAt,"left bottom"),of:r.element});var i=r.uniqueName;$(document).one("click."+i,function(e){t.hide()})});r.options.menu.hide().appendTo(document.body).addClass("s-PopupMenu").menu();return r}i.prototype.destroy=function(){if(this.options.menu!=null){this.options.menu.remove();this.options.menu=null}t.prototype.destroy.call(this)};i=__decorate([e.Decorators.registerEditor("Serenity.PopupMenuButton")],i);return i}(e.Widget);e.PopupMenuButton=t;var i=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("s-PopupToolButton");$("<b/>").appendTo(e.children(".button-outer").children("span"));return r}i=__decorate([e.Decorators.registerEditor("Serenity.PopupToolButton")],i);return i}(t);e.PopupToolButton=i;var r=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.element.addClass("s-Toolbar clearfix").html('<div class="tool-buttons"><div class="buttons-outer">'+'<div class="buttons-inner"></div></div></div>');var n=$("div.buttons-inner",r.element);var a=r.options.buttons;for(var o=0;o<a.length;o++){r.createButton(n,a[o])}return r}i.prototype.destroy=function(){this.element.find("div.tool-button").unbind("click");if(this.mouseTrap){if(!!this.mouseTrap.destroy){this.mouseTrap.destroy()}else{this.mouseTrap.reset()}this.mouseTrap=null}t.prototype.destroy.call(this)};i.prototype.createButton=function(e,t){var i=Q.coalesce(t.cssClass,"");if(t.separator===true||t.separator==="left"||t.separator==="both"){$('<div class="separator"></div>').appendTo(e)}var r=$('<div class="tool-button"><div class="button-outer">'+'<span class="button-inner"></span></div></div>').appendTo(e);if(t.separator==="right"||t.separator==="both"){$('<div class="separator"></div>').appendTo(e)}if(i.length>0){r.addClass(i)}if(!Q.isEmptyOrNull(t.hint)){r.attr("title",t.hint)}r.click(function(e){if(r.hasClass("disabled")){return}t.onClick(e)});var n=t.title;if(t.htmlEncode!==false){n=Q.htmlEncode(t.title)}if(!Q.isEmptyOrNull(t.icon)){r.addClass("icon-tool-button");var a=t.icon;if(Q.startsWith(a,"fa-")){a="fa "+a}else if(Q.startsWith(a,"glyphicon-")){a="glyphicon "+a}n="<i class='"+a+"'></i> "+n}if(n==null||n.length===0){r.addClass("no-text")}else{r.find("span").html(n)}if(t.visible===false)r.hide();if(t.disabled!=null&&typeof t.disabled!=="function")r.toggleClass("disabled",!!t.disabled);if(typeof t.visible==="function"||typeof t.disabled=="function"){r.on("updateInterface",function(){if(typeof t.visible==="function")r.toggle(!!t.visible());if(typeof t.disabled==="function")r.toggleClass("disabled",!!t.disabled())})}if(!!(!Q.isEmptyOrNull(t.hotkey)&&window["Mousetrap"]!=null)){this.mouseTrap=this.mouseTrap||window["Mousetrap"](t.hotkeyContext||this.options.hotkeyContext||window.document.documentElement);this.mouseTrap.bind(t.hotkey,function(e,i){if(r.is(":visible")){r.triggerHandler("click")}return t.hotkeyAllowDefault})}};i.prototype.findButton=function(e){if(e!=null&&Q.startsWith(e,".")){e=e.substr(1)}return $("div.tool-button."+e,this.element)};i.prototype.updateInterface=function(){this.element.find(".tool-button").each(function(e,t){$(t).triggerHandler("updateInterface")})};i=__decorate([e.Decorators.registerClass("Serenity.Toolbar")],i);return i}(e.Widget);e.Toolbar=r})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IValidateRequired")],t);return t}();e.IValidateRequired=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IDialog")],t);return t}();e.IDialog=t;var i=function(t){__extends(i,t);function i(e){var i=t.call(this,Q.newBodyDiv().addClass("s-TemplatedDialog hidden"),e)||this;i.element.attr("id",i.uniqueName);i.initValidator();i.initTabs();i.initToolbar();return i}r=i;Object.defineProperty(i.prototype,"isMarkedAsPanel",{get:function(){var t=ss.getAttributes(ss.getInstanceType(this),e.PanelAttribute,true);return t.length>0&&t[t.length-1].value!==false},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"isResponsive",{get:function(){return Q.Config.responsiveDialogs||ss.getAttributes(ss.getInstanceType(this),e.ResponsiveAttribute,true).length>0},enumerable:true,configurable:true});i.getCssSize=function(e,t){var i=e.css(t);if(i==null){return null}if(!Q.endsWith(i,"px")){return null}i=i.substr(0,i.length-2);var r=Q.parseInteger(i);if(r==null||isNaN(r)||r==0)return null;return r};i.applyCssSizes=function(e,t){var i;var n=$("<div/>").hide().addClass(t).appendTo(document.body);try{var a=$("<div/>").addClass("size").appendTo(n);i=r.getCssSize(a,"minWidth");if(i!=null)e.minWidth=i;i=r.getCssSize(a,"width");if(i!=null)e.width=i;i=r.getCssSize(a,"height");if(i!=null)e.height=i;i=r.getCssSize(a,"minHeight");if(i!=null)e.minHeight=i}finally{n.remove()}};i.prototype.destroy=function(){this.tabs&&this.tabs.tabs("destroy");this.tabs=null;this.toolbar&&this.toolbar.destroy();this.toolbar=null;this.validator&&this.byId("Form").remove();this.validator=null;if(this.element!=null&&this.element.hasClass("ui-dialog-content")){this.element.dialog("destroy");this.element.removeClass("ui-dialog-content")}$(window).unbind("."+this.uniqueName);t.prototype.destroy.call(this)};i.prototype.initDialog=function(){var t=this;if(this.element.hasClass("ui-dialog-content"))return;this.element.removeClass("hidden");this.element.dialog(this.getDialogOptions());this.element.closest(".ui-dialog").on("resize",function(e){return t.arrange()});var i=ss.getInstanceType(this);if(this.isResponsive){e.DialogExtensions.dialogResizable(this.element);$(window).bind("resize."+this.uniqueName,function(e){if(t.element&&t.element.is(":visible")){t.handleResponsive()}});this.element.closest(".ui-dialog").addClass("flex-layout")}else if(ss.getAttributes(i,e.FlexifyAttribute,true).length>0){e.DialogExtensions.dialogFlexify(this.element);e.DialogExtensions.dialogResizable(this.element)}if(ss.getAttributes(i,e.MaximizableAttribute,true).length>0){e.DialogExtensions.dialogMaximizable(this.element)}var r=this;this.element.bind("dialogopen."+this.uniqueName,function(){$(document.body).addClass("modal-dialog-open");if(t.isResponsive){t.handleResponsive()}r.onDialogOpen()});this.element.bind("dialogclose."+this.uniqueName,function(){$(document.body).toggleClass("modal-dialog-open",$(".ui-dialog:visible").length>0);r.onDialogClose()})};i.prototype.initToolbar=function(){var t=this.byId("Toolbar");if(t.length===0){return}var i=this.element.closest(".ui-dialog");if(i.length===0){i=this.element}var r={buttons:this.getToolbarButtons(),hotkeyContext:i[0]};this.toolbar=new e.Toolbar(t,r)};i.prototype.getToolbarButtons=function(){return[]};i.prototype.getValidatorOptions=function(){return{}};i.prototype.initValidator=function(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(Q.validateOptions(t))}};i.prototype.resetValidation=function(){this.validator&&this.validator.resetAll()};i.prototype.validateForm=function(){return this.validator==null||!!this.validator.form()};i.prototype.dialogOpen=function(e){var t=this;e=Q.coalesce(e,this.isMarkedAsPanel);if(e){if(!this.element.hasClass("s-Panel")){this.element.on("panelopen."+this.uniqueName,function(){t.onDialogOpen()});this.element.on("panelclose."+this.uniqueName,function(){t.onDialogClose()})}r.openPanel(this.element,this.uniqueName);this.setupPanelTitle()}else{if(!this.element.hasClass("ui-dialog-content"))this.initDialog();this.element.dialog("open")}};i.openPanel=function(e,t){var i=$(".panels-container");if(!i.length)i=$("section.content");e.data("paneluniquename",t);if(i.length){i=i.last();i.children().not(e).not(".panel-hidden").addClass("panel-hidden panel-hidden-"+t);if(e[0].parentElement!==i[0])e.appendTo(i)}$(".ui-dialog:visible, .ui-widget-overlay:visible").not(e).addClass("panel-hidden panel-hidden-"+t);e.removeClass("hidden").removeClass("panel-hidden").addClass("s-Panel").trigger("panelopen")};i.closePanel=function(e,t){if(!e.hasClass("s-Panel")||e.hasClass("hidden"))return;var i=$.Event(t);i.type="panelbeforeclose";i.target=e[0];e.trigger(i);if(i.isDefaultPrevented())return;e.addClass("hidden");var r=e.data("paneluniquename")||(new Date).getTime();var n="panel-hidden-"+r;$("."+n).removeClass(n).removeClass("panel-hidden");$(window).triggerHandler("resize");$(".require-layout:visible").triggerHandler("layout");var t=$.Event(t);t.type="panelclose";t.target=e[0];e.trigger(t)};i.prototype.onDialogOpen=function(){if(!$(document.body).hasClass("mobile-device"))$(":input",this.element).not("button").eq(0).focus();this.arrange();this.tabs&&this.tabs.tabs("option","active",0)};i.prototype.arrange=function(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})};i.prototype.onDialogClose=function(){var e=this;$(document).trigger("click");if($.qtip){$(document.body).children(".qtip").each(function(e,t){$(t).qtip("hide")})}window.setTimeout(function(){var t=e.element;e.destroy();t.remove();Q.positionToastContainer(false)},0)};i.prototype.addCssClass=function(){if(this.isMarkedAsPanel){t.prototype.addCssClass.call(this);if(this.isResponsive)this.element.addClass("flex-layout")}};i.prototype.getDialogOptions=function(){var t={};var i="s-Dialog "+this.getCssClass();t.dialogClass=i;t.width=920;r.applyCssSizes(t,i);t.autoOpen=false;var n=ss.getInstanceType(this);t.resizable=ss.getAttributes(n,e.ResizableAttribute,true).length>0;t.modal=true;t.position={my:"center",at:"center",of:$(window.window)};t.title=Q.coalesce(this.element.data("dialogtitle"),this.getDialogTitle())||"";return t};i.prototype.getDialogTitle=function(){return""};i.prototype.dialogClose=function(){if(this.element.hasClass("ui-dialog-content"))this.element.dialog().dialog("close");else if(this.element.hasClass("s-Panel")&&!this.element.hasClass("hidden")){r.closePanel(this.element)}};Object.defineProperty(i.prototype,"dialogTitle",{get:function(){if(this.element.hasClass("ui-dialog-content"))return this.element.dialog("option","title");return this.element.data("dialogtitle")},set:function(e){var t=this.dialogTitle;this.element.data("dialogtitle",e);if(this.element.hasClass("ui-dialog-content"))this.element.dialog("option","title",e);else if(this.element.hasClass("s-Panel")){if(t!=this.dialogTitle){this.setupPanelTitle();this.arrange()}}},enumerable:true,configurable:true});i.prototype.setupPanelTitle=function(){var e=this;var t=Q.coalesce(this.dialogTitle,this.getDialogTitle());var i=this.element.children(".panel-titlebar");if(Q.isEmptyOrNull(t)){i.remove()}else{if(!this.element.children(".panel-titlebar").length){i=$("<div class='panel-titlebar'><div class='panel-titlebar-text'></div></div>").prependTo(this.element)}i.children(".panel-titlebar-text").text(t);if(this.element.hasClass("s-Panel")){if(!i.children(".panel-titlebar-close").length){$('<button class="panel-titlebar-close">&nbsp;</button>').prependTo(i).click(function(t){r.closePanel(e.element,t)})}}}};i.prototype.set_dialogTitle=function(e){this.dialogTitle=e};i.prototype.initTabs=function(){var e=this;var t=this.byId("Tabs");if(t.length===0){return}this.tabs=t.tabs({});this.tabs.bind("tabsactivate",function(){return e.arrange()})};i.prototype.handleResponsive=function(){var e=this.element.dialog();var t=this.element.closest(".ui-dialog");if($(document.body).hasClass("mobile-device")){var i=this.element.data("responsiveData");if(!i){i={};i.draggable=e.dialog("option","draggable");i.resizable=e.dialog("option","resizable");i.position=e.css("position");var r=t.position();i.left=r.left;i.top=r.top;i.width=t.width();i.height=t.height();i.contentHeight=this.element.height();this.element.data("responsiveData",i);e.dialog("option","draggable",false);e.dialog("option","resizable",false)}t.addClass("mobile-layout");t.css({left:"0px",top:"0px",width:$(window).width()+"px",height:$(window).height()+"px",position:"fixed"});$(document.body).scrollTop(0);Q.layoutFillHeight(this.element)}else{var n=this.element.data("responsiveData");if(n){e.dialog("option","draggable",n.draggable);e.dialog("option","resizable",n.resizable);this.element.closest(".ui-dialog").css({left:"0px",top:"0px",width:n.width+"px",height:n.height+"px",position:n.position});this.element.height(n.contentHeight);t.removeClass("mobile-layout");this.element.removeData("responsiveData")}}};var r;i=r=__decorate([e.Decorators.registerClass([e.IDialog])],i);return i}(e.TemplatedWidget);e.TemplatedDialog=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;if(!i.isAsyncWidget()){i.initPropertyGrid();i.loadInitialEntity()}return i}i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.validator){this.byId("Form").remove();this.validator=null}t.prototype.destroy.call(this)};i.prototype.initPropertyGridAsync=function(){var t=this;return Promise.resolve().then(function(){var i=t.byId("PropertyGrid");if(i.length<=0){return Promise.resolve()}return t.getPropertyGridOptionsAsync().then(function(r){t.propertyGrid=new e.PropertyGrid(i,r);if(t.element.closest(".ui-dialog").hasClass("s-Flexify")){t.propertyGrid.element.children(".categories").flexHeightOnly(1)}return t.propertyGrid.initialize()})})};i.prototype.getDialogOptions=function(){var e=t.prototype.getDialogOptions.call(this);e.buttons=this.getDialogButtons();e.width=400;return e};i.prototype.getDialogButtons=function(){var e=this;return[{text:Q.text("Dialogs.OkButton"),click:function(){return e.okClick()}},{text:Q.text("Dialogs.CancelButton"),click:function(){return e.cancelClick()}}]};i.prototype.okClick=function(){if(!this.validateBeforeSave()){return}this.okClickValidated()};i.prototype.okClickValidated=function(){this.dialogClose()};i.prototype.cancelClick=function(){this.dialogClose()};i.prototype.initPropertyGrid=function(){var t=this.byId("PropertyGrid");if(t.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new e.PropertyGrid(t,i).init(null);if(this.element.closest(".ui-dialog").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.getFormKey=function(){var t=ss.getAttributes(ss.getInstanceType(this),e.FormKeyAttribute,true);if(t.length>=1){return t[0].value}else{var i=ss.getTypeFullName(ss.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Dialog")){i=i.substr(0,i.length-6)}else if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-5)}return i}};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:false,localTextPrefix:"Forms."+this.getFormKey()+"."}};i.prototype.getPropertyGridOptionsAsync=function(){var e=this;return this.getPropertyItemsAsync().then(function(t){return{idPrefix:e.idPrefix,items:t,mode:1,useCategories:false,localTextPrefix:"Forms."+e.getFormKey()+"."}})};i.prototype.getPropertyItems=function(){var e=this.getFormKey();return Q.getForm(e)};i.prototype.getPropertyItemsAsync=function(){var e=this;return Promise.resolve().then(function(){var t=e.getFormKey();return Q.getFormAsync(t)})};i.prototype.getSaveEntity=function(){var e=new Object;if(this.propertyGrid){this.propertyGrid.save(e)}return e};i.prototype.initializeAsync=function(){var e=this;return t.prototype.initializeAsync.call(this).then(function(){return e.initPropertyGridAsync()}).then(function(){return e.loadInitialEntity()})};i.prototype.loadInitialEntity=function(){this.propertyGrid&&this.propertyGrid.load(new Object)};i.prototype.get_entity=function(){return this._entity};i.prototype.set_entity=function(e){this._entity=Q.coalesce(e,new Object)};i.prototype.get_entityId=function(){return this._entityId};i.prototype.set_entityId=function(e){this._entityId=e};i.prototype.validateBeforeSave=function(){return this.validator.form()};i.prototype.updateTitle=function(){};i=__decorate([e.Decorators.registerClass("Serenity.PropertyDialog")],i);return i}(e.TemplatedDialog);e.PropertyDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(){var i=t.call(this)||this;i.filterPanel=new e.FilterPanel(i.byId("FilterPanel"));i.filterPanel.set_showInitialLine(true);i.filterPanel.set_showSearchButton(false);i.filterPanel.set_updateStoreOnReset(false);return i}i.prototype.get_filterPanel=function(){return this.filterPanel};i.prototype.getTemplate=function(){return'<div id="~_FilterPanel"/>'};i.prototype.getDialogOptions=function(){var e=this;var i=t.prototype.getDialogOptions.call(this);i.buttons=[{text:Q.text("Dialogs.OkButton"),click:function(){e.filterPanel.search();if(e.filterPanel.get_hasErrors()){Q.notifyError(Q.text("Controls.FilterPanel.FixErrorsMessage"),"",null);return}e.dialogClose()}},{text:Q.text("Dialogs.CancelButton"),click:function(){return e.dialogClose()}}];i.title=Q.text("Controls.FilterPanel.DialogTitle");return i};i=__decorate([e.Decorators.registerClass("Serenity.FilterDialog")],i);return i}(e.TemplatedDialog);e.FilterDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("quick-filters-bar").addClass("clear");var n=r.options.filters;for(var a=0;a<n.length;a++){var o=n[a];r.add(o)}r.options.idPrefix=Q.coalesce(r.options.idPrefix,r.uniqueName+"_");return r}r=i;i.prototype.addSeparator=function(){this.element.append($("<hr/>"))};i.prototype.add=function(t){var i=this;if(t==null){throw new ss.ArgumentNullException("opt")}if(t.separator){this.addSeparator()}var r=$("<div class='quick-filter-item'><span class='quick-filter-label'></span></div>").appendTo(this.element).data("qffield",t.field).children();var n=t.title;if(n==null){n=this.options.getTitle?this.options.getTitle(t):null;if(n==null){n=t.field}}var a=r.text(n).parent();if(t.displayText!=null){a.data("qfdisplaytext",t.displayText)}if(t.saveState!=null){a.data("qfsavestate",t.saveState)}if(t.loadState!=null){a.data("qfloadstate",t.loadState)}if(!Q.isEmptyOrNull(t.cssClass)){a.addClass(t.cssClass)}var o=e.Widget.create({type:t.type,element:function(e){if(!Q.isEmptyOrNull(t.field)){e.attr("id",i.options.idPrefix+t.field)}e.attr("placeholder"," ");e.appendTo(a);if(t.element!=null){t.element(e)}},options:t.options,init:t.init});var l=function(i){if(a.hasClass("ignore")){return}i.EqualityFilter=i.EqualityFilter||{};var r=e.EditorUtils.getValue(o);var n=r!=null&&!Q.isEmptyOrNull(r.toString());if(t.handler!=null){var l={field:t.field,request:i,equalityFilter:i.EqualityFilter,value:r,active:n,widget:o,handled:true};t.handler(l);a.toggleClass("quick-filter-active",l.active);if(!l.handled){i.EqualityFilter[t.field]=r}}else{i.EqualityFilter[t.field]=r;a.toggleClass("quick-filter-active",n)}};e.WX.changeSelect2(o,function(e){window.setTimeout(function(){return i.onChange&&i.onChange(e)},0)});this.add_submitHandlers(l);o.element.bind("remove."+this.uniqueName,function(e){i.remove_submitHandlers(l)});return o};i.prototype.addDateRange=function(e,t){return this.add(r.dateRange(e,t))};i.dateRange=function(t,i){var r=null;return{field:t,type:e.DateEditor,title:i,element:function(t){r=e.Widget.create({type:e.DateEditor,element:function(e){e.insertAfter(t)},options:null,init:null});r.element.change(function(e){t.triggerHandler("change")});$("<span/>").addClass("range-separator").text("-").insertAfter(t)},handler:function(t){var i=!Q.isTrimmedEmpty(t.widget.value);var n=!Q.isTrimmedEmpty(r.value);if(i&&!Q.parseDate(t.widget.element.val())){i=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);t.widget.element.val("")}if(n&&!Q.parseDate(r.element.val())){n=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);r.element.val("")}t.active=i||n;if(i){t.request.Criteria=e.Criteria.join(t.request.Criteria,"and",[[t.field],">=",t.widget.value])}if(n){var a=new Date(r.valueAsDate.valueOf());a.setDate(a.getDate()+1);t.request.Criteria=e.Criteria.join(t.request.Criteria,"and",[[t.field],"<",Q.formatDate(a,"yyyy-MM-dd")])}},displayText:function(t,i){var n=e.EditorUtils.getDisplayText(t);var a=e.EditorUtils.getDisplayText(r);if(Q.isEmptyOrNull(n)&&Q.isEmptyOrNull(a)){return null}var o=i+" >= "+n;var l=i+" <= "+a;if(!Q.isEmptyOrNull(n)&&!Q.isEmptyOrNull(a)){return o+" "+Q.coalesce(Q.tryGetText("Controls.FilterPanel.And"),"and")+" "+l}else if(!Q.isEmptyOrNull(n)){return o}else{return l}},saveState:function(t){return[e.EditorUtils.getValue(t),e.EditorUtils.getValue(r)]},loadState:function(t,i){if(i==null||!Q.isArray(i)||i.length!==2){i=[null,null]}e.EditorUtils.setValue(t,i[0]);e.EditorUtils.setValue(r,i[1])}}};i.prototype.addDateTimeRange=function(e,t){return this.add(r.dateTimeRange(e,t))};i.dateTimeRange=function(t,i){var r=null;return{field:t,type:e.DateTimeEditor,title:i,element:function(t){r=e.Widget.create({type:e.DateTimeEditor,element:function(e){e.insertAfter(t)},options:null,init:null});r.element.change(function(e){t.triggerHandler("change")});$("<span/>").addClass("range-separator").text("-").insertAfter(t)},init:function(e){e.element.parent().find(".time").change(function(t){e.element.triggerHandler("change")})},handler:function(t){var i=!Q.isTrimmedEmpty(t.widget.value);var n=!Q.isTrimmedEmpty(r.value);if(i&&!Q.parseDate(t.widget.element.val())){i=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);t.widget.element.val("")}if(n&&!Q.parseDate(r.element.val())){n=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);r.element.val("")}t.active=i||n;if(i){t.request.Criteria=e.Criteria.join(t.request.Criteria,"and",[[t.field],">=",t.widget.value])}if(n){t.request.Criteria=e.Criteria.join(t.request.Criteria,"and",[[t.field],"<=",r.value])}},displayText:function(t,i){var n=e.EditorUtils.getDisplayText(t);var a=e.EditorUtils.getDisplayText(r);if(Q.isEmptyOrNull(n)&&Q.isEmptyOrNull(a)){return null}var o=i+" >= "+n;var l=i+" <= "+a;if(!Q.isEmptyOrNull(n)&&!Q.isEmptyOrNull(a)){return o+" "+Q.coalesce(Q.tryGetText("Controls.FilterPanel.And"),"and")+" "+l}else if(!Q.isEmptyOrNull(n)){return o}else{return l}},saveState:function(t){return[e.EditorUtils.getValue(t),e.EditorUtils.getValue(r)]},loadState:function(t,i){if(i==null||!Q.isArray(i)||i.length!==2){i=[null,null]}e.EditorUtils.setValue(t,i[0]);e.EditorUtils.setValue(r,i[1])}}};i.prototype.addBoolean=function(e,t,i,n){return this.add(r.boolean(e,t,i,n))};i.boolean=function(t,i,r,n){var a={};var o=[];var l=r;if(l==null){l=Q.text("Controls.FilterPanel.OperatorNames.true")}o.push(["1",l]);var s=n;if(s==null){s=Q.text("Controls.FilterPanel.OperatorNames.false")}o.push(["0",s]);a.items=o;return{field:t,type:e.SelectEditor,title:i,options:a,handler:function(e){e.equalityFilter[e.field]=e.value==null||Q.isEmptyOrNull(e.value.toString())?null:!!Q.toId(e.value)}}};i.propertyItemToQuickFilter=function(t){var i={};var n=t.name;var a=Q.tryGetText(t.title);if(a==null){a=t.title;if(a==null){a=n}}var o=e.FilteringTypeRegistry.get(Q.coalesce(t.filteringType,"String"));if(o===e.DateFiltering){i=r.dateRange(n,a)}else if(o===e.DateTimeFiltering){i=r.dateTimeRange(n,a)}else if(o===e.BooleanFiltering){var l=t.quickFilterParams||{};var s=t.filteringParams||{};var u=l["trueText"];if(u==null){u=s["trueText"]}var c=l["falseText"];if(c==null){c=s["falseText"]}i=r.boolean(n,a,u,c)}else{var d=new o;if(d&&ss.isInstanceOfType(d,e.IQuickFiltering)){e.ReflectionOptionsSetter.set(d,t.filteringParams);d.set_field(t);d.set_operator({key:e.FilterOperators.EQ});d.initQuickFilter(i);i.options=Q.deepClone(i.options,t.quickFilterParams)}else{return null}}if(!!t.quickFilterSeparator){i.separator=true}i.cssClass=t.quickFilterCssClass;return i};i.prototype.destroy=function(){this.submitHandlers=null;t.prototype.destroy.call(this)};i.prototype.onSubmit=function(e){this.submitHandlers&&this.submitHandlers(e)};i.prototype.add_submitHandlers=function(e){this.submitHandlers=ss.delegateCombine(this.submitHandlers,e)};i.prototype.remove_submitHandlers=function(e){this.submitHandlers=ss.delegateRemove(this.submitHandlers,e)};i.prototype.clear_submitHandlers=function(){};i.prototype.find=function(e,t){return $("#"+this.options.idPrefix+t).getWidget(e)};i.prototype.tryFind=function(e,t){var i=$("#"+this.options.idPrefix+t);if(!i.length)return null;return i.tryGetWidget(e)};var r;i=r=__decorate([e.Decorators.registerClass("Serenity.QuickFilterBar"),e.Decorators.element("<div/>")],i);return i}(e.Widget);e.QuickFilterBar=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IDataGrid")],t);return t}();e.IDataGrid=t;var i=function(i){__extends(r,i);function r(e,t){var r=i.call(this,e,t)||this;r.restoringSettings=0;var n=r;r.element.addClass("s-DataGrid").html("");r.element.addClass("s-"+ss.getTypeName(ss.getInstanceType(r)));r.element.addClass("require-layout").bind("layout."+r.uniqueName,function(){n.layout()});r.setTitle(r.getInitialTitle());var a=r.getButtons();if(a!=null){r.createToolbar(a)}r.slickContainer=r.createSlickContainer();r.view=r.createView();r.slickGrid=r.createSlickGrid();if(r.enableFiltering()){r.createFilterBar()}if(r.usePager()){r.createPager()}r.bindToSlickEvents();r.bindToViewEvents();if(a!=null){r.createToolbarExtensions()}r.createQuickFilters();r.updateDisabledState();r.updateInterface();if(!r.isAsyncWidget()){r.initialSettings=r.getCurrentSettings(null);r.restoreSettings(null,null);window.setTimeout(function(){return r.initialPopulate()},0)}return r}r.prototype.attrs=function(e){return ss.getAttributes(ss.getInstanceType(this),e,true)};r.prototype.layout=function(){if(!this.element.is(":visible")||this.slickContainer==null)return;var e=this.element.hasClass("responsive-height");var t=this.slickGrid!=null&&this.slickGrid.getOptions().autoHeight;var i=e&&window.innerWidth<768;if(i){if(this.element[0]&&this.element[0].style.height!="auto")this.element[0].style.height="auto";if(!t){this.slickContainer.css("height","auto").children(".slick-pane").each(function(e,t){if(t.style.height!=null&&t.style.height!="auto")t.style.height="auto"});this.slickGrid.setOptions({autoHeight:true})}}else{if(t){this.slickContainer.children(".slick-viewport").css("height","auto");this.slickGrid.setOptions({autoHeight:false})}Q.layoutFillHeight(this.slickContainer)}this.slickGrid.resizeCanvas()};r.prototype.getInitialTitle=function(){return null};r.prototype.createToolbarExtensions=function(){};r.prototype.ensureQuickFilterBar=function(){if(this.quickFiltersDiv==null)this.createQuickFilters([]);return this.quickFiltersBar};r.prototype.createQuickFilters=function(t){var i=this;if(this.quickFiltersDiv==null&&(t!=null||(t=this.getQuickFilters())&&t!=null&&t.length)){$("<div/>").addClass("clear").appendTo(this.toolbar.element);this.quickFiltersDiv=$("<div/>").addClass("quick-filters-bar").appendTo(this.toolbar.element);this.quickFiltersBar=new e.QuickFilterBar(this.quickFiltersDiv,{filters:t,getTitle:function(e){return i.determineText(function(t){return t+e.field})},idPrefix:this.uniqueName+"_QuickFilter_"});this.quickFiltersBar.onChange=function(e){return i.quickFilterChange(e)}}};r.prototype.getQuickFilters=function(){return this.allColumns.filter(function(e){return e.sourceItem&&e.sourceItem.quickFilter===true&&(e.sourceItem.readPermission==null||Q.Authorization.hasPermission(e.sourceItem.readPermission))}).map(function(t){return e.QuickFilterBar.propertyItemToQuickFilter(t.sourceItem)}).filter(function(e){return e!=null})};r.prototype.findQuickFilter=function(e,t){if(this.quickFiltersBar!=null)return this.quickFiltersBar.find(e,t);return $("#"+this.uniqueName+"_QuickFilter_"+t).getWidget(e)};r.prototype.tryFindQuickFilter=function(e,t){if(this.quickFiltersBar!=null)return this.quickFiltersBar.tryFind(e,t);var i=$("#"+this.uniqueName+"_QuickFilter_"+t);if(!i.length)return null;return i.tryGetWidget(e)};r.prototype.createIncludeDeletedButton=function(){if(!Q.isEmptyOrNull(this.getIsActiveProperty())||!Q.isEmptyOrNull(this.getIsDeletedProperty())){e.GridUtils.addIncludeDeletedToggle(this.toolbar.element,this.view,null,false)
}};r.prototype.getQuickSearchFields=function(){return null};r.prototype.createQuickSearchInput=function(){e.GridUtils.addQuickSearchInput(this.toolbar.element,this.view,this.getQuickSearchFields())};r.prototype.destroy=function(){if(this.quickFiltersBar){this.quickFiltersBar.destroy();this.quickFiltersBar=null}if(this.toolbar){this.toolbar.destroy();this.toolbar=null}if(this.slickGrid){this.slickGrid.onClick.clear();this.slickGrid.onSort.clear();this.slickGrid.onColumnsResized.clear();this.slickGrid.onColumnsReordered.clear();this.slickGrid.destroy();this.slickGrid=null}if(this.view){this.view.onDataChanged.clear();this.view.onSubmit=null;this.view.setFilter(null);this.view=null}this.titleDiv=null;i.prototype.destroy.call(this)};r.prototype.getItemCssClass=function(e,t){var i=this.getIsActiveProperty();var r=this.getIsDeletedProperty();if(Q.isEmptyOrNull(i)&&Q.isEmptyOrNull(r)){return null}if(i){var n=e[i];if(n==null){return null}if(typeof n==="number"){if(n<0){return"deleted"}else if(n===0){return"inactive"}}else if(typeof n==="boolean"){if(n===false){return"deleted"}}}else{return e[r]?"deleted":null}return null};r.prototype.getItemMetadata=function(e,t){var i=this.getItemCssClass(e,t);if(Q.isEmptyOrNull(i)){return new Object}return{cssClasses:i}};r.prototype.postProcessColumns=function(t){e.SlickHelper.setDefaults(t,this.getLocalTextDbPrefix());return t};r.prototype.initialPopulate=function(){var t=this;if(this.populateWhenVisible()){e.LazyLoadHelper.executeEverytimeWhenShown(this.element,function(){t.refreshIfNeeded()},false);if(this.element.is(":visible")&&this.view){this.view.populate()}}else if(this.view){this.view.populate()}};r.prototype.canFilterColumn=function(e){return e.sourceItem!=null&&e.sourceItem.notFilterable!==true&&(e.sourceItem.readPermission==null||Q.Authorization.hasPermission(e.sourceItem.readPermission))};r.prototype.initializeFilterBar=function(){var t=this;this.filterBar.set_store(new e.FilterStore(this.allColumns.filter(function(e){return t.canFilterColumn(e)}).map(function(e){return e.sourceItem})));this.filterBar.get_store().add_changed(function(e,i){if(t.restoringSettings<=0){t.persistSettings(null);t.view&&(t.view.seekToPage=1);t.refresh()}})};r.prototype.initializeAsync=function(){var e=this;return i.prototype.initializeAsync.call(this).then(function(){return e.getColumnsAsync()}).then(function(t){e.allColumns=t;e.postProcessColumns(e.allColumns);e.filterBar&&e.initializeFilterBar();var i=e.allColumns.filter(function(e){return e.visible!==false});if(e.slickGrid){e.slickGrid.setColumns(i)}e.setInitialSortOrder();e.initialSettings=e.getCurrentSettings(null);e.restoreSettings(null,null);e.initialPopulate()},null)};r.prototype.createSlickGrid=function(){var e;if(this.isAsyncWidget()){e=[]}else{this.allColumns=this.getColumns();e=this.postProcessColumns(this.allColumns).filter(function(e){return e.visible!==false})}var t=this.getSlickOptions();var i=new Slick.Grid(this.slickContainer,this.view,e,t);i.registerPlugin(new Slick.AutoTooltips({enableForHeaderCells:true}));this.slickGrid=i;this.rows=this.slickGrid;if(!this.isAsyncWidget()){this.setInitialSortOrder()}return i};r.prototype.setInitialSortOrder=function(){var e=this.getDefaultSortBy();if(this.view){this.view.sortBy=Array.prototype.slice.call(e)}var t=e.map(function(e){var t={};if(e&&Q.endsWith(e.toLowerCase()," desc")){t.columnId=ss.trimEndString(e.substr(0,e.length-5));t.sortAsc=false}else{t.columnId=e;t.sortAsc=true}return t});this.slickGrid.setSortColumns(t)};r.prototype.itemAt=function(e){return this.slickGrid.getDataItem(e)};r.prototype.rowCount=function(){return this.slickGrid.getDataLength()};r.prototype.getItems=function(){return this.view.getItems()};r.prototype.setItems=function(e){this.view.setItems(e,true)};r.prototype.bindToSlickEvents=function(){var e=this;var t=this;this.slickGridOnSort=function(i,r){t.view.populateLock();try{var n=[];var a;if(!!r.multiColumnSort){for(var o=0;!!(o<r.sortCols.length);o++){var l=r.sortCols[o];a=l.sortCol;if(a==null){a={}}n.push(a.field+(!!l.sortAsc?"":" DESC"))}}else{var a=r.sortCol;if(a==null){a={}}n.push(a.field+(!!r.sortAsc?"":" DESC"))}t.view.seekToPage=1;t.view.sortBy=n}finally{t.view.populateUnlock()}t.view.populate();e.persistSettings(null)};this.slickGrid.onSort.subscribe(this.slickGridOnSort);this.slickGridOnClick=function(e,i){t.onClick(e,i.row,i.cell)};this.slickGrid.onClick.subscribe(this.slickGridOnClick);this.slickGrid.onColumnsReordered.subscribe(function(t,i){return e.persistSettings(null)});this.slickGrid.onColumnsResized.subscribe(function(t,i){return e.persistSettings(null)})};r.prototype.getAddButtonCaption=function(){return Q.coalesce(Q.tryGetText("Controls.DataGrid.NewButton"),"New")};r.prototype.getButtons=function(){return[]};r.prototype.editItem=function(e){throw new ss.NotImplementedException};r.prototype.editItemOfType=function(e,t){if(e===this.getItemType()){this.editItem(t);return}throw new ss.NotImplementedException};r.prototype.onClick=function(t,i,r){if(t.isDefaultPrevented()){return}var n=$(t.target);if(!n.hasClass("s-EditLink")){n=n.closest("a")}if(n.hasClass("s-EditLink")){t.preventDefault();this.editItemOfType(e.SlickFormatting.getItemType(n),e.SlickFormatting.getItemId(n))}};r.prototype.viewDataChanged=function(e,t){this.markupReady();this.layout()};r.prototype.bindToViewEvents=function(){var e=this;this.view.onDataChanged.subscribe(function(t,i){return e.viewDataChanged(t,i)});this.view.onSubmit=function(t){return e.onViewSubmit()};this.view.setFilter(function(t,i){return e.onViewFilter(t)});this.view.onProcessData=function(t,i){return e.onViewProcessData(t)}};r.prototype.onViewProcessData=function(e){return e};r.prototype.onViewFilter=function(e){return true};r.prototype.getIncludeColumns=function(e){var t=this.slickGrid.getColumns();for(var i=0,r=t;i<r.length;i++){var n=r[i];if(n.field){e[n.field]=true}if(n.referencedFields){for(var a=0,o=n.referencedFields;a<o.length;a++){var l=o[a];e[l]=true}}}};r.prototype.setCriteriaParameter=function(){delete this.view.params["Criteria"];if(this.filterBar){var t=this.filterBar.get_store().get_activeCriteria();if(!e.Criteria.isEmpty(t)){this.view.params.Criteria=t}}};r.prototype.setEquality=function(e,t){Q.setEquality(this.view.params,e,t)};r.prototype.setIncludeColumnsParameter=function(){var e={};this.getIncludeColumns(e);var t=[];for(var i=0,r=Object.keys(e);i<r.length;i++){var n=r[i];t.push(n)}this.view.params.IncludeColumns=t};r.prototype.onViewSubmit=function(){if(this.isDisabled||!this.getGridCanLoad()){return false}this.setCriteriaParameter();this.setIncludeColumnsParameter();this.invokeSubmitHandlers();return true};r.prototype.markupReady=function(){};r.prototype.createSlickContainer=function(){return $('<div class="grid-container"></div>').appendTo(this.element)};r.prototype.createView=function(){var e=this.getViewOptions();return new Slick.RemoteView(e)};r.prototype.getDefaultSortBy=function(){if(this.slickGrid){var e=this.slickGrid.getColumns().filter(function(e){return e.sortOrder&&e.sortOrder!==0});if(e.length>0){e.sort(function(e,t){return ss.compare(Math.abs(e.sortOrder),Math.abs(t.sortOrder))});var t=[];for(var i=0;i<e.length;i++){var r=e[i];t.push(r.field+(r.sortOrder<0?" DESC":""))}return t}}return[]};r.prototype.usePager=function(){return false};r.prototype.enableFiltering=function(){var t=this.attrs(e.FilterableAttribute);return t.length>0&&t[0].value};r.prototype.populateWhenVisible=function(){return false};r.prototype.createFilterBar=function(){var t=$("<div/>").appendTo(this.element);var i=this;this.filterBar=new e.FilterDisplayBar(t);if(!this.isAsyncWidget())this.initializeFilterBar()};r.prototype.getPagerOptions=function(){return{view:this.view,rowsPerPage:20,rowsPerPageOptions:[20,100,500,2500]}};r.prototype.createPager=function(){var e=$("<div></div>").appendTo(this.element);e.slickPager(this.getPagerOptions())};r.prototype.getViewOptions=function(){var e=this;var t={};t.idField=this.getIdProperty();t.sortBy=this.getDefaultSortBy();if(!this.usePager()){t.rowsPerPage=0}else if(this.element.hasClass("responsive-height")){t.rowsPerPage=$(window.window).width()<768?20:100}else{t.rowsPerPage=100}t.getItemMetadata=function(t,i){return e.getItemMetadata(t,i)};return t};r.prototype.createToolbar=function(t){var i=$('<div class="grid-toolbar"></div>').appendTo(this.element);this.toolbar=new e.Toolbar(i,{buttons:t,hotkeyContext:this.element[0]})};r.prototype.getTitle=function(){if(!this.titleDiv){return null}return this.titleDiv.children().text()};r.prototype.setTitle=function(e){if(e!==this.getTitle()){if(e==null){if(this.titleDiv){this.titleDiv.remove();this.titleDiv=null}}else{if(!this.titleDiv){this.titleDiv=$('<div class="grid-title"><div class="title-text"></div></div>').prependTo(this.element)}this.titleDiv.children().text(e)}this.layout()}};r.prototype.getItemType=function(){return"Item"};r.prototype.itemLink=function(t,i,r,n,a){if(a===void 0){a=true}if(t==null){t=this.getItemType()}if(i==null){i=this.getIdProperty()}return e.SlickFormatting.itemLink(t,i,r,n,a)};r.prototype.getColumnsKey=function(){var t=this.attrs(e.ColumnsKeyAttribute);if(t&&t.length>0){return t[0].value}return null};r.prototype.getPropertyItemsAsync=function(){var e=this;return Promise.resolve().then(function(){var t=e.getColumnsKey();if(!Q.isEmptyOrNull(t)){return Q.getColumnsAsync(t)}return Promise.resolve([])},null)};r.prototype.getPropertyItems=function(){var t=this.attrs(e.ColumnsKeyAttribute);var i=this.getColumnsKey();if(!Q.isEmptyOrNull(i)){return Q.getColumns(i)}return[]};r.prototype.getColumns=function(){var e=this.getPropertyItems();return this.propertyItemsToSlickColumns(e)};r.prototype.propertyItemsToSlickColumns=function(t){var i=e.PropertyItemSlickConverter.toSlickColumns(t);for(var r=0;r<t.length;r++){var n=t[r];var a=i[r];if(n.editLink===true){var o={$:a.format};var l={$:n.editLinkCssClass!=null?n.editLinkCssClass:null};a.format=this.itemLink(n.editLinkItemType!=null?n.editLinkItemType:null,n.editLinkIdField!=null?n.editLinkIdField:null,ss.mkdel({oldFormat:o},function(e){if(this.oldFormat.$!=null){return this.oldFormat.$(e)}return Q.htmlEncode(e.value)}),ss.mkdel({css:l},function(e){return Q.coalesce(this.css.$,"")}),false);if(!Q.isEmptyOrNull(n.editLinkIdField)){a.referencedFields=a.referencedFields||[];a.referencedFields.push(n.editLinkIdField)}}}return i};r.prototype.getColumnsAsync=function(){var e=this;return this.getPropertyItemsAsync().then(function(t){return e.propertyItemsToSlickColumns(t)},null)};r.prototype.getSlickOptions=function(){var t={};t.multiSelect=false;t.multiColumnSort=true;t.enableCellNavigation=false;t.headerRowHeight=e.DataGrid.defaultHeaderHeight;t.rowHeight=e.DataGrid.defaultRowHeight;return t};r.prototype.populateLock=function(){this.view.populateLock()};r.prototype.populateUnlock=function(){this.view.populateUnlock()};r.prototype.getGridCanLoad=function(){return true};r.prototype.refresh=function(){if(!this.populateWhenVisible()){this.internalRefresh();return}if(this.slickContainer.is(":visible")){this.slickContainer.data("needsRefresh",false);this.internalRefresh();return}this.slickContainer.data("needsRefresh",true)};r.prototype.refreshIfNeeded=function(){if(!!this.slickContainer.data("needsRefresh")){this.slickContainer.data("needsRefresh",false);this.internalRefresh()}};r.prototype.internalRefresh=function(){this.view.populate()};r.prototype.setIsDisabled=function(e){if(this.isDisabled!==e){this.isDisabled=e;if(this.isDisabled){this.view.setItems([],true)}this.updateDisabledState()}};Object.defineProperty(r.prototype,"readOnly",{get:function(){return this.get_readOnly()},set:function(e){this.set_readOnly(e)},enumerable:true,configurable:true});r.prototype.get_readOnly=function(){return!!this._readonly};r.prototype.set_readOnly=function(e){if(!!this._readonly!=!!e){this._readonly=!!e;this.updateInterface()}};r.prototype.updateInterface=function(){this.toolbar.updateInterface()};r.prototype.getLocalTextDbPrefix=function(){if(this.localTextDbPrefix==null){this.localTextDbPrefix=Q.coalesce(this.getLocalTextPrefix(),"");if(this.localTextDbPrefix.length>0&&!Q.endsWith(this.localTextDbPrefix,".")){this.localTextDbPrefix="Db."+this.localTextDbPrefix+"."}}return this.localTextDbPrefix};r.prototype.getLocalTextPrefix=function(){var t=this.attrs(e.LocalTextPrefixAttribute);if(t.length>=1)return t[0].value;return""};r.prototype.getIdProperty=function(){if(this.idProperty==null){var t=this.attrs(e.IdPropertyAttribute);if(t.length===1){this.idProperty=t[0].value}else{this.idProperty="ID"}}return this.idProperty};r.prototype.getIsDeletedProperty=function(){return null};r.prototype.getIsActiveProperty=function(){if(this.isActiveProperty==null){var t=this.attrs(e.IsActivePropertyAttribute);if(t.length===1){this.isActiveProperty=t[0].value}else{this.isActiveProperty=""}}return this.isActiveProperty};r.prototype.updateDisabledState=function(){this.slickContainer.toggleClass("ui-state-disabled",!!this.isDisabled)};r.prototype.resizeCanvas=function(){this.slickGrid.resizeCanvas()};r.prototype.subDialogDataChange=function(){this.refresh()};r.prototype.addFilterSeparator=function(){this.ensureQuickFilterBar().addSeparator()};r.prototype.determineText=function(e){var t=this.getLocalTextDbPrefix();if(!Q.isEmptyOrNull(t)){var i=Q.tryGetText(e(t));if(i!=null){return i}}return null};r.prototype.addQuickFilter=function(e){return this.ensureQuickFilterBar().add(e)};r.prototype.addDateRangeFilter=function(e,t){return this.ensureQuickFilterBar().addDateRange(e,t)};r.prototype.dateRangeQuickFilter=function(t,i){return e.QuickFilterBar.dateRange(t,i)};r.prototype.addDateTimeRangeFilter=function(e,t){return this.ensureQuickFilterBar().addDateTimeRange(e,t)};r.prototype.dateTimeRangeQuickFilter=function(t,i){return e.QuickFilterBar.dateTimeRange(t,i)};r.prototype.addBooleanFilter=function(e,t,i,r){return this.ensureQuickFilterBar().addBoolean(e,t,i,r)};r.prototype.booleanQuickFilter=function(t,i,r,n){return e.QuickFilterBar.boolean(t,i,r,n)};r.prototype.invokeSubmitHandlers=function(){if(this.quickFiltersBar!=null){this.quickFiltersBar.onSubmit(this.view.params)}};r.prototype.quickFilterChange=function(e){this.persistSettings(null);this.view&&(this.view.seekToPage=1);this.refresh()};r.prototype.getPersistanceStorage=function(){return e.DataGrid.defaultPersistanceStorage};r.prototype.getPersistanceKey=function(){var e="GridSettings:";var t=window.location.pathname;if(!Q.isEmptyOrNull(t)){e+=t.substr(1).split(String.fromCharCode(47)).slice(0,2).join("/")+":"}e+=ss.getTypeFullName(ss.getInstanceType(this));return e};r.prototype.gridPersistanceFlags=function(){return{}};r.prototype.canShowColumn=function(e){if(e==null){return false}var t=e.sourceItem;if(t==null){return true}if(t.filterOnly===true){return false}if(t.readPermission==null){return true}return Q.Authorization.hasPermission(t.readPermission)};r.prototype.getPersistedSettings=function(){var e=this.getPersistanceStorage();if(e==null)return null;var t=Q.trimToNull(e.getItem(this.getPersistanceKey()));if(t!=null&&Q.startsWith(t,"{")&&Q.endsWith(t,"}"))return JSON.parse(t);return null};r.prototype.restoreSettings=function(t,i){var r=this;if(!this.slickGrid)return;if(t==null){t=this.getPersistedSettings();if(t==null)return}var n=this.slickGrid.getColumns();var a=null;var o=function(e){a={};for(var t=0;t<e.length;t++){var i=e[t];a[i.id]=i}};this.view.beginUpdate();this.restoringSettings++;try{i=i||this.gridPersistanceFlags();if(t.columns!=null){if(i.columnVisibility!==false){var l={};o(this.allColumns);var s=[];for(var u=0;u<t.columns.length;u++){var c=t.columns[u];if(c.id!=null&&c.visible===true){var d=a[c.id];if(this.canShowColumn(d)){d.visible=true;s.push(d);delete a[c.id]}}}for(var f=0;f<this.allColumns.length;f++){var p=this.allColumns[f];if(a[p.id]!=null){p.visible=false;s.push(p)}}this.allColumns=s;n=this.allColumns.filter(function(e){return e.visible===true})}if(i.columnWidths!==false){o(n);for(var h=0;h<t.columns.length;h++){var g=t.columns[h];if(g.id!=null&&g.width!=null&&g.width!==0){var y=a[g.id];if(y!=null){y.width=g.width}}}}if(i.sortColumns!==false){o(n);var v=[];var m=t.columns.filter(function(e){return e.id!=null&&Q.coalesce(e.sort,0)!==0});m.sort(function(e,t){return e.sort-t.sort});for(var b=0;b<m.length;b++){var C=m[b];var _=a[C.id];if(_!=null){v.push({columnId:C.id,sortAsc:C.sort>0})}}this.view.sortBy=v.map(function(e){return e.columnId+(e.sortAsc===false?" DESC":"")});this.slickGrid.setSortColumns(v)}this.slickGrid.setColumns(n);this.slickGrid.invalidate()}if(t.filterItems!=null&&i.filterItems!==false&&this.filterBar!=null&&this.filterBar.get_store()!=null){ss.clear(this.filterBar.get_store().get_items());ss.arrayAddRange(this.filterBar.get_store().get_items(),t.filterItems);this.filterBar.get_store().raiseChanged()}if(t.includeDeleted!=null&&i.includeDeleted!==false){var x=this.element.find(".s-IncludeDeletedToggle");if(!!t.includeDeleted!==x.hasClass("pressed")){x.children("a").click()}}if(t.quickFilters!=null&&i.quickFilters!==false&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0){this.quickFiltersDiv.find(".quick-filter-item").each(function(i,n){var a=$(n).data("qffield");if(Q.isEmptyOrNull(a)){return}var o=$("#"+r.uniqueName+"_QuickFilter_"+a).tryGetWidget(e.Widget);if(o==null){return}var l=t.quickFilters[a];var s=$(n).data("qfloadstate");if(s!=null){s(o,l)}else{e.EditorUtils.setValue(o,l)}})}if(i.quickSearch===true&&(t.quickSearchField!=null||t.quickSearchText!=null)){var S=this.toolbar.element.find(".s-QuickSearchInput").first();if(S.length>0){var w=S.tryGetWidget(e.QuickSearchInput);if(w!=null){this.view.populateLock();try{w.element.addClass("ignore-change");try{if(t.quickSearchField!=null){w.set_field(t.quickSearchField)}if(t.quickSearchText!=null&&Q.trimToNull(t.quickSearchText)!==Q.trimToNull(w.element.val())){w.element.val(t.quickSearchText)}}finally{w.element.removeClass("ignore-change");w.element.triggerHandler("execute-search")}}finally{this.view.populateUnlock()}}}}}finally{this.restoringSettings--;this.view.endUpdate()}};r.prototype.persistSettings=function(e){var t=this.getPersistanceStorage();if(!t){return}var i=this.getCurrentSettings(e);t.setItem(this.getPersistanceKey(),$.toJSON(i))};r.prototype.getCurrentSettings=function(t){var i=this;t=t||this.gridPersistanceFlags();var r={};if(t.columnVisibility!==false||t.columnWidths!==false||t.sortColumns!==false){r.columns=[];var n=this.slickGrid.getSortColumns();var a=this.slickGrid.getColumns();for(var o=0;o<a.length;o++){var l={$:a[o]};var s={id:l.$.id};if(t.columnVisibility!==false){s.visible=true}if(t.columnWidths!==false){s.width=l.$.width}if(t.sortColumns!==false){var u=Q.indexOf(n,ss.mkdel({column:l},function(e){return e.columnId===this.column.$.id}));s.sort=u>=0?n[u].sortAsc!==false?u+1:-u-1:0}r.columns.push(s)}}if(t.includeDeleted!==false){r.includeDeleted=this.element.find(".s-IncludeDeletedToggle").hasClass("pressed")}if(t.filterItems!==false&&this.filterBar!=null&&this.filterBar.get_store()!=null){r.filterItems=this.filterBar.get_store().get_items().slice()}if(t.quickSearch===true){var c=this.toolbar.element.find(".s-QuickSearchInput").first();if(c.length>0){var d=c.tryGetWidget(e.QuickSearchInput);if(d!=null){r.quickSearchField=d.get_field();r.quickSearchText=d.element.val()}}}if(t.quickFilters!==false&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0){r.quickFilters={};this.quickFiltersDiv.find(".quick-filter-item").each(function(n,a){var o=$(a).data("qffield");if(Q.isEmptyOrNull(o)){return}var l=$("#"+i.uniqueName+"_QuickFilter_"+o).tryGetWidget(e.Widget);if(l==null){return}var s=$(a).data("qfsavestate");var u=s!=null?s(l):e.EditorUtils.getValue(l);r.quickFilters[o]=u;if(t.quickFilterText===true&&$(a).hasClass("quick-filter-active")){var c=$(a).data("qfdisplaytext");var d=$(a).find(".quick-filter-label").text();var f;if(c!=null){f=c(l,d)}else{f=d+" = "+e.EditorUtils.getDisplayText(l)}if(!Q.isEmptyOrNull(f)){if(!Q.isEmptyOrNull(r.quickFilterText)){r.quickFilterText+=" "+Q.coalesce(Q.tryGetText("Controls.FilterPanel.And"),"and")+" ";r.quickFilterText+=f}else{r.quickFilterText=f}}}})}return r};r.prototype.getElement=function(){return this.element};r.prototype.getGrid=function(){return this.slickGrid};r.prototype.getView=function(){return this.view};r.prototype.getFilterStore=function(){return this.filterBar==null?null:this.filterBar.get_store()};r=__decorate([e.Decorators.registerClass("Serenity.DataGrid",[t,e.IReadOnly]),e.Decorators.element("<div/>")],r);return r}(e.Widget);e.DataGrid=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.element.addClass("route-handler").on("handleroute."+r.uniqueName,function(e,t){if(!!t.handled)return;if(!!(t.route==="new")){t.handled=true;r.addButtonClick();return}var i=t.route.split("/");if(!!(i.length===2&&i[0]==="edit")){t.handled=true;r.editItem(i[1]);return}if(!!(i.length===2&&i[1]==="new")){t.handled=true;r.editItemOfType(ss.cast(i[0],String),null);return}if(!!(i.length===3&&i[1]==="edit")){t.handled=true;r.editItemOfType(ss.cast(i[0],String),i[2])}});return r}i.prototype.usePager=function(){return true};i.prototype.createToolbarExtensions=function(){this.createIncludeDeletedButton();this.createQuickSearchInput()};i.prototype.getInitialTitle=function(){return this.getDisplayName()};i.prototype.getLocalTextPrefix=function(){var e=t.prototype.getLocalTextPrefix.call(this);if(Q.isEmptyOrNull(e)){return this.getEntityType()}return e};i.prototype.getEntityType=function(){if(this.entityType!=null)return this.entityType;var t=this.attrs(e.EntityTypeAttribute);if(t.length===1){return this.entityType=t[0].value}var i=ss.getTypeFullName(ss.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Grid")){i=i.substr(0,i.length-4)}else if(Q.endsWith(i,"SubGrid")){i=i.substr(0,i.length-7)}this.entityType=i;return this.entityType};i.prototype.getDisplayName=function(){if(this.displayName!=null)return this.displayName;var e=this.attrs(System.ComponentModel.DisplayNameAttribute);if(e.length>=1){this.displayName=e[0].displayName;this.displayName=Q.LT.getDefault(this.displayName,this.displayName)}else{this.displayName=Q.tryGetText(this.getLocalTextDbPrefix()+"EntityPlural");if(this.displayName==null)this.displayName=this.getEntityType()}return this.displayName};i.prototype.getItemName=function(){if(this.itemName!=null)return this.itemName;var t=this.attrs(e.ItemNameAttribute);if(t.length>=1){this.itemName=t[0].value;this.itemName=Q.LT.getDefault(this.itemName,this.itemName)}else{this.itemName=Q.tryGetText(this.getLocalTextDbPrefix()+"EntitySingular");if(this.itemName==null)this.itemName=this.getEntityType()}return this.itemName};i.prototype.getAddButtonCaption=function(){return Q.format(Q.text("Controls.EntityGrid.NewButton"),this.getItemName())};i.prototype.getButtons=function(){var t=this;var i=[];i.push({title:this.getAddButtonCaption(),cssClass:"add-button",hotkey:"alt+n",onClick:function(){t.addButtonClick()},disabled:function(){return!t.hasInsertPermission()||t.readOnly}});i.push(this.newRefreshButton(true));i.push(e.ColumnPickerDialog.createToolButton(this));return i};i.prototype.newRefreshButton=function(e){var t=this;return{title:e?null:Q.text("Controls.EntityGrid.RefreshButton"),hint:e?Q.text("Controls.EntityGrid.RefreshButton"):null,cssClass:"refresh-button",onClick:function(){t.refresh()}}};i.prototype.addButtonClick=function(){this.editItem(new Object)};i.prototype.editItem=function(t){var i=this;this.createEntityDialog(this.getItemType(),function(r){var n=ss.safeCast(r,e["IEditDialog"]);if(n!=null){n.load(t,function(){n.dialogOpen(i.openDialogsAsPanel)});return}throw new ss.InvalidOperationException(Q.format("{0} doesn't implement IEditDialog!",ss.getTypeFullName(ss.getInstanceType(r))))})};i.prototype.editItemOfType=function(t,i){var r=this;if(t===this.getItemType()){this.editItem(i);return}this.createEntityDialog(t,function(t){var n=ss.safeCast(t,e["IEditDialog"]);if(n!=null){n.load(i,function(){return n.dialogOpen(r.openDialogsAsPanel)});return}throw new ss.InvalidOperationException(Q.format("{0} doesn't implement IEditDialog!",ss.getTypeFullName(ss.getInstanceType(t))))})};i.prototype.getService=function(){if(this.service!=null)return this.service;var t=this.attrs(e.ServiceAttribute);if(t.length>=1)this.service=t[0].value;else this.service=Q.replaceAll(this.getEntityType(),".","/");return this.service};i.prototype.getViewOptions=function(){var e=t.prototype.getViewOptions.call(this);e.url=Q.resolveUrl("~/Services/"+this.getService()+"/List");return e};i.prototype.getItemType=function(){return this.getEntityType()};i.prototype.routeDialog=function(e,t){var i=this;Q.Router.dialog(this.element,t.element,function(){var r="";if(e!==i.getItemType())r=e+"/";if(!!(t!=null&&t.entityId!=null))r+="edit/"+t.entityId.toString();else r+="new";return r})};i.prototype.getInsertPermission=function(){return null};i.prototype.hasInsertPermission=function(){var e=this.getInsertPermission();return e==null||Q.Authorization.hasPermission(this.getInsertPermission())};i.prototype.transferDialogReadOnly=function(t){if(this.readOnly)e.EditorUtils.setReadOnly(t,true)};i.prototype.initDialog=function(t){var i=this;e.SubDialogHelper.bindToDataChange(t,this,function(e,t){i.subDialogDataChange()},true);this.transferDialogReadOnly(t);this.routeDialog(this.getItemType(),t)};i.prototype.initEntityDialog=function(t,i){var r=this;if(t===this.getItemType()){this.initDialog(i);return}e.SubDialogHelper.bindToDataChange(i,this,function(e,t){r.subDialogDataChange()},true);this.transferDialogReadOnly(i);this.routeDialog(t,i)};i.prototype.createEntityDialog=function(t,i){var r=this;var n=this.getDialogTypeFor(t);var a=e.Widget.create({type:n,options:this.getDialogOptionsFor(t),init:function(e){r.initEntityDialog(t,e);i&&i(e)}});return a};i.prototype.getDialogOptions=function(){return{}};i.prototype.getDialogOptionsFor=function(e){if(e===this.getItemType())return this.getDialogOptions();return{}};i.prototype.getDialogTypeFor=function(t){if(t===this.getItemType()){return this.getDialogType()}return e.DialogTypeRegistry.get(t)};i.prototype.getDialogType=function(){if(this.dialogType!=null)return this.dialogType;var t=this.attrs(e.DialogTypeAttribute);if(t.length>=1)this.dialogType=t[0].value;else this.dialogType=e.DialogTypeRegistry.get(this.getEntityType());return this.dialogType};i=__decorate([e.Decorators.registerClass("Serenity.EntityGrid")],i);return i}(e.DataGrid);e.EntityGrid=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("s-CheckTreeEditor");r.updateItems();return r}i.prototype.getIdProperty=function(){return"id"};i.prototype.getTreeItems=function(){return[]};i.prototype.updateItems=function(){var e=this.getTreeItems();var t={};for(var i=0;i<e.length;i++){var r=e[i];r.children=[];if(!Q.isEmptyOrNull(r.id)){t[r.id]=r}if(!Q.isEmptyOrNull(r.parentId)){var n=t[r.parentId];if(n!=null){n.children.push(r)}}}this.view.addData({Entities:e,Skip:0,Take:0,TotalCount:e.length});this.updateSelectAll();this.updateFlags()};i.prototype.getEditValue=function(e,t){if(this.getDelimited())t[e.name]=this.get_value().join(",");else t[e.name]=this.get_value()};i.prototype.setEditValue=function(e,t){var i=e[t.name];this.set_value(i)};i.prototype.getButtons=function(){var t=this;var i=this.getSelectAllText();if(Q.isEmptyOrNull(i)){return null}var r=this;var n=[];n.push(e.GridSelectAllButtonHelper.define(function(){return r},function(e){return e.id},function(e){return e.isSelected},function(e,i){if(e.isSelected!==i){e.isSelected=i;t.itemSelectedChanged(e)}},null,function(){t.updateFlags()}));return n};i.prototype.itemSelectedChanged=function(e){};i.prototype.getSelectAllText=function(){return Q.coalesce(Q.tryGetText("Controls.CheckTreeEditor.SelectAll"),"Select All")};i.prototype.isThreeStateHierarchy=function(){return false};i.prototype.createSlickGrid=function(){this.element.addClass("slick-no-cell-border").addClass("slick-no-odd-even");var e=t.prototype.createSlickGrid.call(this);this.element.addClass("slick-hide-header");e.resizeCanvas();return e};i.prototype.onViewFilter=function(i){if(!t.prototype.onViewFilter.call(this,i)){return false}var r=this.view.getItems();var n=this;return e.SlickTreeHelper.filterCustom(i,function(e){if(e.parentId==null){return null}if(n.byId==null){n.byId={};for(var t=0;t<r.length;t++){var i=r[t];if(i.id!=null){n.byId[i.id]=i}}}return n.byId[e.parentId]})};i.prototype.getInitialCollapse=function(){return false};i.prototype.onViewProcessData=function(i){i=t.prototype.onViewProcessData.call(this,i);this.byId=null;e.SlickTreeHelper.setIndents(i.Entities,function(e){return e.id},function(e){return e.parentId},this.getInitialCollapse());return i};i.prototype.onClick=function(i,r,n){t.prototype.onClick.call(this,i,r,n);if(!i.isDefaultPrevented()){e.SlickTreeHelper.toggleClick(i,r,n,this.view,function(e){return e.id})}if(i.isDefaultPrevented()){return}var a=$(i.target);if(a.hasClass("check-box")){i.preventDefault();if(this._readOnly)return;var o=a.hasClass("checked")||a.hasClass("partial");var l=this.itemAt(r);var s=l.isSelected!==!o;this.view.beginUpdate();try{if(l.isSelected!==!o){l.isSelected=!o;this.view.updateItem(l.id,l);this.itemSelectedChanged(l)}s=this.setAllSubTreeSelected(l,l.isSelected)||s;this.updateSelectAll();this.updateFlags()}finally{this.view.endUpdate()}if(s){this.element.triggerHandler("change")}}};i.prototype.updateSelectAll=function(){e.GridSelectAllButtonHelper.update(this,function(e){return e.isSelected})};i.prototype.updateFlags=function(){var e=this.view;var t=e.getItems();var i=this.isThreeStateHierarchy();if(!i){return}e.beginUpdate();try{for(var r=0;r<t.length;r++){var n=t[r];if(n.children==null||n.children.length===0){var a=this.getDescendantsSelected(n);if(a!==n.isAllDescendantsSelected){n.isAllDescendantsSelected=a;e.updateItem(n.id,n)}continue}var o=this.allDescendantsSelected(n);var l=o||this.anyDescendantsSelected(n);if(o!==n.isAllDescendantsSelected||l!==n.isSelected){var s=n.isSelected!==l;n.isAllDescendantsSelected=o;n.isSelected=l;e.updateItem(n.id,n);if(s){this.itemSelectedChanged(n)}}}}finally{e.endUpdate()}};i.prototype.getDescendantsSelected=function(e){return true};i.prototype.setAllSubTreeSelected=function(e,t){var i=false;for(var r=0;r<e.children.length;r++){var n=e.children[r];if(n.isSelected!==t){i=true;n.isSelected=t;this.view.updateItem(n.id,n);this.itemSelectedChanged(n)}if(n.children.length>0){i=this.setAllSubTreeSelected(n,t)||i}}return i};i.prototype.allItemsSelected=function(){for(var e=0;e<this.rowCount();e++){var t=this.itemAt(e);if(!t.isSelected){return false}}return this.rowCount()>0};i.prototype.allDescendantsSelected=function(e){if(e.children.length>0){for(var t=0;t<e.children.length;t++){var i=e.children[t];if(!i.isSelected){return false}if(!this.allDescendantsSelected(i)){return false}}}return true};i.prototype.getDelimited=function(){return!!!!this.options["delimited"]};i.prototype.anyDescendantsSelected=function(e){if(e.children.length>0){for(var t=0;t<e.children.length;t++){var i=e.children[t];if(i.isSelected){return true}if(this.anyDescendantsSelected(i)){return true}}}return false};i.prototype.getColumns=function(){var t=this;var i=this;var r=[];r.push({field:"text",name:"Kayıt",width:80,format:e.SlickFormatting.treeToggle(function(){return i.view},function(e){return e.id},function(e){var i="check-box";var r=e.item;if(r.hideCheckBox){return t.getItemText(e)}var n=t.isThreeStateHierarchy();if(r.isSelected){if(n&&!r.isAllDescendantsSelected){i+=" partial"}else{i+=" checked"}}if(t._readOnly)i+=" readonly";return'<span class="'+i+'"></span>'+t.getItemText(e)})});return r};i.prototype.getItemText=function(e){return Q.htmlEncode(e.value)};i.prototype.getSlickOptions=function(){var e=t.prototype.getSlickOptions.call(this);e.forceFitColumns=true;
return e};i.prototype.sortItems=function(){if(!this.moveSelectedUp()){return}var e={};var t=this.view.getItems();var i=0;for(var r=0;r<t.length;r++){var n=t[r];e[n.id]=i++}t.sort(function(t,i){if(t.isSelected&&!i.isSelected){return-1}if(i.isSelected&&!t.isSelected){return 1}var r=Q.turkishLocaleCompare(t.text,i.text);if(r!==0){return r}return ss.compare(e[t.id],e[i.id])});this.view.setItems(t,true)};i.prototype.moveSelectedUp=function(){return false};i.prototype.get_readOnly=function(){return this._readOnly};i.prototype.set_readOnly=function(e){if(!!this._readOnly!=!!e){this._readOnly=!!e;this.view.refresh()}};i.prototype.get_value=function(){var e=[];var t=this.view.getItems();for(var i=0;i<t.length;i++){if(t[i].isSelected){e.push(t[i].id)}}return e};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){var t={};if(e!=null){if(typeof e=="string"){e=e.split(",").map(function(e){return Q.trimToNull(e)}).filter(function(e){return e!=null})}for(var i=0;i<e.length;i++){t[e[i]]=true}}this.view.beginUpdate();try{var r=this.view.getItems();for(var n=0;n<r.length;n++){var a=r[n];var o=t[a.id];if(o!==a.isSelected){a.isSelected=o;this.view.updateItem(a.id,a)}}this.updateSelectAll();this.updateFlags();this.sortItems()}finally{this.view.endUpdate()}};i=__decorate([e.Decorators.registerEditor("Serenity.CheckTreeEditor",[e.IGetEditValue,e.ISetEditValue,e.IReadOnly]),e.Decorators.element("<div/>")],i);return i}(e.DataGrid);e.CheckTreeEditor=t;var i=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.enableUpdateItems=true;r.setCascadeFrom(r.options.cascadeFrom);r.updateItems();Q.ScriptData.bindToChange("Lookup."+r.getLookupKey(),r.uniqueName,function(){return r.updateItems()});return r}i.prototype.updateItems=function(){if(this.enableUpdateItems)t.prototype.updateItems.call(this)};i.prototype.getLookupKey=function(){return this.options.lookupKey};i.prototype.getButtons=function(){return Q.coalesce(t.prototype.getButtons.call(this),this.options.hideSearch?null:[])};i.prototype.createToolbarExtensions=function(){var i=this;t.prototype.createToolbarExtensions.call(this);e.GridUtils.addQuickSearchInputCustom(this.toolbar.element,function(e,t){i.searchText=Select2.util.stripDiacritics(t||"").toUpperCase();i.view.setItems(i.view.getItems(),true)})};i.prototype.getSelectAllText=function(){if(!this.options.showSelectAll)return null;return t.prototype.getSelectAllText.call(this)};i.prototype.cascadeItems=function(t){var i=this.get_cascadeValue();if(i==null||i===""){if(!Q.isEmptyOrNull(this.get_cascadeField())){return[]}return t}var r=i.toString();var n=this.get_cascadeField();return t.filter(function(t){var i=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(i!=null&&i.toString()===r)})};i.prototype.filterItems=function(t){var i=this.get_filterValue();if(i==null||i===""){return t}var r=i.toString();var n=this.get_filterField();return t.filter(function(t){var i=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(i!=null&&i.toString()===r)})};i.prototype.getLookupItems=function(e){return this.filterItems(this.cascadeItems(e.items))};i.prototype.getTreeItems=function(){var e=Q.getLookup(this.options.lookupKey);var t=this.getLookupItems(e);return t.map(function(t){return{id:Q.coalesce(t[e.idField],"").toString(),text:Q.coalesce(t[e.textField],"").toString(),source:t}})};i.prototype.onViewFilter=function(e){return t.prototype.onViewFilter.call(this,e)&&(Q.isEmptyOrNull(this.searchText)||Select2.util.stripDiacritics(e.text||"").toUpperCase().indexOf(this.searchText)>=0)};i.prototype.moveSelectedUp=function(){return this.options.checkedOnTop};i.prototype.get_cascadeFrom=function(){return this.options.cascadeFrom};Object.defineProperty(i.prototype,"cascadeFrom",{get:function(){return this.get_cascadeFrom()},set:function(e){this.set_cascadeFrom(e)},enumerable:true,configurable:true});i.prototype.getCascadeFromValue=function(t){return e.EditorUtils.getValue(t)};i.prototype.setCascadeFrom=function(t){var i=this;if(Q.isEmptyOrNull(t)){if(this.cascadeLink!=null){this.cascadeLink.set_parentID(null);this.cascadeLink=null}this.options.cascadeFrom=null;return}this.cascadeLink=new e.CascadedWidgetLink(e.Widget,this,function(e){i.set_cascadeValue(i.getCascadeFromValue(e))});this.cascadeLink.set_parentID(t);this.options.cascadeFrom=t};i.prototype.set_cascadeFrom=function(e){if(e!==this.options.cascadeFrom){this.setCascadeFrom(e);this.updateItems()}};i.prototype.get_cascadeField=function(){return Q.coalesce(this.options.cascadeField,this.options.cascadeFrom)};Object.defineProperty(i.prototype,"cascadeField",{get:function(){return this.get_cascadeField()},set:function(e){this.set_cascadeField(e)},enumerable:true,configurable:true});i.prototype.set_cascadeField=function(e){this.options.cascadeField=e};i.prototype.get_cascadeValue=function(){return this.options.cascadeValue};Object.defineProperty(i.prototype,"cascadeValue",{get:function(){return this.get_cascadeValue()},set:function(e){this.set_cascadeValue(e)},enumerable:true,configurable:true});i.prototype.set_cascadeValue=function(e){if(this.options.cascadeValue!==e){this.options.cascadeValue=e;this.value=[];this.updateItems()}};i.prototype.get_filterField=function(){return this.options.filterField};Object.defineProperty(i.prototype,"filterField",{get:function(){return this.get_filterField()},set:function(e){this.set_filterField(e)},enumerable:true,configurable:true});i.prototype.set_filterField=function(e){this.options.filterField=e};i.prototype.get_filterValue=function(){return this.options.filterValue};Object.defineProperty(i.prototype,"filterValue",{get:function(){return this.get_filterValue()},set:function(e){this.set_filterValue(e)},enumerable:true,configurable:true});i.prototype.set_filterValue=function(e){if(this.options.filterValue!==e){this.options.filterValue=e;this.value=null;this.updateItems()}};i=__decorate([e.Decorators.registerEditor("Serenity.CheckLookupEditor")],i);return i}(t);e.CheckLookupEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.initValidator();r.initTabs();r.initToolbar();return r}i.prototype.destroy=function(){if(this.tabs){this.tabs.tabs("destroy");this.tabs=null}if(this.toolbar){this.toolbar.destroy();this.toolbar=null}if(this.validator){this.byId("Form").remove();this.validator=null}t.prototype.destroy.call(this)};i.prototype.arrange=function(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})};i.prototype.getToolbarButtons=function(){return[]};i.prototype.getValidatorOptions=function(){return{}};i.prototype.initTabs=function(){var e=this.byId("Tabs");if(e.length===0){return}this.tabs=e.tabs({})};i.prototype.initToolbar=function(){var t=this.byId("Toolbar");if(t.length===0){return}var i={buttons:this.getToolbarButtons()};this.toolbar=new e.Toolbar(t,i)};i.prototype.initValidator=function(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(Q.validateOptions(t))}};i.prototype.resetValidation=function(){if(this.validator){this.validator.resetAll()}};i.prototype.validateForm=function(){return this.validator==null||!!this.validator.form()};return i}(e.TemplatedWidget);e.TemplatedPanel=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;if(!r.isAsyncWidget()){r.initPropertyGrid();r.loadInitialEntity()}return r}i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.validator){this.byId("Form").remove();this.validator=null}t.prototype.destroy.call(this)};i.prototype.initPropertyGrid=function(){var t=this.byId("PropertyGrid");if(t.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new e.PropertyGrid(t,i).init(null);if(this.element.closest(".ui-Panel").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.initPropertyGridAsync=function(){var t=this;return Promise.resolve().then(function(){var i=t.byId("PropertyGrid");if(i.length<=0){return Promise.resolve()}return t.getPropertyGridOptionsAsync().then(function(r){t.propertyGrid=new e.PropertyGrid(i,r);if(t.element.closest(".ui-Panel").hasClass("s-Flexify")){t.propertyGrid.element.children(".categories").flexHeightOnly(1)}return t.propertyGrid.initialize()})})};i.prototype.loadInitialEntity=function(){if(this.propertyGrid){this.propertyGrid.load(new Object)}};i.prototype.initializeAsync=function(){var e=this;return t.prototype.initializeAsync.call(this).then(function(){return e.initPropertyGridAsync()}).then(function(){return e.loadInitialEntity()})};i.prototype.getFormKey=function(){var t=ss.getAttributes(ss.getInstanceType(this),e.FormKeyAttribute,true);if(t.length>=1){return t[0].value}var i=ss.getTypeFullName(ss.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-6)}else if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-5)}return i};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:false,localTextPrefix:"Forms."+this.getFormKey()+"."}};i.prototype.getPropertyGridOptionsAsync=function(){var e=this;return this.getPropertyItemsAsync().then(function(t){return{idPrefix:e.idPrefix,items:t,mode:1,useCategories:false,localTextPrefix:"Forms."+e.getFormKey()+"."}})};i.prototype.getPropertyItems=function(){var e=this.getFormKey();return Q.getForm(e)};i.prototype.getPropertyItemsAsync=function(){var e=this;return Promise.resolve().then(function(){var t=e.getFormKey();return Q.getFormAsync(t)})};i.prototype.getSaveEntity=function(){var e=new Object;if(this.propertyGrid){this.propertyGrid.save(e)}return e};i.prototype.get_entity=function(){return this._entity};i.prototype.get_entityId=function(){return this._entityId};i.prototype.set_entity=function(e){this._entity=Q.coalesce(e,new Object)};i.prototype.set_entityId=function(e){this._entityId=e};i.prototype.validateBeforeSave=function(){return this.validator.form()};i=__decorate([e.Decorators.registerClass("Serenity.PropertyPanel")],i);return i}(e.TemplatedPanel);e.PropertyPanel=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IEditDialog")],t);return t}();e.IEditDialog=t;var i=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;if(!i.isAsyncWidget()){i.initPropertyGrid();i.initLocalizationGrid()}return i}i.prototype.initializeAsync=function(){var e=this;return t.prototype.initializeAsync.call(this).then(function(){return e.initPropertyGridAsync()}).then(function(){return e.initLocalizationGridAsync()})};i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.localizationGrid){this.localizationGrid.destroy();this.localizationGrid=null}this.undeleteButton=null;this.applyChangesButton=null;this.deleteButton=null;this.saveAndCloseButton=null;this.editButton=null;this.cloneButton=null;this.toolbar=null;t.prototype.destroy.call(this)};i.prototype.get_entity=function(){return this.entity};i.prototype.set_entity=function(e){this.entity=e||new Object};i.prototype.get_entityId=function(){return this.entityId};i.prototype.set_entityId=function(e){this.entityId=e};i.prototype.getEntityNameFieldValue=function(){return Q.coalesce(this.get_entity()[this.getNameProperty()],"").toString()};i.prototype.getEntityTitle=function(){if(!this.isEditMode()){return Q.format(Q.text("Controls.EntityDialog.NewRecordTitle"),this.getEntitySingular())}else{var e=this.isViewMode()||this.readOnly||!this.hasSavePermission()?Q.text("Controls.EntityDialog.ViewRecordTitle"):Q.text("Controls.EntityDialog.EditRecordTitle");var t=Q.coalesce(this.getEntityNameFieldValue(),"");return Q.format(e,this.getEntitySingular(),Q.isEmptyOrNull(t)?"":" ("+t+")")}};i.prototype.updateTitle=function(){this.dialogTitle=this.getEntityTitle()};i.prototype.isCloneMode=function(){return false};i.prototype.isEditMode=function(){return this.get_entityId()!=null&&!this.isCloneMode()};i.prototype.isDeleted=function(){if(this.get_entityId()==null){return false}var e=this.getIsDeletedProperty();if(e){return!!this.get_entity()[e]}var t=this.get_entity()[this.getIsActiveProperty()];if(t==null){return false}return t<0};i.prototype.isNew=function(){return this.get_entityId()==null};i.prototype.isNewOrDeleted=function(){return this.isNew()||this.isDeleted()};i.prototype.getDeleteOptions=function(e){return{}};i.prototype.deleteHandler=function(e,t){Q.serviceCall(e)};i.prototype.doDelete=function(e){var t=this;var i=this;var r={EntityId:this.get_entityId()};var n={service:this.getService()+"/Delete",request:r,onSuccess:function(n){i.onDeleteSuccess(n);if(e!=null){e(n)}i.element.triggerHandler("ondatachange",[{entityId:r.EntityId,entity:t.entity,type:"delete"}])}};var a=this.getDeleteOptions(e);var o=$.extend(n,a);this.deleteHandler(o,e)};i.prototype.onDeleteSuccess=function(e){};i.prototype.attrs=function(e){return ss.getAttributes(ss.getInstanceType(this),e,true)};i.prototype.getEntityType=function(){if(this.entityType!=null)return this.entityType;var t=this.attrs(e.EntityTypeAttribute);if(t.length===1)return this.entityType=t[0].value;var i=ss.getTypeFullName(ss.getInstanceType(this));var r=i.indexOf(".");if(r>=0)i=i.substring(r+1);if(Q.endsWith(i,"Dialog")||Q.endsWith(i,"Control"))i=i.substr(0,i.length-6);else if(Q.endsWith(i,"Panel"))i=i.substr(0,i.length-5);return this.entityType=i};i.prototype.getFormKey=function(){if(this.formKey!=null)return this.formKey;var t=this.attrs(e.FormKeyAttribute);if(t.length>=1)return this.formKey=t[0].value;return this.formKey=this.getEntityType()};i.prototype.getLocalTextDbPrefix=function(){if(this.localTextDbPrefix!=null)return this.localTextDbPrefix;this.localTextDbPrefix=Q.coalesce(this.getLocalTextPrefix(),"");if(this.localTextDbPrefix.length>0&&!Q.endsWith(this.localTextDbPrefix,"."))this.localTextDbPrefix="Db."+this.localTextDbPrefix+".";return this.localTextDbPrefix};i.prototype.getLocalTextPrefix=function(){var t=this.attrs(e.LocalTextPrefixAttribute);if(t.length>=1)return t[0].value;return this.getEntityType()};i.prototype.getEntitySingular=function(){if(this.entitySingular!=null)return this.entitySingular;var t=this.attrs(e.ItemNameAttribute);if(t.length>=1){this.entitySingular=t[0].value;this.entitySingular=Q.LT.getDefault(this.entitySingular,this.entitySingular)}else{var i=Q.tryGetText(this.getLocalTextDbPrefix()+"EntitySingular");if(i==null)i=this.getEntityType();this.entitySingular=i}return this.entitySingular};i.prototype.getNameProperty=function(){if(this.nameProperty!=null)return this.nameProperty;var t=this.attrs(e.NamePropertyAttribute);if(t.length>=1)this.nameProperty=t[0].value;else this.nameProperty="Name";return this.nameProperty};i.prototype.getIdProperty=function(){if(this.idProperty!=null)return this.idProperty;var t=this.attrs(e.IdPropertyAttribute);if(t.length>=1)this.idProperty=t[0].value;else this.idProperty="ID";return this.idProperty};i.prototype.getIsActiveProperty=function(){if(this.isActiveProperty!=null)return this.isActiveProperty;var t=this.attrs(e.IsActivePropertyAttribute);if(t.length>=1)this.isActiveProperty=t[0].value;else this.isActiveProperty="IsActive";return this.isActiveProperty};i.prototype.getIsDeletedProperty=function(){return null};i.prototype.getService=function(){if(this.service!=null)return this.service;var t=this.attrs(e.ServiceAttribute);if(t.length>=1)this.service=t[0].value;else this.service=Q.replaceAll(this.getEntityType(),".","/");return this.service};i.prototype.load=function(e,t,i){var r=this;var n=function(){if(e==null){r.loadResponse({});t&&t();return}var i=typeof e;if(i==="string"||i==="number"){var n=e;r.loadById(n,function(e){if(t)window.setTimeout(t,0)},null);return}var a=e||new Object;r.loadResponse({Entity:a});t&&t()};if(i==null){n();return}try{n()}catch(a){var o=ss.Exception.wrap(a);i(o)}};i.prototype.loadNewAndOpenDialog=function(e){this.loadResponse({});this.dialogOpen(e)};i.prototype.loadEntityAndOpenDialog=function(e,t){this.loadResponse({Entity:e});this.dialogOpen(t)};i.prototype.loadResponse=function(e){e=e||{};this.onLoadingData(e);var t=e.Entity||new Object;this.beforeLoadEntity(t);this.loadEntity(t);this.set_entity(t);this.afterLoadEntity()};i.prototype.loadEntity=function(e){var t=this.getIdProperty();if(t!=null)this.set_entityId(e[t]);this.set_entity(e);if(this.propertyGrid!=null){this.propertyGrid.set_mode(this.isEditMode()?2:1);this.propertyGrid.load(e)}};i.prototype.beforeLoadEntity=function(e){this.localizationPendingValue=null;this.localizationLastValue=null};i.prototype.afterLoadEntity=function(){this.updateInterface();this.updateTitle()};i.prototype.loadByIdAndOpenDialog=function(e,t){var i=this;this.loadById(e,function(e){return window.setTimeout(function(){return i.dialogOpen(t)},0)},function(){if(!i.element.is(":visible")){i.element.remove()}})};i.prototype.onLoadingData=function(e){};i.prototype.getLoadByIdOptions=function(e,t){return{}};i.prototype.getLoadByIdRequest=function(e){var t={};t.EntityId=e;return t};i.prototype.reloadById=function(){this.loadById(this.get_entityId())};i.prototype.loadById=function(e,t,i){var r=this;var n={service:this.getService()+"/Retrieve",blockUI:true,request:this.getLoadByIdRequest(e),onSuccess:function(e){r.loadResponse(e);t&&t(e)},onCleanup:function(){if(r.validator!=null){Q.validatorAbortHandler(r.validator)}}};var a=this.getLoadByIdOptions(e,t);var o=$.extend(n,a);this.loadByIdHandler(o,t,i)};i.prototype.loadByIdHandler=function(e,t,i){var r=Q.serviceCall(e);i&&r.fail(i)};i.prototype.initLocalizationGrid=function(){var e=this.byId("PropertyGrid");if(e.length<=0){return}var t=this.getPropertyGridOptions();this.initLocalizationGridCommon(t)};i.prototype.initLocalizationGridAsync=function(){var e=this;return Promise.resolve().then(function(){var t=e.byId("PropertyGrid");if(t.length<=0){return Promise.resolve()}return e.getPropertyGridOptionsAsync().then(function(t){e.initLocalizationGridCommon(t)})})};i.prototype.initLocalizationGridCommon=function(t){var i=this.byId("PropertyGrid");if(!Q.any(t.items,function(e){return e.localizable===true}))return;var r=$("<div/>").attr("id",this.idPrefix+"LocalizationGrid").hide().insertAfter(i);t.idPrefix=this.idPrefix+"Localization_";var n=[];for(var a=0,o=t.items;a<o.length;a++){var l=o[a];var s=null;if(l.localizable===true){var u=$.extend({},l);u.oneWay=true;u.readOnly=true;u.required=false;u.defaultValue=null;n.push(u);if(s==null)s=this.getLangs();for(var c=0,d=s;c<d.length;c++){var f=d[c];u=$.extend({},l);u.name=f[0]+"$"+u.name;u.title=f[1];u.cssClass=[u.cssClass,"translation"].join(" ");u.insertable=true;u.updatable=true;u.oneWay=false;u.required=false;u.localizable=false;u.defaultValue=null;n.push(u)}}}t.items=n;this.localizationGrid=new e.PropertyGrid(r,t).init(null);r.addClass("s-LocalizationGrid")};i.prototype.isLocalizationMode=function(){return this.localizationButton!=null&&this.localizationButton.hasClass("pressed")};i.prototype.isLocalizationModeAndChanged=function(){if(!this.isLocalizationMode()){return false}var e=this.getLocalizationGridValue();return $.toJSON(this.localizationLastValue)!=$.toJSON(e)};i.prototype.localizationButtonClick=function(){if(this.isLocalizationMode()&&!this.validateForm()){return}if(this.isLocalizationModeAndChanged()){var e=this.getLocalizationGridValue();this.localizationLastValue=e;this.localizationPendingValue=e}this.localizationButton.toggleClass("pressed");this.updateInterface();if(this.isLocalizationMode()){this.loadLocalization()}};i.prototype.getLanguages=function(){if(e.EntityDialog.defaultLanguageList!=null)return e.EntityDialog.defaultLanguageList()||[];return[]};i.prototype.getLangs=function(){var e=this.getLanguages();var t=ss.safeCast(e,Array);if(t==null||t.length===0||t[0]==null||!Q.isArray(t[0])){t=Array.prototype.slice.call(e.map(function(e){return[e.item1,e.item2]}))}return t};i.prototype.loadLocalization=function(){var e=this;if(this.localizationLastValue==null&&this.isNew()){this.localizationGrid.load({});this.setLocalizationGridCurrentValues();this.localizationLastValue=this.getLocalizationGridValue();return}if(this.localizationLastValue!=null){this.localizationGrid.load(this.localizationLastValue);this.setLocalizationGridCurrentValues();return}var t={service:this.getService()+"/Retrieve",blockUI:true,request:{EntityId:this.get_entityId(),ColumnSelection:"keyOnly",IncludeColumns:["Localizations"]},onSuccess:function(t){var i=$.extend(new Object,e.get_entity());if(t.Localizations){for(var r=0,n=Object.keys(t.Localizations);r<n.length;r++){var a=n[r];var o=t.Localizations[a];for(var l=0,s=Object.keys(o);l<s.length;l++){var u=s[l];i[a+"$"+u]=o[u]}}}e.localizationGrid.load(i);e.setLocalizationGridCurrentValues();e.localizationPendingValue=null;e.localizationLastValue=e.getLocalizationGridValue()}};Q.serviceCall(t)};i.prototype.setLocalizationGridCurrentValues=function(){var e=this;var t={};this.localizationGrid.enumerateItems(function(i,r){if(i.name.indexOf("$")<0&&r.element.is(":input")){t[i.name]=e.byId(i.name).val();r.element.val(t[i.name])}});this.localizationGrid.enumerateItems(function(e,i){var r=e.name.indexOf("$");if(r>=0&&i.element.is(":input")){var n=t[e.name.substr(r+1)];if(n!=null&&n.length>0){i.element.attr("title",n).attr("placeholder",n)}}})};i.prototype.getLocalizationGridValue=function(){var e={};this.localizationGrid.save(e);for(var t=0,i=Object.keys(e);t<i.length;t++){var r=i[t];if(r.indexOf("$")<0){delete e[r]}}return e};i.prototype.getPendingLocalizations=function(){if(this.localizationPendingValue==null){return null}var e={};var t=this.getIdProperty();var i=this.getLangs();for(var r=0,n=i;r<n.length;r++){var a=n[r];var o=a[0];var l={};if(t!=null){l[t]=this.get_entityId()}var s=o+"$";for(var u=0,c=Object.keys(this.localizationPendingValue);u<c.length;u++){var d=c[u];if(Q.startsWith(d,s))l[d.substr(s.length)]=this.localizationPendingValue[d]}e[o]=l}return e};i.prototype.initPropertyGrid=function(){var t=this.byId("PropertyGrid");if(t.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new e.PropertyGrid(t,i).init(null);if(this.element.closest(".ui-dialog").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.initPropertyGridAsync=function(){var t=this;return Promise.resolve().then(function(){var i=t.byId("PropertyGrid");if(i.length<=0){return Promise.resolve()}return t.getPropertyGridOptionsAsync().then(function(r){t.propertyGrid=new e.PropertyGrid(i,r);if(t.element.closest(".ui-dialog").hasClass("s-Flexify"))t.propertyGrid.element.children(".categories").flexHeightOnly(1);return t.propertyGrid.init()})})};i.prototype.getPropertyItems=function(){var e=this.getFormKey();return Q.getForm(e)};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,localTextPrefix:"Forms."+this.getFormKey()+".",useCategories:true}};i.prototype.getPropertyGridOptionsAsync=function(){var e=this;return this.getPropertyItemsAsync().then(function(t){return{idPrefix:e.idPrefix,items:t,mode:1,localTextPrefix:"Forms."+e.getFormKey()+".",useCategories:true}})};i.prototype.getPropertyItemsAsync=function(){var e=this;return Promise.resolve().then(function(){var t=e.getFormKey();return Q.getFormAsync(t)})};i.prototype.validateBeforeSave=function(){return true};i.prototype.getSaveOptions=function(e){var t=this;var i={};i.service=this.getService()+"/"+(this.isEditMode()?"Update":"Create"),i.onSuccess=function(r){t.onSaveSuccess(r);e&&e(r);var n=t.isEditMode()?"update":"create";var a=i.request==null?null:i.request.Entity;var o=t.isEditMode()?t.get_entityId():r==null?null:r.EntityId;var l={type:n,entity:a,entityId:o};t.element.triggerHandler("ondatachange",[l])};i.onCleanup=function(){t.validator&&Q.validatorAbortHandler(t.validator)};i.request=this.getSaveRequest();return i};i.prototype.getSaveEntity=function(){var e=new Object;if(this.propertyGrid!=null){this.propertyGrid.save(e)}if(this.isEditMode()){var t=this.getIdProperty();if(t!=null&&e[t]==null){e[t]=this.get_entityId()}}return e};i.prototype.getSaveRequest=function(){var e=this.getSaveEntity();var t={};t.Entity=e;if(this.isEditMode()){var i=this.getIdProperty();if(i!=null){t.EntityId=this.get_entityId()}}if(this.localizationPendingValue!=null){t.Localizations=this.getPendingLocalizations()}return t};i.prototype.onSaveSuccess=function(e){};i.prototype.save_submitHandler=function(e){var t=this.getSaveOptions(e);this.saveHandler(t,e)};i.prototype.save=function(t){var i=this;return e.ValidationHelper.submit(this.byId("Form"),function(){return i.validateBeforeSave()},function(){return i.save_submitHandler(t)})};i.prototype.saveHandler=function(e,t){Q.serviceCall(e)};i.prototype.initToolbar=function(){t.prototype.initToolbar.call(this);if(!this.toolbar)return;this.saveAndCloseButton=this.toolbar.findButton("save-and-close-button");this.applyChangesButton=this.toolbar.findButton("apply-changes-button");this.deleteButton=this.toolbar.findButton("delete-button");this.undeleteButton=this.toolbar.findButton("undo-delete-button");this.editButton=this.toolbar.findButton("edit-button");this.cloneButton=this.toolbar.findButton("clone-button");this.localizationButton=this.toolbar.findButton("localization-button")};i.prototype.showSaveSuccessMessage=function(e){Q.notifySuccess(Q.text("Controls.EntityDialog.SaveSuccessMessage"),"",null)};i.prototype.getToolbarButtons=function(){var t=this;var i=[];i.push({title:Q.text("Controls.EntityDialog.SaveButton"),cssClass:"save-and-close-button",hotkey:"alt+s",onClick:function(){t.save(function(e){t.dialogClose()})},visible:function(){return!t.isDeleted()&&!t.isViewMode()},disabled:function(){return!t.hasSavePermission()||t.readOnly}});i.push({title:"",hint:Q.text("Controls.EntityDialog.ApplyChangesButton"),cssClass:"apply-changes-button",hotkey:"alt+a",onClick:function(){t.save(function(e){if(t.isEditMode()){var i=e.EntityId;if(i==null){i=t.get_entityId()}t.loadById(i)}else{t.loadById(e.EntityId)}t.showSaveSuccessMessage(e)})},visible:function(){return!t.isDeleted()&&!t.isViewMode()},disabled:function(){return!t.hasSavePermission()||t.readOnly}});i.push({title:Q.text("Controls.EntityDialog.DeleteButton"),cssClass:"delete-button",hotkey:"alt+x",onClick:function(){Q.confirm(Q.text("Controls.EntityDialog.DeleteConfirmation"),function(){t.doDelete(function(){return t.dialogClose()})})},visible:function(){return t.isEditMode()&&!t.isDeleted()&&!t.isViewMode()},disabled:function(){return!t.hasDeletePermission()||t.readOnly}});i.push({title:Q.text("Controls.EntityDialog.UndeleteButton"),cssClass:"undo-delete-button",onClick:function(){if(t.isDeleted()){Q.confirm(Q.text("Controls.EntityDialog.UndeleteConfirmation"),function(){t.undelete(function(){return t.loadById(t.get_entityId())})})}},visible:function(){return t.isEditMode()&&t.isDeleted()&&!t.isViewMode()},disabled:function(){return!t.hasDeletePermission()||t.readOnly}});if(this.useViewMode()){i.push({title:Q.text("Controls.EntityDialog.EditButton"),cssClass:"edit-button",icon:"fa-edit",onClick:function(){if(!t.isEditMode())return;t.editClicked=true;t.updateInterface();t.updateTitle()},visible:function(){return t.isViewMode()},disabled:function(){return!t.hasSavePermission()||t.readOnly}})}i.push({title:Q.text("Controls.EntityDialog.LocalizationButton"),cssClass:"localization-button",onClick:function(){return t.localizationButtonClick()}});i.push({title:Q.text("Controls.EntityDialog.CloneButton"),cssClass:"clone-button",onClick:function(){if(!t.isEditMode()){return}var i=t.getCloningEntity();e.Widget.create({type:ss.getInstanceType(t),init:function(r){return e.SubDialogHelper.bubbleDataChange(e.SubDialogHelper.cascade(r,t.element),t,true).loadEntityAndOpenDialog(i,null)}})},visible:function(){return false},disabled:function(){return!t.hasInsertPermission()||t.readOnly}});return i};i.prototype.getCloningEntity=function(){var e=new Object;e=$.extend(e,this.get_entity());var t=this.getIdProperty();if(!Q.isEmptyOrNull(t)){delete e[t]}var i=this.getIsActiveProperty();if(!Q.isEmptyOrNull(i)){delete e[i]}var r=this.getIsDeletedProperty();if(!Q.isEmptyOrNull(r)){delete e[r]}return e};i.prototype.updateInterface=function(){e.EditorUtils.setContainerReadOnly(this.byId("Form"),false);var t=this.isDeleted();var i=this.isLocalizationMode();var r=this.hasSavePermission();var n=this.isViewMode();var t=this.isDeleted();var a=this.readOnly;this.toolbar.updateInterface();if(this.tabs!=null){e.TabsExtensions.setDisabled(this.tabs,"Log",this.isNewOrDeleted())}if(this.propertyGrid!=null){this.propertyGrid.element.toggle(!i)}if(this.localizationGrid!=null){this.localizationGrid.element.toggle(i)}if(this.localizationButton!=null){this.localizationButton.toggle(this.localizationGrid!=null);this.localizationButton.find(".button-inner").text(this.isLocalizationMode()?Q.text("Controls.EntityDialog.LocalizationBack"):Q.text("Controls.EntityDialog.LocalizationButton"))}if(i){if(this.toolbar!=null)this.toolbar.findButton("tool-button").not(".localization-hidden").addClass(".localization-hidden").hide();this.localizationButton&&this.localizationButton.show();return}this.toolbar.findButton("localization-hidden").removeClass("localization-hidden").show();this.saveAndCloseButton&&this.saveAndCloseButton.find(".button-inner").text(Q.text(this.isNew()?"Controls.EntityDialog.SaveButton":"Controls.EntityDialog.UpdateButton"));if(!r||n||a)e.EditorUtils.setContainerReadOnly(this.byId("Form"),true)};i.prototype.getUndeleteOptions=function(e){return{}};i.prototype.undeleteHandler=function(e,t){Q.serviceCall(e)};i.prototype.undelete=function(e){var t=this;var i={};i.service=this.getService()+"/Undelete";var r={};r.EntityId=this.get_entityId();i.request=r;i.onSuccess=function(i){e&&e(i);t.element.triggerHandler("ondatachange",[{entityId:t.get_entityId(),entity:t.entity,type:"undelete"}])};var n=this.getUndeleteOptions(e);var a=$.extend(i,n);this.undeleteHandler(a,e)};Object.defineProperty(i.prototype,"readOnly",{get:function(){return this.get_readOnly()},set:function(e){this.set_readOnly(e)},enumerable:true,configurable:true});i.prototype.get_readOnly=function(){return!!this._readonly};i.prototype.set_readOnly=function(e){if(!!this._readonly!=!!e){this._readonly=!!e;this.updateInterface();this.updateTitle()}};i.prototype.getInsertPermission=function(){return null};i.prototype.getUpdatePermission=function(){return null};i.prototype.getDeletePermission=function(){return null};i.prototype.hasDeletePermission=function(){var e=this.getDeletePermission();return e==null||Q.Authorization.hasPermission(e)};i.prototype.hasInsertPermission=function(){var e=this.getInsertPermission();return e==null||Q.Authorization.hasPermission(e)};i.prototype.hasUpdatePermission=function(){var e=this.getUpdatePermission();return e==null||Q.Authorization.hasPermission(e)};i.prototype.hasSavePermission=function(){return this.isNew()?this.hasInsertPermission():this.hasUpdatePermission()};i.prototype.isViewMode=function(){return this.useViewMode()&&this.isEditMode()&&!this.editClicked};i.prototype.useViewMode=function(){return false};i=__decorate([e.Decorators.registerClass("Serenity.EntityDialog",[e["IEditDialog"],e.IReadOnly])],i);return i}(e.TemplatedDialog);e.EntityDialog=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var i=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;if(e.reportKey){i.loadReport(e.reportKey)}return i}i.prototype.createPropertyGrid=function(){if(this.propertyGrid){this.byId("PropertyGrid").html("").attr("class","");this.propertyGrid=null}this.propertyGrid=new e.PropertyGrid(this.byId("PropertyGrid"),{idPrefix:this.idPrefix,useCategories:true,items:this.propertyItems}).init(null)
};i.prototype.loadReport=function(e){var t=this;Q.serviceCall({service:"Report/Retrieve",request:{ReportKey:e},onSuccess:function(i){t.reportKey=Q.coalesce(i.ReportKey,e);t.propertyItems=i.Properties||[];t.dialogTitle=i.Title;t.createPropertyGrid();var r=i.InitialSettings;if(r==null){r=new Object}t.propertyGrid.load(r);t.toolbar.findButton("print-preview-button").toggle(!i.IsDataOnlyReport);t.toolbar.findButton("export-pdf-button").toggle(!i.IsDataOnlyReport);t.toolbar.findButton("export-docx-button").toggle(!i.IsDataOnlyReport);t.dialogOpen(null)}})};i.prototype.executeReport=function(e,t){if(!this.validateForm()){return}var i=new Object;this.propertyGrid.save(i);Q.postToService({service:"Report/Execute",request:{ReportKey:this.reportKey,DesignId:"Default",ExportType:t,Parameters:i},target:e})};i.prototype.getToolbarButtons=function(){var e=this;var t=[];t.push({title:"Önizleme",cssClass:"print-preview-button",onClick:function(){e.executeReport("_blank",null)}});t.push({title:"PDF",cssClass:"export-pdf-button",onClick:function(){e.executeReport("","Pdf")}});t.push({title:"Excel",cssClass:"export-xlsx-button",onClick:function(){e.executeReport("","Xlsx")}});t.push({title:"Word",cssClass:"export-docx-button",onClick:function(){e.executeReport("","Docx")}});return t};i=__decorate([e.Decorators.registerClass("Serenity.Reporting.ReportDialog")],i);return i}(e.TemplatedDialog);t.ReportDialog=i;var r=function(t){__extends(r,t);function r(i){var r=t.call(this,i)||this;$(".report-link").click(function(e){return r.reportLinkClick(e)});$("div.line").click(function(e){return r.categoryClick(e)});var n=r;new e.QuickSearchInput($("#QuickSearchInput"),{onSearch:function(e,t,i){n.updateMatchFlags(t);i(true)}});return r}r.prototype.updateMatchFlags=function(e){var t=$("#ReportList").find("li").removeClass("non-match");e=Q.trimToNull(e);if(e==null){t.children("ul").hide();t.show().removeClass("expanded");return}var i=ss.netSplit(e,[44,32].map(function(e){return String.fromCharCode(e)}),null,1);for(var r=0;r<i.length;r++){i[r]=Q.trimToNull(Select2.util.stripDiacritics(i[r]).toUpperCase())}var n=t.filter(".report-item");n.each(function(e,t){var r=$(t);var n=Select2.util.stripDiacritics(Q.coalesce(r.text(),"").toUpperCase());for(var a=0;a<i.length;a++){var o=i[a];if(o!=null&&!(n.indexOf(o)!==-1)){r.addClass("non-match");break}}});var a=n.not(".non-match");var o=a.parents("li").add(a);var l=t.not(o);l.hide().addClass("non-match");o.show();if(o.length<=100){t.children("ul").show();t.addClass("expanded")}};r.prototype.categoryClick=function(e){var t=$(e.target).closest("li");if(t.hasClass("expanded")){t.find("ul").hide("fast");t.removeClass("expanded");t.find("li").removeClass("expanded")}else{t.addClass("expanded");t.children("ul").show("fast");if(t.children("ul").children("li").length===1&&!t.children("ul").children("li").hasClass("expanded")){t.children("ul").children("li").children(".line").click()}}};r.prototype.reportLinkClick=function(e){e.preventDefault();var t=new i({reportKey:$(e.target).data("key")})};r=__decorate([e.Decorators.registerClass("Serenity.Reporting.ReportPage")],r);return r}(e.Widget);t.ReportPage=r})(t=e.Reporting||(e.Reporting={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(){var i=t.call(this)||this;new e.QuickSearchInput(i.byId("Search"),{onSearch:function(e,t,r){t=Q.trimToNull(t);if(t!=null)t=Select2.util.stripDiacritics(t.toLowerCase());i.element.find("li").each(function(e,i){$(i).toggle(!t||Select2.util.stripDiacritics($(i).text().toLowerCase()).indexOf(t)>=0)});r&&r(true)}});i.ulVisible=i.byId("VisibleCols");i.ulHidden=i.byId("HiddenCols");return i}i.createToolButton=function(t){function i(){var i=new e.ColumnPickerDialog;i.allColumns=t.allColumns;if(t.initialSettings){var r=t.initialSettings;if(r.columns&&r.columns.length)i.defaultColumns=r.columns.map(function(e){return e.id})}i.visibleColumns=t.slickGrid.getColumns().map(function(e){return e.id});i.done=function(){t.allColumns=i.allColumns;var e=i.allColumns.filter(function(e){return e.visible===true});t.slickGrid.setColumns(e);t.persistSettings();t.refresh()};Q.Router.dialog(t.element,i.element,function(){return"columns"});i.dialogOpen()}t.element.on("handleroute."+t.uniqueName,function(e,t){if(t&&!t.handled&&t.route=="columns"){i()}});return{hint:Q.text("Controls.ColumnPickerDialog.Title"),cssClass:"column-picker-button",onClick:i}};i.prototype.getDialogOptions=function(){var e=this;var i=t.prototype.getDialogOptions.call(this);i.title=Q.text("Controls.ColumnPickerDialog.Title");i.width=600;i.buttons=[{text:Q.text("Controls.ColumnPickerDialog.RestoreDefaults"),click:function(){var t={};e.ulVisible.children().add(e.ulHidden.children()).each(function(e,i){var r=$(i);t[r.data("key")]=r});var i=null;for(var r=0,n=e.defaultColumns;r<n.length;r++){var a=n[r];var o=t[a];if(!o)continue;if(i==null)o.prependTo(e.ulVisible);else o.insertAfter(i);i=o;var l=o.data("key");delete t[l]}for(var l in t)t[l].appendTo(e.ulHidden);e.updateListStates()}},{text:Q.text("Dialogs.OkButton"),click:function(){var t=[];for(var i=0,r=e.allColumns;i<r.length;i++){var n=r[i];n.visible=false}e.visibleColumns=e.ulVisible.children().toArray().map(function(i){var r=$(i).data("key");var n=e.colById[r];n.visible=true;t.push(n);return r});for(var a=0,o=e.allColumns;a<o.length;a++){var n=o[a];if(!n.visible)t.push(n)}e.allColumns=t;e.done&&e.done();e.dialogClose()}},{text:Q.text("Dialogs.CancelButton"),click:function(){e.dialogClose()}}];return i};i.prototype.getTitle=function(e){if(e.id=="__select__")return"[x]";return e.name||e.toolTip||e.id};i.prototype.allowHide=function(e){return e.sourceItem==null||e.sourceItem.allowHide==null||e.sourceItem.allowHide};i.prototype.createLI=function(e){var t=this.allowHide(e);return $('\n<li data-key="'+e.id+'" class="'+(t?"":"cant-hide")+'">\n  <span class="drag-handle">☰</span>\n  '+Q.htmlEncode(this.getTitle(e))+"\n  "+(t?'<i class="js-hide" title="'+Q.text("Controls.ColumnPickerDialog.HideHint")+'">✖</i>':"")+'\n  <i class="js-show fa fa-eye" title="'+Q.text("Controls.ColumnPickerDialog.ShowHint")+'"></i>\n</li>')};i.prototype.updateListStates=function(){this.ulVisible.children().removeClass("bg-info").addClass("bg-success");this.ulHidden.children().removeClass("bg-success").addClass("bg-info")};i.prototype.setupColumns=function(){var e=this;this.allColumns=this.allColumns||[];this.visibleColumns=this.visibleColumns||[];var t={};for(var i=0,r=this.visibleColumns;i<r.length;i++){var n=r[i];t[n]=true}this.colById={};for(var a=0,o=this.allColumns;a<o.length;a++){var l=o[a];this.colById[l.id]=l}if(this.defaultColumns==null)this.defaultColumns=this.visibleColumns.slice(0);var s=[];for(var u=0,c=this.allColumns;u<c.length;u++){var d=c[u];if(!t[d.id]&&(!d.sourceItem||d.sourceItem.filterOnly!==true&&(d.sourceItem.readPermission==null||Q.Authorization.hasPermission(d.sourceItem.readPermission)))){s.push(d)}}var f=s.sort(function(t,i){return Q.turkishLocaleCompare(e.getTitle(t),e.getTitle(i))});for(var p=0,h=this.visibleColumns;p<h.length;p++){var n=h[p];var g=this.colById[n];if(!g)continue;this.createLI(g).appendTo(this.ulVisible)}for(var y=0,v=f;y<v.length;y++){var m=v[y];this.createLI(m).appendTo(this.ulHidden)}this.updateListStates();if(typeof Sortable!=="undefined"&&Sortable.create){Sortable.create(this.ulVisible[0],{group:this.uniqueName+"_group",filter:".js-hide",onFilter:function(t){$(t.item).appendTo(e.ulHidden);e.updateListStates()},onMove:function(t){if($(t.dragged).hasClass("cant-hide")&&t.from==e.ulVisible[0]&&t.to!==t.from)return false;return true},onEnd:function(t){return e.updateListStates()}});Sortable.create(this.ulHidden[0],{group:this.uniqueName+"_group",sort:false,filter:".js-show",onFilter:function(t){$(t.item).appendTo(e.ulVisible);e.updateListStates()},onEnd:function(t){return e.updateListStates()}})}};i.prototype.onDialogOpen=function(){t.prototype.onDialogOpen.call(this);this.element.find("input").removeAttr("disabled");this.element.closest(".ui-dialog").children(".ui-dialog-buttonpane").find("button").eq(0).addClass("restore-defaults").next().focus();this.setupColumns();Q.centerDialog(this.element)};i.prototype.getTemplate=function(){return'\n<div class="search"><input id="~_Search" type="text" disabled /></div>\n<div class="columns-container">\n<div class="column-list visible-list bg-success">\n  <h5><i class="fa fa-eye"></i> '+Q.text("Controls.ColumnPickerDialog.VisibleColumns")+'</h5>\n  <ul id="~_VisibleCols"></ul>\n</div>\n<div class="column-list hidden-list bg-info">\n  <h5><i class="fa fa-list"></i> '+Q.text("Controls.ColumnPickerDialog.HiddenColumns")+'</h5>\n  <ul id="~_HiddenCols"></ul>\n</div>\n</div>'};i=__decorate([e.Decorators.registerClass(),e.Decorators.resizable(),e.Decorators.responsive()],i);return i}(e.TemplatedDialog);e.ColumnPickerDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(i){this.options=i;var r=this.dataGrid=i.grid;var n=r.getIdProperty();var a=this.getId=function(e){return e[n]};r.element.find(".grid-container").on("click",function(t){if($(t.target).hasClass("s-TreeToggle")){var i=r.slickGrid.getCellFromEvent(t);if(i.cell>=0&&i.row>=0){e.SlickTreeHelper.toggleClick(t,i.row,i.row,r.view,a)}}});var o=r.onViewFilter;r.onViewFilter=function(t){if(!o.apply(this,[t]))return false;return e.SlickTreeHelper.filterById(t,r.view,i.getParentId)};var l=r.onViewProcessData;r.onViewProcessData=function(r){r=l.apply(this,[r]);r.Entities=t.applyTreeOrdering(r.Entities,a,i.getParentId);e.SlickTreeHelper.setIndents(r.Entities,a,i.getParentId,i.initialCollapse&&i.initialCollapse()||false);return r};if(i.toggleField){var s=Q.tryFirst(r["allColumns"]||r.slickGrid.getColumns()||[],function(e){return e.field==i.toggleField});if(s){s.format=e.SlickFormatting.treeToggle(function(){return r.view},a,s.format||function(e){return Q.htmlEncode(e.value)});s.formatter=e.SlickHelper.convertToFormatter(s.format)}}}t.prototype.toggleAll=function(){e.SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),!this.dataGrid.view.getItems().every(function(e){return e._collapsed==true}));this.dataGrid.view.setItems(this.dataGrid.view.getItems(),true)};t.prototype.collapseAll=function(){e.SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),true);this.dataGrid.view.setItems(this.dataGrid.view.getItems(),true)};t.prototype.expandAll=function(){e.SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),false);this.dataGrid.view.setItems(this.dataGrid.view.getItems(),true)};t.applyTreeOrdering=function(e,t,i){var r=[];var n=Q.toGrouping(e,t);var a=Q.toGrouping(e,i);var o={};function l(e){if(o[e])return;o[e]=true;for(var i=0,n=a[e]||[];i<n.length;i++){var s=n[i];r.push(s);l(t(s))}}for(var s=0,u=e;s<u.length;s++){var c=u[s];var d=i(c);if(d==null||!(n[d]||[]).length){r.push(c);l(t(c))}}return r};return t}();e.TreeGridMixin=t})(Serenity||(Serenity={}));if($.fn.button&&$.fn.button.noConflict){var btn=$.fn.button.noConflict();$.fn.btn=btn}$.fn.flexHeightOnly=function(e){if(e===void 0){e=1}return this.flexWidthHeight(0,e)};$.fn.flexWidthOnly=function(e){if(e===void 0){e=1}return this.flexWidthHeight(e,0)};$.fn.flexWidthHeight=function(e,t){if(e===void 0){e=1}if(t===void 0){t=1}return this.addClass("flexify").data("flex-x",e).data("flex-y",t)};$.fn.flexX=function(e){return this.data("flex-x",e)};$.fn.flexY=function(e){return this.data("flex-y",e)};if($.fn.button&&$.fn.button.noConflict){var btn=$.fn.button.noConflict();$.fn.btn=btn}(function(e){e.widget("ui.slickPager",{options:{view:null,showRowsPerPage:true,rowsPerPageOptions:[20,100,500,2e3]},_create:function(){var t=this;var i=t.options;var r=i.view;if(!r)throw"SlickPager requires view option to be set!";this.element.addClass("s-SlickPager slick-pg").html('<div class="slick-pg-in">'+'<div class="slick-pg-grp">'+'<div class="slick-pg-first slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'<div class="slick-pg-prev slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'</div><div class="slick-pg-sep"></div><div class="slick-pg-grp">'+'<span class="slick-pg-control">&nbsp;'+Q.text("Controls.Pager.Page")+'&nbsp;<input class="slick-pg-current" type="text" size="4" value="1" /> / '+'<span class="slick-pg-total"> 1 </span></span>'+'</div><div class="slick-pg-sep"></div><div class="slick-pg-grp">'+'<div class="slick-pg-next slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'<div class="slick-pg-last slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'</div><div class="slick-pg-sep"></div><div class="slick-pg-grp">'+'<div class="slick-pg-reload slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'</div><div class="slick-pg-sep"></div>'+'<div class="slick-pg-grp"><span class="slick-pg-stat"></span></div></div>');e(".slick-pg-reload",this.element).click(function(){r.populate()});e(".slick-pg-first",this.element).click(function(){t._changePage("first")});e(".slick-pg-prev",this.element).click(function(){t._changePage("prev")});e(".slick-pg-next",this.element).click(function(){t._changePage("next")});e(".slick-pg-last",this.element).click(function(){t._changePage("last")});e(".slick-pg-current",this.element).keydown(function(e){if(e.keyCode==13)t._changePage("input")});if(t.options.showRowsPerPage){var n,a="";for(var o=0;o<i.rowsPerPageOptions.length;o++){if(r.rowsPerPage==i.rowsPerPageOptions[o])a='selected="selected"';else a="";n+="<option value='"+i.rowsPerPageOptions[o]+"' "+a+" >"+i.rowsPerPageOptions[o]+"&nbsp;&nbsp;</option>"}e(".slick-pg-in",this.element).prepend('<div class="slick-pg-grp"><select class="slick-pg-size" name="rp">'+n+'</select></div><div class="slick-pg-sep"></div>');e("select.slick-pg-size",this.element).change(function(){if(i.onRowsPerPageChange)i.onRowsPerPageChange(+this.value);else{r.newp=1;r.setPagingOptions({page:1,rowsPerPage:+this.value})}})}r.onPagingInfoChanged.subscribe(function(){t._updatePager()})},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments)},_changePage:function(t){var i=this.options.view;if(!i||i.loading)return true;var r=i.getPagingInfo();var n=!r.rowsPerPage||!r.totalCount?1:Math.ceil(r.totalCount/r.rowsPerPage);var a;switch(t){case"first":a=1;break;case"prev":if(r.page>1)a=parseInt(r.page)-1;break;case"next":if(r.page<n)a=parseInt(r.page)+1;break;case"last":a=n;break;case"input":var o=parseInt(e("input.slick-pg-current",this.element).val());if(isNaN(o))o=1;else if(o<1)o=1;else if(o>n)o=n;e(".slick-pg-current",this.element).val(o);a=o;break}if(a==r.page)return false;if(this.options.onChangePage)this.options.onChangePage(a);else{i.setPagingOptions({page:a})}},_updatePager:function(){var t=this.options.view;var i=t.getPagingInfo();var r=!i.rowsPerPage||!i.totalCount?1:Math.ceil(i.totalCount/i.rowsPerPage);e(".slick-pg-current",this.element).val(i.page);e(".slick-pg-total",this.element).html(r);var n=(i.page-1)*i.rowsPerPage+1;var a=n+i.rowsPerPage-1;if(i.totalCount<a)a=i.totalCount;var o;if(i.loading){o=Q.text("Controls.Pager.LoadingStatus")}else if(i.error){o=i.error}else if(i.totalCount>0){o=Q.text("Controls.Pager.PageStatus");o=o.replace(/{from}/,n);o=o.replace(/{to}/,a);o=o.replace(/{total}/,i.totalCount)}else o=Q.text("Controls.Pager.NoRowStatus");e(".slick-pg-stat",this.element).html(o);e(".slick-pg-size",this.element).val((i.rowsPerPage||0).toString())},_setOption:function(t,i){e.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);var Slick;(function(e){var t;(function(e){var t})(t=e.Data||(e.Data={}))})(Slick||(Slick={}));(function(e){var t=function(){function t(t){var i=this;var r={groupItemMetadataProvider:null,inlineFilters:false};var n;var a=[];var o=[];var l={};var s=null;var u=null;var c=null;var d=0;var f=true;var p;var h;var g={};var y={};var v;var m=[];var b;var C;var _=[];var x={getter:null,formatter:null,comparer:function(e,t){return e.value===t.value?0:e.value>t.value?1:-1},predefinedValues:[],aggregateEmpty:false,aggregateCollapsed:false,aggregateChildGroups:false,collapsed:false,displayTotalsRow:true,lazyTotalsCalculation:false};var S={};var w=[];var T=[];var I=[];var k=":|:";var F=1;var D=0;var E=new e.Event;var O=new e.Event;var P=new e.Event;var A=false;var N=null;var R=0;var V=0;var B;var L;var G=null;var M=new e.Event;var z=new e.Event;var q=new e.Event;var H=new e.Event;var W;function U(){d++}function j(){d--;if(d<=0)Kt()}function K(e){g=e}function Y(e){v=e}function J(e){e=e||0;var t;for(var i=e,r=a.length;i<r;i++){t=a[i][n];if(t===undefined){var o="Each data element must implement a unique '"+n+"' property. Object at index '"+i+"' "+"has no identity value: ";o+=$.toJSON(a[i]);throw o}l[t]=i}}function X(){var e;for(var t=0,i=a.length;t<i;t++){e=a[t][n];if(e===undefined||l[e]!==t){var r="Each data element must implement a unique '"+n+"' property. Object at index '"+t+"' ";if(e==undefined)r+="has no identity value: ";else r+="has repeated identity value '"+e+"': ";r+=$.toJSON(a[t]);throw r}}}function Z(){return a}function et(e){a=m=e;l={};s=null;S.totals={};J();X();if(d){jt(a)}else{Kt()}M.notify({dataView:i},null,i)}function tt(e){var t=false;if(e.rowsPerPage!=undefined&&W.rowsPerPage!=e.rowsPerPage){W.rowsPerPage=e.rowsPerPage;t=true}if(e.page!=undefined){var i;if(!W.rowsPerPage)i=1;else if(G==null)i=e.page;else i=Math.min(e.page,Math.ceil(G/W.rowsPerPage)+1);if(i<1)i=1;if(i!=F){W.seekToPage=i;t=true}}if(t)Zt()}function it(){return{rowsPerPage:W.rowsPerPage,page:F,totalCount:G,loading:A,error:N,dataView:i}}function rt(e,t){f=t;h=e;p=null;if(t===false){a.reverse()}a.sort(e);if(t===false){a.reverse()}l={};J();Kt()}function nt(e,t){f=t;p=e;h=null;var i=Object.prototype.toString;Object.prototype.toString=typeof e==="function"?e:function(){return this[e]};if(t===false){a.reverse()}a.sort();Object.prototype.toString=i;if(t===false){a.reverse()}l={};J();Kt()}function at(){if(h){rt(h,f)}else if(p){nt(p,f)}}function ot(e){u=e;if(t.inlineFilters){b=Mt();C=zt()}Kt()}function lt(){return w}function st(e){e=e||{};S.aggregators=e.aggregators||[];S.compiledAccumulators=[];S.totals={};var t=S.aggregators.length;while(t--){S.compiledAccumulators[t]=Gt(S.aggregators[t])}ct(w||[])}function ut(){S.totals=S.totals||{};if(!S.totals.initialized){S.aggregators=S.aggregators||[];S.compiledAccumulators=S.compiledAccumulators||[];var e,t=S.aggregators.length;while(t--){e=S.aggregators[t];e.init();S.compiledAccumulators[t].call(e,a);e.storeResult(S.totals)}S.totals.initialized=true}return S.totals}function ct(i){if(!t.groupItemMetadataProvider){t.groupItemMetadataProvider=new e.Data.GroupItemMetadataProvider}T=[];I=[];i=i||[];w=i instanceof Array?i:[i];for(var r=0;r<w.length;r++){var n=w[r]=$.extend(true,{},x,w[r]);n.aggregators=n.aggregators||S.aggregators||[];n.getterIsAFn=typeof n.getter==="function";n.compiledAccumulators=[];var a=n.aggregators.length;while(a--){n.compiledAccumulators[a]=Gt(n.aggregators[a])}I[r]={}}Kt()}function dt(e){return a[e]}function ft(e){return l[e]}function pt(){if(!s){s={};for(var e=0,t=o.length;e<t;e++){s[o[e][n]]=e}}}function ht(e){pt();return s[e]}function gt(e){return a[l[e]]}function yt(e){var t=[];pt();for(var i=0,r=e.length;i<r;i++){var n=s[e[i]];if(n!=null){t[t.length]=n}}return t}function vt(e){var t=[];for(var i=0,r=e.length;i<r;i++){if(e[i]<o.length){t[t.length]=o[e[i]][n]}}return t}function mt(e,t){if(l[e]===undefined||e!==t[n]){throw"Invalid or non-matching id"}a[l[e]]=t;if(!c){c={}}c[e]=true;Kt()}function bt(e,t){a.splice(e,0,t);J(e);Kt()}function Ct(e){a.push(e);J(a.length-1);Kt()}function _t(e){var t=l[e];if(t===undefined){throw"Invalid id"}delete l[e];a.splice(t,1);J(t);Kt()}function xt(){return o}function St(){return o.length}function wt(e){var t=o[e];if(t&&t.__group&&t.totals&&!t.totals.initialized){var i=w[t.level];if(!i.displayTotalsRow){$t(t.totals);t.title=i.formatter?i.formatter(t):t.value}}else if(t&&t.__groupTotals&&!t.initialized){$t(t)}return t}function Tt(e){var i=o[e];if(i===undefined){return null}if(i.__group){return t.groupItemMetadataProvider.getGroupRowMetadata(i)}if(i.__groupTotals){return t.groupItemMetadataProvider.getTotalsRowMetadata(i)}return t.getItemMetadata&&t.getItemMetadata(i,e)||null}function It(e,t){if(e==null){for(var i=0;i<w.length;i++){I[i]={};w[i].collapsed=t}}else{I[e]={};w[e].collapsed=t}Kt()}function kt(e){It(e,true)}function Ft(e){It(e,false)}function Dt(e){var t=e[0];if(e.length===1&&t.indexOf(k)!==-1){return{level:t.split(k).length-1,groupingKey:t}}else{return{level:e.length-1,groupingKey:e.join(k)}}}function Qt(e,t){var i=Dt(e);I[i.level][i.groupingKey]=w[i.level].collapsed^t;Kt()}function Et(e){var t=Array.prototype.slice.call(arguments);Qt(t,true)}function Ot(e){var t=Array.prototype.slice.call(arguments);Qt(t,false)}function Pt(){return T}function At(t,i,r,n,a){var o=t[i];if(!o){o=new e.Group;o.value=i;o.level=r;o.groupingKey=(n?n.groupingKey+k:"")+i;a[a.length]=o;t[i]=o}return o}function Nt(e,t){var i;var r;var n=[];var a={};var o;var l=t?t.level+1:0;var s=w[l];for(var u=0,c=s.predefinedValues.length;u<c;u++){r=s.predefinedValues[u];i=At(a,r,l,t,n)}for(var u=0,c=e.length;u<c;u++){o=e[u];r=s.getterIsAFn?s.getter(o):o[s.getter];i=At(a,r,l,t,n);i.rows[i.count++]=o}if(l<w.length-1){for(var u=0;u<n.length;u++){i=n[u];i.groups=Nt(i.rows,i)}}n.sort(w[l].comparer);return n}function $t(e){var t=e.group;var i=w[t.level];var r=t.level==w.length;var n,a=i.aggregators.length;if(!r&&i.aggregateChildGroups){var o=t.groups.length;while(o--){if(!t.groups[o].totals.initialized){$t(t.groups[o].totals)}}}while(a--){n=i.aggregators[a];n.init();if(!r&&i.aggregateChildGroups){i.compiledAccumulators[a].call(n,t.groups)}else{i.compiledAccumulators[a].call(n,t.rows)}n.storeResult(e)}e.initialized=true}function Rt(t){var i=w[t.level];var r=new e.GroupTotals;r.group=t;t.totals=r;if(!i.lazyTotalsCalculation){$t(r)}}function Vt(e,t){t=t||0;var i=w[t];var r=i.collapsed;var n=I[t];var a=e.length,o;while(a--){o=e[a];if(o.collapsed&&!i.aggregateCollapsed){continue}if(o.groups){Vt(o.groups,t+1)}if(i.aggregators.length&&(i.aggregateEmpty||o.rows.length||o.groups&&o.groups.length)){Rt(o)}o.collapsed=r^n[o.groupingKey];o.title=i.formatter?i.formatter(o):o.value}}function Bt(e,t){t=t||0;var i=w[t];var r=[],n,a=0,o;for(var l=0,s=e.length;l<s;l++){o=e[l];r[a++]=o;if(!o.collapsed){n=o.groups?Bt(o.groups,t+1):o.rows;for(var u=0,c=n.length;u<c;u++){r[a++]=n[u]}}if(o.totals&&i.displayTotalsRow&&(!o.collapsed||i.aggregateCollapsed)){r[a++]=o.totals}}return r}function Lt(e){var t=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/;var i=e.toString().match(t);return{params:i[1].split(","),body:i[2]}}function Gt(e){var t=Lt(e.accumulate);var i=new Function("_items","for (var "+t.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+t.params[0]+" = _items[_i]; "+t.body+"}");i.displayName=i.name="compiledAccumulatorLoop";return i}function Mt(){var e=Lt(u);var t=e.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }$2");var i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,t);i=i.replace(/\$item\$/gi,e.params[0]);i=i.replace(/\$args\$/gi,e.params[1]);var r=new Function("_items,_args",i);r.displayName=r.name="compiledFilter";return r}function zt(){var e=Lt(u);var t=e.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }$2");var i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,t);i=i.replace(/\$item\$/gi,e.params[0]);i=i.replace(/\$args\$/gi,e.params[1]);var r=new Function("_items,_args,_cache",i);r.displayName=r.name="compiledFilterWithCaching";return r}function qt(e,t){var i=[],r=0;for(var n=0,a=e.length;n<a;n++){if(u(e[n],t)){i[r++]=e[n]}}return i}function Ht(e,t,i){var r=[],n=0,a;for(var o=0,l=e.length;o<l;o++){a=e[o];if(i[o]){r[n++]=a}else if(u(a,t)){r[n++]=a;i[o]=true}}return r}function Wt(e){if(u){var i=t.inlineFilters?b:qt;var r=t.inlineFilters?C:Ht;if(g.isFilterNarrowing){m=i(m,v)}else if(g.isFilterExpanding){m=r(e,v,_)}else if(!g.isFilterUnchanged){m=i(e,v)}}else{m=e.concat()}return{totalRows:m.length,rows:m}}function Ut(e,t){var i,r,a,o=[];var l=0,s=t.length;if(g&&g.ignoreDiffsBefore){l=Math.max(0,Math.min(t.length,g.ignoreDiffsBefore))}if(g&&g.ignoreDiffsAfter){s=Math.min(t.length,Math.max(0,g.ignoreDiffsAfter))}for(var u=l,d=e.length;u<s;u++){if(u>=d){o[o.length]=u}else{i=t[u];r=e[u];if(w.length&&(a=i.__nonDataRow||r.__nonDataRow)&&i.__group!==r.__group||i.__group&&!i.equals(r)||a&&(i.__groupTotals||r.__groupTotals)||i[n]!=r[n]||c&&c[i[n]]){o[o.length]=u}}}return o}function jt(e){s=null;if(g.isFilterNarrowing!=y.isFilterNarrowing||g.isFilterExpanding!=y.isFilterExpanding){_=[]}var t=Wt(e);D=t.totalRows;var i=t.rows;S.totals={};T=[];if(w.length){T=Nt(i);if(T.length){Vt(T);i=Bt(T)}}var r=Ut(o,i);o=i;return r}function Kt(){if(d){return}var e=o.length;var t=D;var r=jt(a);c=null;y=g;g={};if(t!==D){P.notify(it(),null,i)}if(e!==o.length){E.notify({previous:e,current:o.length,dataView:i},null,i)}if(r.length>0){O.notify({rows:r,dataView:i},null,i)}}function Yt(t,i,r){var n=this;var a;var o=n.mapRowsToIds(t.getSelectedRows());var l=new e.Event;function s(i){if(o.join(",")==i.join(",")){return}o=i;l.notify({grid:t,ids:o,dataView:n},new e.EventData,n)}function u(){if(o.length>0){a=true;var e=n.mapIdsToRows(o);if(!i){s(n.mapRowsToIds(e))}t.setSelectedRows(e);a=false}}t.onSelectedRowsChanged.subscribe(function(e,i){if(a){return}var l=n.mapRowsToIds(t.getSelectedRows());if(!r||!t.getOptions().multiSelect){s(l)}else{var u=$.grep(o,function(e){return n.getRowById(e)===undefined});s(u.concat(l))}});this.onRowsChanged.subscribe(u);this.onRowCountChanged.subscribe(u);return l}function Jt(e,t){var i;var r;a(e.getCellCssStyles(t));function a(e){i={};for(var t in e){var r=o[t][n];i[r]=e[t]}}function l(){if(i){r=true;pt();var n={};for(var a in i){var o=s[a];if(o!=undefined){n[o]=i[a]}}e.setCellCssStyles(t,n);r=false}}e.onCellCssStylesChanged.subscribe(function(e,i){if(r){return}if(t!=i.key){return}if(i.hash){a(i.hash)}});this.onRowsChanged.subscribe(l);this.onRowCountChanged.subscribe(l)}function Xt(e){if(W.onProcessData&&e)e=W.onProcessData(e,W)||e;N=null;A&&A.abort();A=false;if(!e){N=W.errormsg;P.notify(it());return false}var t=e;e.TotalCount=e.TotalCount||0;e.Entities=e.Entities||[];if(!e.Skip||!W.rowsPerPage&&!e.Take)e.Page=1;else e.Page=Math.ceil(e.Skip/(e.Take||W.rowsPerPage))+1;F=e.Page;G=e.TotalCount;et(e.Entities);P.notify(it())}function Zt(){if(R>0){V++;return}V=0;A&&A.abort();if(W.onSubmit){var e=W.onSubmit(W);if(e===false)return false}z.notify(this);if(!W.url)return false;if(!W.seekToPage)W.seekToPage=1;var t={};var i=(W.seekToPage-1)*W.rowsPerPage;if(i)t.Skip=i;if(W.rowsPerPage)t.Take=W.rowsPerPage;if(W.sortBy&&W.sortBy.length){if($.isArray(W.sortBy))t.Sort=W.sortBy;else{t.Sort=[W.sortBy]}}if(W.params){t=$.extend(t,W.params)}var r=L;var n=this;var a={cache:false,type:W.method,contentType:B,url:W.url,data:t,dataType:r,success:function(e){A=false;if(e.Error)Q.notifyError(e.Error.Message||e.Error.Code);else Xt(e);q.notify(this)},error:function(e,t,i){A=false;if((e.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var r=$.parseJSON(e.responseText);if(r!=null&&r.Error!=null){Q.notifyError(r.Error.Message||r.Error.Code);P.notify(it());q.notify(this);return}}N=e.errormsg;P.notify(it());q.notify(this)},complete:function(){A=false}};if(W.onAjaxCall){var o=W.onAjaxCall(this,a);if(o===false){A=false;P.notify(it());return false}}a.data=$.toJSON(a.data);P.notify(it());A=$.ajax(a)}function ei(){if(R==0)V=0;R++}function ti(){if(R>0){R--;if(R==0&&V>0)Zt()}}W={beginUpdate:U,endUpdate:j,setPagingOptions:tt,getPagingInfo:it,getRows:xt,getItems:Z,setItems:et,setFilter:ot,sort:rt,fastSort:nt,reSort:at,setSummaryOptions:st,getGrandTotals:ut,setGrouping:ct,getGrouping:lt,collapseAllGroups:kt,expandAllGroups:Ft,collapseGroup:Et,expandGroup:Ot,getGroups:Pt,getIdxById:ft,getRowById:ht,getItemById:gt,getItemByIdx:dt,mapRowsToIds:vt,mapIdsToRows:yt,setRefreshHints:K,setFilterArgs:Y,refresh:Kt,updateItem:mt,insertItem:bt,addItem:Ct,deleteItem:_t,syncGridSelection:Yt,syncGridCellCssStyles:Jt,getLength:St,getItem:wt,getItemMetadata:Tt,onRowCountChanged:E,onRowsChanged:O,onPagingInfoChanged:P,addData:Xt,populate:Zt,populateLock:ei,populateUnlock:ti,onDataChanged:M,onDataLoaded:q,onDataLoading:z};n=t.idField||"id";B=t.contentType||"application/json";L=t.dataType||"json";u=t.filter||null;W.params=t.params||{};W.onSubmit=t.onSubmit||null;W.url=t.url||null;W.rowsPerPage=t.rowsPerPage||0;W.seekToPage=t.seekToPage||1;W.onAjaxCall=t.onAjaxCall||null;W.onProcessData=t.onProcessData||null;W.method=t.method||"POST";W.errormsg=W.errormsg||Q.text("Controls.Pager.DefaultLoadError");W.sortBy=t.sortBy||[];W.idField=n;if(t.url&&t.autoLoad){Zt()}return W}return t}();e.RemoteView=t})(Slick||(Slick={}));(function(e){var t;(function(e){function t(e){this.field_=e;this.init=function(){this.count_=0;this.nonNullCount_=0;this.sum_=0};this.accumulate=function(e){var t=e[this.field_];this.count_++;if(t!=null&&t!==""&&!isNaN(t)){this.nonNullCount_++;this.sum_+=parseFloat(t)}};this.storeResult=function(e){if(!e.avg){e.avg={}}if(this.nonNullCount_!=0){e.avg[this.field_]=this.sum_/this.nonNullCount_}}}e.Avg=t;function i(e,t){this.field_=e;this.weightedField_=t;this.init=function(){this.sum_=0;this.weightedSum_=0};this.accumulate=function(e){var t=e[this.field_];var i=e[this.weightedField_];if(this.isValid(t)&&this.isValid(i)){this.weightedSum_+=parseFloat(i);this.sum_+=parseFloat(t)*parseFloat(i)}};this.storeResult=function(e){if(!e.avg){e.avg={}}if(this.sum_&&this.weightedSum_){e.avg[this.field_]=this.sum_/this.weightedSum_}};this.isValid=function(e){return e!==null&&e!==""&&!isNaN(e)}}e.WeightedAvg=i;function r(e){this.field_=e;this.init=function(){this.min_=null};this.accumulate=function(e){var t=e[this.field_];if(t!=null&&t!==""&&!isNaN(t)){if(this.min_==null||t<this.min_){this.min_=t}}};this.storeResult=function(e){if(!e.min){e.min={}}e.min[this.field_]=this.min_}}e.Min=r;function n(e){this.field_=e;this.init=function(){this.max_=null};this.accumulate=function(e){var t=e[this.field_];if(t!=null&&t!==""&&!isNaN(t)){if(this.max_==null||t>this.max_){this.max_=t}}};this.storeResult=function(e){if(!e.max){e.max={}}e.max[this.field_]=this.max_}}e.Max=n;function a(e){this.field_=e;this.init=function(){this.sum_=null};this.accumulate=function(e){var t=e[this.field_];if(t!=null&&t!==""&&!isNaN(t)){this.sum_+=parseFloat(t)}};this.storeResult=function(e){if(!e.sum){e.sum={}}e.sum[this.field_]=this.sum_}}e.Sum=a})(t=e.Aggregators||(e.Aggregators={}))})(Slick||(Slick={}));var Q;(function(e){var t;function i(e,i){t.call(this,e,i);this.errorsFor(e).each(function(t,i){if($(e).hasClass("error"))$(i).removeClass("checked");$(i).attr("title",$(i).text())})}function r(){if($.validator.methods["customValidate"]==null){$.validator.addMethod("customValidate",function(e,t){var i=this.optional(t);if(t==null||!!i){return i}var r=$._data(t,"events");if(!r){return true}var n=r.customValidate;if(n==null||n.length===0){return true}var a=$(t);for(var o=0;!!(o<n.length);o++){var l=ss.safeCast(n[o].handler,Function);if(l){var s=l(a);if(s!=null){a.data("customValidationMessage",s);return false
}}}return true},function(e,t){return $(t).data("customValidationMessage")})}}function n(){r();var n=$.validator;n=n.prototype;t=n.showLabel;n.showLabel=i;$.validator.addMethod("dateQ",function(t,i){var r=this.optional(i);if(r)return r;var n=e.parseDate(t);if(!n)return false;var a=new Date(n);a.setHours(0,0,0,0);return a.getTime()===n.getTime()});$.validator.addMethod("hourAndMin",function(t,i){return this.optional(i)||!isNaN(e.parseHourAndMin(t))});$.validator.addMethod("dayHourAndMin",function(t,i){return this.optional(i)||!isNaN(e.parseDayHourAndMin(t))});$.validator.addMethod("decimalQ",function(t,i){return this.optional(i)||!isNaN(e.parseDecimal(t))});$.validator.addMethod("integerQ",function(t,i){return this.optional(i)||!isNaN(e.parseInteger(t))});var a=$.validator.methods["email"];$.validator.addMethod("email",function(t,i){if(!e.Config.emailAllowOnlyAscii)return a.call(this,t,i);return this.optional(i)||/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)});$.validator.addMethod("emailMultiple",function(e,t){var i=this.optional(t);if(i)return i;if(e.indexOf(";")>=0)e=e.split(";");else e=e.split(",");for(var r=0;r<e.length;r++){i=$.validator.methods["email"].call(this,e[r],t);if(!i)return i}return i});$.validator.addMethod("anyvalue",function(e,t){return true});var o=$.validator.defaults;o.ignoreTitle=true;o.onchange=function(e){this.element(e)};n.oldinit=n.init;n.init=function(){n.oldinit.call(this);function e(e){if(this.form==null)return;var t=$.data(this.form,"validator"),i="on"+e.type.replace(/^validate/,"");t&&t.settings[i]&&t.settings[i].call(t,this)}function t(t){var i=this[0];if(!$.data(i,"changebound")){$(i).change(e);$.data(i,"changebound",true)}}$(this.currentForm).on(":text, :password, :file, select, textarea","focusin.validate",t)};n.oldfocusInvalid=n.focusInvalid;n.focusInvalid=function(){if(this.settings.abortHandler)this.settings.abortHandler(this);this.oldfocusInvalid.call(this)};n.oldstopRequest=n.focusInvalid;n.stopRequest=function(e,t){var i=this.formSubmitted;this.oldfocusInvalid.call(this,[e,t]);if(!t&&this.pendingRequest==0&&i&&this.settings.abortHandler){this.settings.abortHandler(this)}};n.resetAll=function(){this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)};jQuery(function(){$.extend($.validator.messages,{email:e.text("Validation.Email"),required:e.text("Validation.Required"),minlength:e.text("Validation.MinLength"),maxlength:e.text("Validation.MaxLength"),digits:e.text("Validation.Digits"),range:e.text("Validation.Range"),xss:e.text("Validation.Xss"),dateQ:e.text("Validation.DateInvalid"),decimalQ:e.text("Validation.Decimal"),integerQ:e.text("Validation.Integer"),url:e.text("Validation.Url")})})}function a(e){e.settings.abortHandler=null;e.settings.submitHandler=function(){return false}}e.validatorAbortHandler=a;function o(t){return $.extend({ignore:":hidden",meta:"v",errorClass:"error",errorPlacement:function(e,t){var i=null;var r=t.attr("data-vx-id");if(r){i=$("#"+r);if(!i.length)i=null;else i=i[0]}if(i==null){i=t.parents("div.field");if(i.length){var n=$("div.vx",i[0]);if(n.length)i=n[0]}else i=t.parent()}e.appendTo(i)},submitHandler:function(){return false},invalidHandler:function(t,i){e.notifyError(e.text("Validation.InvalidFormMessage"));$(i.errorList.map(function(e){return e.element})).closest(".category.collapsed").children(".category-title").each(function(e,t){$(t).click();return true});if(i.errorList.length){var r=i.errorList[0].element;if(r){var n=$(r).closest(".tab-pane");if(!n.hasClass("active")&&n.parent().hasClass("tab-content")){var a=n.attr("id");if(a){$('a[href="#'+a+'"]').click()}}if($.fn.tooltip){$.fn.tooltip&&$(r).tooltip({title:i.errorList[0].message,trigger:"manual"}).tooltip("show");window.setTimeout(function(){$(r).tooltip("destroy")},1500)}}}},success:function(e){e.addClass("checked")}},t)}e.validateOptions=o;if(window["jQuery"]&&window["jQuery"]["validator"])n();else if(window["jQuery"]){jQuery(function(e){if(e.validator)n()})}function l(){var t=e.Culture.dateOrder;var i=e.Culture.dateSeparator;var r=($("html").attr("lang")||"en").toLowerCase();if(!$.datepicker.regional[r]){r=r.split("-")[0];if(!$.datepicker.regional[r]){r="en"}}$.datepicker.setDefaults($.datepicker.regional["en"]);$.datepicker.setDefaults($.datepicker.regional[r]);$.datepicker.setDefaults({dateFormat:t=="mdy"?"mm"+i+"dd"+i+"yy":t=="ymd"?"yy"+i+"mm"+i+"dd":"dd"+i+"mm"+i+"yy",buttonImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuNvyMY98AAAHNSURBVEhLtZU/S8NAGIf7FfpJHDoX136ADp3s4qDgUpeCDlJEEIcubk7ZFJ06OBRcdJAOdhCx6CAWodJFrP8KFexrnhcv3sVLVYyBp/fLXe75hbSkGRFxaLVaEgSBMMbXkpi0Rz8eVlbkrlhUdnM56XQ6Opq57/DtwRkVMCFMhJzn89JoNHQ0c9/h26NOU3BdKMh4eVneFhflcGpK1rNZHTn/CfE9uHA6BSyMFhZkODsrt2E7I+c/Ib4Hl1NwOT0dXcgx2N6Wh+FQx16vp/O/ARdO3FrAs2PhcWZGm3l+9sj8b8Cl34ddwMKgVEoFXE5BUK9zkurx4fwseBuPUyWxYKfZTCQIf+txtvb2HLwFm7WaTg5fX1V0cnWlxPPR2ZmC2GSkB+22QsaBC6dTwMLzaPTnAhy4vhSwcP/yEl1s2D8+ngjFNjhwJRZwt9wB2Jm79WVuws4TC3qDgUrJYGekvozUzjjITsFGtarNpsBw2u0654ghnhEbcODCmVjAewjsjMyXkdo5seDm6Uku+n2VcgHYGakvI7UzDlxOwWql4hT4QOoDqY0pwBkVLM3NRQVpgAtnVFApl3UyTXBGBWvhX9x8+JpNE5xRwf8hmXe+7B9dZrOuOwAAAABJRU5ErkJggg==",buttonImageOnly:true,showOn:"both",showButtonPanel:true,changeMonth:true,changeYear:true})}if(window["jQuery"]&&window["jQuery"]["datepicker"]&&window["jQuery"]["datepicker"]["regional"]&&window["jQuery"]["datepicker"]["regional"]["en"]){l()}else{jQuery(function(e){if(e.datepicker)l()})}function s(){$.ui.dialog.prototype._allowInteraction=function(e){if($(e.target).closest(".ui-dialog").length){return true}return!!$(e.target).closest(".ui-datepicker, .select2-drop, .cke, .cke_dialog, #support-modal").length};(function(e){$.ui.dialog.prototype._focusTabbable=function(){if($(document.body).hasClass("mobile-device")){this.uiDialog&&this.uiDialog.focus();return}e.call(this)}})($.ui.dialog.prototype._focusTabbable);(function(e){$.ui.dialog.prototype._createTitlebar=function(){e.call(this);this.uiDialogTitlebar.find(".ui-dialog-titlebar-close").html('<i class="fa fa-times" />')}})($.ui.dialog.prototype._createTitlebar)}if(jQuery.ui){s()}else{jQuery(function(){if(jQuery.ui)s()})}jQuery.cleanData=function(e){return function(t){var i,r,n,a;var o=t;for(n=0;(r=o[n])!=null;n++){try{i=$._data(r,"events");if(i&&i.remove){if(o===t)o=Array.prototype.slice.call(t);$(r).triggerHandler("remove");delete i.remove}}catch(a){}}e(t)}}(jQuery.cleanData);function u(){ss.Exception.prototype.toString=function(){return this.get_message()}}if(ss&&ss.Exception)u();else{jQuery(function(e){if(ss&&ss.Exception)u()})}function c(){Vue.component("editor",{props:{type:{type:String,required:true},id:{type:String,required:false},name:{type:String,required:false},placeholder:{type:String,required:false},value:{required:false},options:{required:false},maxLength:{required:false}},render:function(e){var t=Serenity.EditorTypeRegistry.get(this.type);var i=ss.getAttributes(t,Serenity.ElementAttribute,true);var r=i.length>0?i[0].value:"<input/>";var n={};var a=$(r)[0];var o=a.attributes;for(var l=0;l<o.length;l++){var s=o.item(l);n[s.name]=s.value}if(this.id!=null)n.id=this.id;if(this.name!=null)n.name=this.name;if(this.placeholder!=null)n.placeholder=this.placeholder;var u=this.options;var c=null;var d=this;var f=e(a.tagName,{domProps:n});this.$editorType=t;return f},watch:{value:function(e){Serenity.EditorUtils.setValue(this.$widget,e)}},mounted:function(){var e=this;this.$widget=new this.$editorType($(this.$el),this.options);this.$widget.initialize();if(this.maxLength){Serenity.PropertyGrid.$setMaxLength(this.$widget,this.maxLength)}if(this.options)Serenity.ReflectionOptionsSetter.set(this.$widget,this.options);if(this.value!=null)Serenity.EditorUtils.setValue(this.$widget,this.value);if($(this.$el).data("select2"))Serenity.WX.changeSelect2(this.$widget,function(){e.$emit("input",Serenity.EditorUtils.getValue(e.$widget))});else Serenity.WX.change(this.$widget,function(){e.$emit("input",Serenity.EditorUtils.getValue(e.$widget))})},destroyed:function(){if(this.$widget){this.$widget.destroy();this.$widget=null}}})}window["Vue"]?c():$(function(){window["Vue"]&&c()})})(Q||(Q={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){return t.call(this,e,i)||this}i.prototype.getLookupKey=function(){return Q.coalesce(this.options.lookupKey,t.prototype.getLookupKey.call(this))};i=__decorate([e.Decorators.registerEditor("Serenity.AsyncLookupEditor",[e.ISetEditValue,e.IGetEditValue,e.IStringValue,e.IReadOnly,e.IAsyncInit])],i);return i}(e.LookupEditorBase);e.AsyncLookupEditor=t})(Serenity||(Serenity={}));(function(e){var t=function(){function t(e,t,i){var r=this;this.parentType=e;this.widget=t;this.parentChange=i;this.bind();this.widget.element.bind("remove."+t.uniqueName+"cwh",function(e){r.unbind();r.widget=null;r.parentChange=null})}t.prototype.bind=function(){var e=this;if(Q.isEmptyOrNull(this._parentID)){return null}var t=Q.findElementWithRelativeId(this.widget.element,this._parentID).tryGetWidget(this.parentType);if(t!=null){t.element.bind("change."+this.widget.uniqueName,function(){e.parentChange(t)});return t}else{Q.notifyError("Can't find cascaded parent element with ID: "+this._parentID+"!","",null);return null}};t.prototype.unbind=function(){if(Q.isEmptyOrNull(this._parentID)){return null}var e=Q.findElementWithRelativeId(this.widget.element,this._parentID).tryGetWidget(this.parentType);if(e!=null){e.element.unbind("."+this.widget.uniqueName)}return e};t.prototype.get_parentID=function(){return this._parentID};t.prototype.set_parentID=function(e){if(this._parentID!==e){this.unbind();this._parentID=e;this.bind()}};t=__decorate([e.Decorators.registerClass("Serenity.CascadedWidgetLink")],t);return t}();e.CascadedWidgetLink=t})(Serenity||(Serenity={}));(function(e){var t;(function(t){function i(t){var i=new e.Flexify(t.closest(".ui-dialog"),{});return t}t.dialogFlexify=i;function r(e,t,i,r,n){var a=e.dialog();a.dialog("option","resizable",true);if(r!=null){a.dialog("option","minWidth",r)}if(t!=null){a.dialog("option","width",t)}if(n!=null){a.dialog("option","minHeight",n)}if(i!=null){a.dialog("option","height",i)}return e}t.dialogResizable=r;function n(e){e.dialogExtend({closable:true,maximizable:true,dblclick:"maximize",icons:{maximize:"ui-icon-maximize-window"}});return e}t.dialogMaximizable=n;function a(e){e.bind("keydown",function(e){if(e.which!==13){return}var t=e.target.tagName.toLowerCase();if(t==="button"||t==="select"||t==="textarea"||t==="input"&&e.target.getAttribute("type")==="button"){return}var i=$(this);if(!i.hasClass("ui-dialog")){i=i.closest(".ui-dialog")}var r=i.children(".ui-dialog-buttonpane").find("button");if(r.length>0){var n=r.find(".default-button");if(n.length>0){r=n}}var a=r.eq(0);if(!a.is(":disabled")){e.preventDefault();a.trigger("click")}});return e}t.dialogCloseOnEnter=a})(t=e.DialogExtensions||(e.DialogExtensions={}))})(Serenity||(Serenity={}));(function(e){var t;(function(t){function i(t){var i=ss.getType(t);if(i!=null&&ss.isAssignableFrom(e.IDialog,i)){return i}for(var r=0,n=Q.Config.rootNamespaces;r<n.length;r++){var a=n[r];i=ss.getType(a+"."+t);if(i!=null&&ss.isAssignableFrom(e.IDialog,i)){return i}}return null}var r={};function n(e){if(r[e]==null){var t=e;var n=i(t);if(n==null&&!Q.endsWith(e,"Dialog")){t=e+"Dialog";n=i(t)}if(n==null){return null}r[e]=n;return n}return r[e]}t.tryGet=n;function a(e){var t=n(e);if(t==null){var i=e+" dialog class is not found! Make sure there is a dialog class with this name, "+"it is under your project root namespace, and your namespace parts start with capital letters, "+"e.g. MyProject.Pascal.Cased namespace. If you got this error from an editor with InplaceAdd option "+"check that lookup key and dialog type name matches (case sensitive, excluding Dialog suffix). "+"You need to change lookup key or specify DialogType property in LookupEditor attribute if that's not the case.";Q.notifyError(i,"",null);throw new ss.Exception(i)}return t}t.get=a})(t=e.DialogTypeRegistry||(e.DialogTypeRegistry={}))})(Serenity||(Serenity={}));